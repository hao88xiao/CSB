<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="IntfDAO">
	<resultMap id="OfferProd" class="com.linkage.bss.crm.model.OfferProd">
		<result column="PROD_ID" property="prodId" jdbcType="DECIMAL" />
		<result column="ATOM_ACTION_ID" property="atomActionId"
			jdbcType="DECIMAL" />
		<result column="REDU_PROD_SPEC_ID" property="prodSpecId"
			jdbcType="DECIMAL" />
		<result column="REDU_ACCESS_NUMBER" property="accessNumber"
			jdbcType="VARCHAR" />
		<result column="REDU_ACCT_ID" property="acctId" jdbcType="DECIMAL" />
		<result column="REDU_OWNER_ID" property="partyId" jdbcType="DECIMAL" />
		<result column="AREA_ID" property="areaId" jdbcType="DECIMAL" />
		<result column="BEGIN_DT" property="beginDt" jdbcType="TIMESTAMP" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
		<!--
			<result column="EXT_PROD_INST_ID" property="extProdInstId"
			jdbcType="VARCHAR" />
		-->
		<result column="EXT_SYSTEM" property="extSystem" jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="BaseResultMap" class="com.linkage.bss.crm.model.LogIdentityCheckGzt" >
	    <result column="ID"               property="id"             jdbcType="DECIMAL" />
	    <result column="IDENTITY_NUMBER"  property="identityNumber" jdbcType="VARCHAR" />
	    <result column="PARTY_NAME"       property="partyName"      jdbcType="VARCHAR" />
	    <result column="RESULT"           property="result"         jdbcType="DECIMAL" />
	    <result column="CREATE_DT"        property="createDt"       jdbcType="DATE" />
	    <result column="CHANNEL_ID"       property="channelId"      jdbcType="DECIMAL" />
 	 </resultMap>
     <resultMap id="ResultMapWithBLOBs" class="com.linkage.bss.crm.model.LogIdentityCheckGzt" extends="IntfDAO.BaseResultMap" >
        <result column="RETURN_MSG"       property="returnMsg" jdbcType="CLOB" />
     </resultMap>
     <resultMap id="GetResultMapWithBLOBs" class="com.linkage.bss.crm.model.LogIdentityCheckGzt"  >
        <result column="RETURN_MSG"       property="returnMsg" jdbcType="CLOB" />
     </resultMap>


	<resultMap id="FingerPhotoCutMap" class="com.linkage.bss.crm.intf.model.FingerPhotoCut" >
	    <result column="OL_ID" jdbcType="DECIMAL" property="olId" />
	    <result column="BO_ID" jdbcType="DECIMAL" property="boId" />
	    <result column="BO_ACTION_TYPE_ID" jdbcType="VARCHAR" property="boActionTypeId" />
	    <result column="PROD_ID" jdbcType="DECIMAL" property="prodId" />
	    <result column="STAFF_ID" jdbcType="DECIMAL" property="staffId" />
	    <result column="PARTY_ID" jdbcType="DECIMAL" property="partyId" />
	    <result column="CREAT_DT" jdbcType="DATE" property="creatDt" />
	    <result column="EXT_FIELDS1" jdbcType="VARCHAR" property="extFields1" />
	    <result column="EXT_FIELDS2" jdbcType="VARCHAR" property="extFields2" />
	    <result column="EXT_FIELDS3" jdbcType="VARCHAR" property="extFields3" />
	    <result column="AUDIT_RESULT" jdbcType="VARCHAR" property="auditResult" />
	    <result column="AUDIT_STAFF_ID" jdbcType="DECIMAL" property="auditStaffId" />
	    <result column="AUDIT_DT" jdbcType="DATE" property="auditDt" />
  </resultMap>
  <resultMap id="FingerPhotoCutResultMapWithBLOBs" class="com.linkage.bss.crm.intf.model.FingerPhotoCut"  >
    <result column="PARTY_ID" jdbcType="DECIMAL" property="partyId" />
    <result column="PHOTO_CUT" jdbcType="CLOB" property="photoCut" />
  </resultMap>
	<resultMap id="Tel2Area" class="com.linkage.bss.crm.intf.model.Tel2Area">
		<result column="ORG_AREA_CODE" property="orgAreaCode" jdbcType="VARCHAR" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="AreaInfo" class="com.linkage.bss.crm.intf.model.AreaInfo">
		<result column="AREA_CODE" property="areaCode" jdbcType="VARCHAR" />
		<result column="NAME" property="areaName" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="OperatingOfficeInfo"
		class="com.linkage.bss.crm.intf.model.OperatingOfficeInfo">
		<result column="CHANNEL_ID" property="channelId" jdbcType="DECIMAL" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="AREA_ID" property="areaId" jdbcType="DECIMAL" />
		<result column="CAPACITY" property="capacity" jdbcType="DECIMAL" />
		<result column="OPEN_TIME" property="openTime" jdbcType="VARCHAR" />
		<result column="CLOSE_TIME" property="closeTime" jdbcType="VARCHAR" />
		<result column="DESCRIPTION" property="description" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="RoleObjResult" class="com.linkage.bss.crm.model.RoleObj">
		<result column="OBJ_ID" property="objId" jdbcType="DECIMAL" />
		<result column="OBJ_TYPE" property="objType" jdbcType="DECIMAL" />
		<result column="OFFER_ROLE_ID" property="offerRoleId" jdbcType="DECIMAL" />
		<result column="DEFAULT_QTY" property="defaultQty" jdbcType="DECIMAL" />
		<result column="MIN_QTY" property="minQty" jdbcType="DECIMAL" />
		<result column="MAX_QTY" property="maxQty" jdbcType="DECIMAL" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="OfferResult" class="com.linkage.bss.crm.model.Offer">
		<result column="OFFER_ID" property="offerId" jdbcType="DECIMAL" />
		<result column="OFFER_MEMBER_ID" property="extProdOfferInstId" jdbcType="DECIMAL" />
		<result column="ATOM_ACTION_ID" property="atomActionId"
			jdbcType="DECIMAL" />
		<result column="PARTY_ID" property="partyId" jdbcType="DECIMAL" />
		<result column="OFFER_SPEC_ID" property="offerSpecId" jdbcType="DECIMAL" />
		<result column="OFFER_NBR" property="offerNbr" jdbcType="VARCHAR" />
		<result column="AREA_ID" property="areaId" jdbcType="DECIMAL" />
		<result column="MKT_ACTIVITY_ID" property="mktActivityId"
			jdbcType="DECIMAL" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="OfferRolesResult" class="com.linkage.bss.crm.model.OfferRoles">
		<result column="OFFER_ROLE_ID" property="offerRoleId" jdbcType="DECIMAL" />
		<result column="CODE" property="code" jdbcType="VARCHAR" />
		<result column="OFFER_SPEC_ID" property="offerSpecId" jdbcType="DECIMAL" />
		<result column="ROLE_CD" property="roleCd" jdbcType="DECIMAL" />
		<result column="IF_HARDCORE" property="ifHardcore" jdbcType="VARCHAR" />
		<result column="DEFAULT_QTY" property="defaultQty" jdbcType="DECIMAL" />
		<result column="MIN_QTY" property="minQty" jdbcType="DECIMAL" />
		<result column="MAX_QTY" property="maxQty" jdbcType="DECIMAL" />
		<result column="COMP_ORDER" property="compOrder" jdbcType="DECIMAL" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
		<result column="LEAST_QTY" property="leastQty" jdbcType="DECIMAL" />
		<result column="QTY_RULE" property="qtyRule" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="offerServResult" class="com.linkage.bss.crm.model.OfferServ">
		<result column="SERV_ID" property="servId" jdbcType="DECIMAL" />
		<result column="ATOM_ACTION_ID" property="atomActionId"
			jdbcType="DECIMAL" />
		<result column="SERV_SPEC_ID" property="servSpecId" jdbcType="DECIMAL" />
		<result column="PROD_ID" property="prodId" jdbcType="DECIMAL" />
		<result column="COMP_PROD_ID" property="compProdId" jdbcType="DECIMAL" />
		<result column="BEGIN_DT" property="beginDt" jdbcType="TIMESTAMP" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="OfferProdItemResult" class="com.linkage.bss.crm.model.OfferProdItem">
		<result column="ATOM_ACTION_ID" property="atomActionId"
			jdbcType="DECIMAL" />
		<result column="PROD_ID" property="prodId" jdbcType="DECIMAL" />
		<result column="ITEM_SPEC_ID" property="itemSpecId" jdbcType="DECIMAL" />
		<result column="VALUE" property="value" jdbcType="VARCHAR" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="OfferProd2TdResult" class="com.linkage.bss.crm.model.OfferProd2Td">
		<result column="ATOM_ACTION_ID" property="atomActionId"
			jdbcType="DECIMAL" />
		<result column="PROD_2_TD_ID" property="prod2TdId" jdbcType="DECIMAL" />
		<result column="PROD_ID" property="prodId" jdbcType="DECIMAL" />
		<result column="TERMINAL_DEV_SPEC_ID" property="terminalDevSpecId"
			jdbcType="DECIMAL" />
		<result column="TERMINAL_DEV_ID" property="terminalDevId"
			jdbcType="DECIMAL" />
		<result column="TERMINAL_CODE" property="terminalCode"
			jdbcType="VARCHAR" />
		<result column="DEVICE_MODEL_ID" property="deviceModelId"
			jdbcType="DECIMAL" />
		<result column="DEVICE_MODEL_NAME" property="deviceModelName"
			jdbcType="VARCHAR" />
		<result column="OWNER_TYPE_CD" property="ownerTypeCd" jdbcType="DECIMAL" />
		<result column="MAINTAIN_TYPE_CD" property="maintainTypeCd"
			jdbcType="DECIMAL" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="ProdSpec2AccessNumTypeResult"
		class="com.linkage.bss.crm.intf.model.ProdSpec2AccessNumType">
		<result column="AN_TYPE_CD" property="anTypeCd" jdbcType="DECIMAL" />
		<result column="PROD_SPEC_ID" property="prodSpecId" jdbcType="DECIMAL" />
		<result column="REASON_CD" property="reasonCd" jdbcType="DECIMAL" />
		<result column="IS_PRIMARY" property="isPrimary" jdbcType="VARCHAR" />
		<result column="MIN_QTY" property="minQty" jdbcType="DECIMAL" />
		<result column="MAX_QTY" property="maxQty" jdbcType="DECIMAL" />
		<result column="AN_CHOOSE_TYPE_CD" property="anChooseTypeCd"
			jdbcType="DECIMAL" />
		<result column="NEED_PW" property="needPw" jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="accountResult" class="com.linkage.bss.crm.model.Account">
		<result column="ACCT_ID" property="acctId" jdbcType="DECIMAL" />
		<result column="ACCT_CD" property="acctCd" jdbcType="VARCHAR" />
		<result column="AREA_ID" property="areaId" jdbcType="DECIMAL" />
		<result column="PARTY_ID" property="partyId" jdbcType="DECIMAL" />
		<result column="ACCT_STATUS_CD" property="acctStatusCd"
			jdbcType="DECIMAL" />
		<result column="ACCT_STATUS_REASON_CD" property="acctStatusReasonCd"
			jdbcType="DECIMAL" />
		<result column="CREDIT_CLASS_CD" property="creditClassCd"
			jdbcType="DECIMAL" />
		<result column="LIMIT_QTY" property="limitQty" jdbcType="DECIMAL" />
		<result column="PROD_ID" property="prodId" jdbcType="DECIMAL" />
		<result column="ACCT_TYPE_CD" property="acctTypeCd" jdbcType="DECIMAL" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
		<result column="ACCT_NAME" property="acctName" jdbcType="VARCHAR" />
		<result column="BUSINESS_PASSWORD" property="businessPassword"
			jdbcType="VARCHAR" />
	</resultMap>

	<resultMap id="OfferServItemResult" class="com.linkage.bss.crm.model.OfferServItem">
		<result column="ATOM_ACTION_ID" property="atomActionId"
			jdbcType="DECIMAL" />
		<result column="SERV_ID" property="servId" jdbcType="DECIMAL" />
		<result column="ITEM_SPEC_ID" property="itemSpecId" jdbcType="DECIMAL" />
		<result column="VALUE" property="value" jdbcType="VARCHAR" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="NewValidate" class="com.linkage.bss.crm.intf.model.NewValidate">
		<result column="CUSTNAME" property="name" jdbcType="VARCHAR" />
		<result column="IDENTITYNUM" property="identityNum" jdbcType="VARCHAR" />
		<result column="IDENTIFYTYPE" property="identidiesType"
			jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="YKSXInfo" class="com.linkage.bss.crm.intf.model.YKSXInfo">
		<result column="prodId" property="prodId" jdbcType="DECIMAL" />
		<result column="roleCd" property="roleCd" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="ProdByCompProdSpec"
		class="com.linkage.bss.crm.intf.model.ProdByCompProdSpec">
		<result column="PROD_ID" property="prodId" jdbcType="DECIMAL" />
		<result column="ACCESS_NUMBER" property="accessNumber"
			jdbcType="VARCHAR" />
		<result column="PROD_SPEC_ID" property="prodSpecId" jdbcType="DECIMAL" />
		<result column="PROD_SPEC_NAME" property="prodSpecName"
			jdbcType="VARCHAR" />
		<result column="AREA_ID" property="areaId" jdbcType="DECIMAL" />
		<result column="AREA_NAME" property="areaName" jdbcType="VARCHAR" />
		<result column="acct_cd" property="acctCd" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="getBusiOrdersByOlIdResult" class="com.linkage.bss.crm.model.BusiOrder">
		<result column="BO_ID" property="boId" jdbcType="DECIMAL" />
		<result column="OL_ID" property="olId" jdbcType="DECIMAL" />
		<result column="SEQ" property="seq" jdbcType="DECIMAL" />
		<result column="PARTY_ID" property="partyId" jdbcType="DECIMAL" />
		<result column="COL_ID" property="colId" jdbcType="DECIMAL" />
		<result column="GRP_SEQ" property="grpSeq" jdbcType="DECIMAL" />
		<result column="BO_ACTION_TYPE_CD" property="boActionTypeCd"
			jdbcType="VARCHAR" />
		<result column="STAFF_ID" property="staffId" jdbcType="DECIMAL" />
		<result column="APP_START_DT" property="appStartDt" jdbcType="TIMESTAMP" />
		<result column="APP_END_DT" property="appEndDt" jdbcType="TIMESTAMP" />
		<result column="IF_RIGHT_NOW" property="ifRightNow" jdbcType="VARCHAR" />
		<result column="ARCHIVE_DT" property="archiveDt" jdbcType="TIMESTAMP" />
		<result column="COMPLETE_DT" property="completeDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="findBoActionTypeByPKResult" class="com.linkage.bss.crm.model.BoActionType">
		<result property="boActionTypeCd" column="BO_ACTION_TYPE_CD" />
		<result property="actionClassCd" column="ACTION_CLASS_CD" />
		<result property="parentBoActionCd" column="PARENT_BO_ACTION_CD" />
		<result property="name" column="NAME" />
		<result property="description" column="DESCRIPTION" />
	</resultMap>

	<resultMap id="findBoServOrderByBoIdResult" class="com.linkage.bss.crm.model.BoServOrder">
		<result column="BO_ID" property="boId" jdbcType="DECIMAL" />
		<result column="SERV_ID" property="servId" jdbcType="DECIMAL" />
		<result column="SERV_SPEC_ID" property="servSpecId" jdbcType="DECIMAL" />
		<result column="COMP_PROD_ID" property="compProdId" jdbcType="DECIMAL" />
	</resultMap>

	<resultMap id="findProdSpecByProdIdResult" class="com.linkage.bss.crm.model.OfferProdSpec">
		<result column="ATOM_ACTION_ID" property="atomActionId"
			jdbcType="DECIMAL" />
		<result column="PROD_ID" property="prodId" jdbcType="DECIMAL" />
		<result column="PROD_SPEC_ID" property="prodSpecId" jdbcType="DECIMAL" />
		<result column="START_DT" property="startDt" jdbcType="TIMESTAMP" />
		<result column="END_DT" property="endDt" jdbcType="TIMESTAMP" />
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="STATUS_DT" property="statusDt" jdbcType="TIMESTAMP" />
		<result column="CREATE_DT" property="createDt" jdbcType="TIMESTAMP" />
		<result column="VERSION" property="version" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="statusResult" class="com.linkage.bss.crm.model.InstStatus">
		<result column="STATUS_CD" property="statusCd" jdbcType="VARCHAR" />
		<result column="NAME" property="name" jdbcType="VARCHAR" />
		<result column="DESCRIPTION" property="description" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 销售品参数的获取 -->
	<resultMap id="offerSpecParamResultMap" class="com.linkage.bss.crm.model.OfferSpecParam">
		<result property="offerSpecId" column="OFFER_SPEC_ID"></result>
		<result property="offerSpecParamId" column="OFFER_SPEC_PARAM_ID"></result>
		<result property="itemSpecId" column="ITEM_SPEC_ID"></result>
		<result property="name" column="PARAM_NAME"></result>
	</resultMap>
	<!-- 查询接入方式为FTTH -->
	<typeAlias alias="AttachOfferInfoDto"
		type="com.linkage.bss.crm.offerspec.dto.AttachOfferInfoDto" />
	<typeAlias alias="OfferServItemDto"
		type="com.linkage.bss.crm.offer.dto.OfferServItemDto" />
	<typeAlias alias="ServSpecDto" type="com.linkage.bss.crm.intf.model.ServSpecDto" />
	<typeAlias alias="ServParam" type="com.linkage.bss.crm.intf.model.ServParam" />
	<typeAlias alias="DiscreateValue"
		type="com.linkage.bss.crm.intf.model.DiscreateValue" />
	<typeAlias alias="OfferInfoKF" type="com.linkage.bss.crm.intf.model.OfferInfoKF" />
	<typeAlias alias="OfferParamKF" type="com.linkage.bss.crm.intf.model.OfferParamKF" />
	<typeAlias alias="OfferParams" type="com.linkage.bss.crm.model.OfferParam" />
	<typeAlias alias="AttachOfferDto"
		type="com.linkage.bss.crm.offer.dto.AttachOfferDto" />
	<typeAlias alias="OfferMember" type="com.linkage.bss.crm.model.OfferMember" />
	<!-- 根据产品查找在用服务附属销售品以及角色构成 -->
	<resultMap id="attachOfferDtoResultMap" class="AttachOfferDto"
		groupBy="offerId">
		<result property="offerSpecId" column="OFFERSPECID"></result>
		<result property="offerSpecName" column="OFFERSPECNAME"></result>
		<result property="offerSpecFlag" column="OFFERSPECFLAG"></result>
		<result property="offerId" column="OFFERID"></result>
		<result property="statusCd" column="OSTATUSCD"></result>
		<result property="atomActionId" column="ATOMACTIONID"></result>
		<result property="boId" column="BOID"></result>
		<result property="offerMembers" resultMap="IntfDAO.offerMemberResultMap"></result>
	</resultMap>
	<resultMap id="offerMemberResultMap" class="OfferMember">
		<result property="offerMemberId" column="OM_OFFERMEMBERID"></result>
		<result property="offerId" column="OM_OFFERID"></result>
		<result property="offerRoleId" column="OFFERROLEID"></result>
		<result property="objType" column="OBJTYPE"></result>
		<result property="memberId" column="MEMBERID"></result>
		<result property="startDt" column="STARTDT"></result>
		<result property="endDt" column="ENDDT"></result>
		<result property="statusCd" column="STATUSCD"></result>
		<result property="statusDt" column="STATUSDT"></result>
		<result property="offerServ.servSpecId" column="SERVSPECID"></result>
		<result property="offerServ.atomActionId" column="OS_ATOMACTIONID"></result>
	</resultMap>

	<typeAlias alias="CommonOfferProdDto"
		type="com.linkage.bss.crm.offer.dto.CommonOfferProdDto" />
	<resultMap id="resultCommonOfferProd" class="CommonOfferProdDto">
		<result property="accessNumber" column="ACCESS_NUMBER"
			javaType="String" jdbcType="VARCHAR" />
		<result property="endDate" column="END_DT" javaType="String"
			jdbcType="VARCHAR" />
		<result property="prodId" column="PROD_ID" />
		<result property="prodSpecId" column="PROD_SPEC_ID" javaType="Integer"
			jdbcType="DECIMAL" />
		<result property="prodSpecName" column="PROD_SPEC_NAME"
			javaType="String" jdbcType="VARCHAR" />
		<result property="areaId" column="AREA_ID" javaType="Integer"
			jdbcType="DECIMAL" />
		<result property="startDate" column="START_DT" javaType="String"
			jdbcType="VARCHAR" />
		<result property="statusCd" column="STATUS_CD" javaType="Short"
			jdbcType="DECIMAL" />
		<result property="statusName" column="STATUS_NAME" javaType="String"
			jdbcType="VARCHAR" />
		<result property="compProdId" column="COMP_PROD_ID" javaType="Long"
			jdbcType="DECIMAL" />
		<result property="partyId" column="REDU_OWNER_ID" />
		<result property="custName" column="PARTY_NAME" />
		<result property="compFlag" column="COMP_FLAG" />
		<result property="offerProdStatusList" column="PROD_ID"
			select="IntfDAO.queryAllProdStatus" />
		<result property="feeType" column="FEE_TYPE" javaType="Short"
			jdbcType="DECIMAL" />
		<result property="feeTypeName" column="FEE_TYPE_NAME" javaType="String"
			jdbcType="VARCHAR" />
		<result property="memberName" column="MEMBER_NAME"></result>
	</resultMap>
	<resultMap id="resultOfferProdStatusDto"
		class="com.linkage.bss.crm.offer.dto.OfferProdStatusDto">
		<result property="prodStatusCd" column="PROD_STATUS_CD"
			javaType="Short" jdbcType="DECIMAL" />
		<result property="prodStatusName" column="PROD_STATUS_NAME"
			javaType="String" jdbcType="VARCHAR" />
		<result property="statusCd" column="PROD_STS_CD" javaType="Short"
			jdbcType="DECIMAL" />
		<result property="statusName" column="PROD_STS_NAME" javaType="String"
			jdbcType="VARCHAR" />
	</resultMap>
	<typeAlias alias="BusiLimitObjDto" type="com.linkage.bss.crm.offerspec.dto.BusiLimitDto"/>
	<resultMap id="AttachOfferInfoResult" class="BusiLimitObjDto" groupBy="authObjType">							
		<result property="authObjType" column="authObjType"/>  
		<result property="authObjLists" resultMap="IntfDAO.AttachOfferInfoDtoMap"/>               
	</resultMap>
	<resultMap id="AttachOfferInfoDtoMap" class="AttachOfferInfoDto">							
		<result property="offerSpecId" column="OFFERSPECID"/>  
		<result property="offerSpecName" column="OFFERSPECNAME"/>                
		<result property="simpleSpell" column="SIMPLESPELL"/>  
		<result property="labelId" column="LABELID"/>  
		<result property="labelName" column="LABELNAME"/>  
		<result property="offerSpecFlag" column="OFFERSPECFLAG"/> 
	</resultMap>
	<!---->
	
	
	<select id="queryProdByAccessNumber" parameterClass="String"
		resultMap="OfferProd">
		<![CDATA[
		select prod.* from (
			select op.PROD_ID, op.ATOM_ACTION_ID, op.AREA_ID, op.BEGIN_DT, op.START_DT, op.END_DT, op.STATUS_CD, op.STATUS_DT,
				op.CREATE_DT, op.VERSION, op.REDU_PROD_SPEC_ID, op.REDU_ACCESS_NUMBER, op.REDU_ACCT_ID, op.REDU_OWNER_ID,
				op.EXT_PROD_INST_ID, op.EXT_SYSTEM 
			from OFFER_PROD_NUMBER opn, OFFER_PROD op
	   		where opn.STATUS_CD in (10,11,12,13,20) 
	   			and op.STATUS_CD in (10,11,12,13,20)
	   			and opn.ACCESS_NUMBER = #accessNumber#  
	   			and opn.PROD_ID = op.PROD_ID
	   			and op.redu_prod_spec_id <> 10123
	   		union
	   		select op.PROD_ID, op.ATOM_ACTION_ID, op.AREA_ID, op.BEGIN_DT, op.START_DT, op.END_DT, op.STATUS_CD, op.STATUS_DT,
				op.CREATE_DT, op.VERSION, op.REDU_PROD_SPEC_ID, op.REDU_ACCESS_NUMBER, op.REDU_ACCT_ID, op.REDU_OWNER_ID,
				op.EXT_PROD_INST_ID, op.EXT_SYSTEM 
			from OFFER_PROD_2_ACCESS_NUMBER opn ,OFFER_PROD op
	   		where opn.STATUS_CD in (10,11,12,13,20) 
	   			and op.STATUS_CD in (10,11,12,13,20)
	   			and opn.ACCESS_NUMBER = #accessNumber#  
	   			and opn.PROD_ID = op.PROD_ID
	   			and op.redu_prod_spec_id <> 10123
	   	) prod where rownum < 2
        ]]>
	</select>

	<typeAlias alias="OfferSpecDto" type="com.linkage.bss.crm.offerspec.dto.OfferSpecDto"/>
	<select id="query1ProdByAccessNumber" parameterClass="String"
		resultMap="OfferProd">
		<![CDATA[
		select prod.* from (
			select op.PROD_ID, op.ATOM_ACTION_ID, op.AREA_ID, op.BEGIN_DT, op.START_DT, op.END_DT, op.STATUS_CD, op.STATUS_DT,
				op.CREATE_DT, op.VERSION, op.REDU_PROD_SPEC_ID, op.REDU_ACCESS_NUMBER, op.REDU_ACCT_ID, op.REDU_OWNER_ID,
				op.EXT_PROD_INST_ID, op.EXT_SYSTEM 
			from OFFER_PROD_NUMBER opn, OFFER_PROD op
	   		where opn.STATUS_CD in (10,11,12,13,20) 
	   			and op.STATUS_CD in (10,11,12,13,20)
	   			and opn.ACCESS_NUMBER = #accessNumber#  
	   			and opn.PROD_ID = op.PROD_ID
	   			and op.redu_prod_spec_id <> 10123
	   	) prod where rownum < 2
        ]]>
	</select>
	
	<select id="query2ProdByAccessNumber" parameterClass="String"
		resultMap="OfferProd">
		<![CDATA[
		select prod.* from (
			select op.PROD_ID, op.ATOM_ACTION_ID, op.AREA_ID, op.BEGIN_DT, op.START_DT, op.END_DT, op.STATUS_CD, op.STATUS_DT,
				op.CREATE_DT, op.VERSION, op.REDU_PROD_SPEC_ID, op.REDU_ACCESS_NUMBER, op.REDU_ACCT_ID, op.REDU_OWNER_ID,
				op.EXT_PROD_INST_ID, op.EXT_SYSTEM 
			from OFFER_PROD_2_ACCESS_NUMBER opn ,OFFER_PROD op
	   		where opn.STATUS_CD in (10,11,12,13,20) 
	   			and op.STATUS_CD in (10,11,12,13,20)
	   			and opn.ACCESS_NUMBER = #accessNumber#  
	   			and opn.PROD_ID = op.PROD_ID
	   			and op.redu_prod_spec_id <> 10123
	   	) prod where rownum < 2
        ]]>
	</select>
	

	<select id="getStaticSql" parameterClass="java.util.List"
		resultClass="java.util.HashMap">
		<![CDATA[
			SELECT A.SQL_ID , A.SQL_TYPE , A.ITEM_SPEC_ID , A.SQL_INFO , A.SQL_PARAM 
			  FROM STATIC_SQL A, STATIC_SQL_CONFIG B
			 WHERE A.SQL_ID = B.sql_id
			   and B.SYSTEM_ID = 1
       		]]>
		<iterate prepend="AND" open="(" close=")" conjunction="or">
			A.SQL_ID=#idList[]#</iterate>

	</select>

	<select id="getSqlInfo" resultClass="java.util.HashMap"
		remapResults="true" parameterClass="java.lang.String">
    <![CDATA[ $sql$ ]]>
	</select>
	
	<select id="getAserByProd" resultClass="java.util.HashMap"
		remapResults="true" parameterClass="java.lang.Long">
		<![CDATA[
		select os.serv_id servId,os.serv_spec_id servSpecId
     from offer_prod op, offer_serv os
    where op.prod_id = os.prod_id
      and op.status_cd in (10, 11, 12, 13)
      and os.status_cd in (10, 11, 12, 13)
      and os.serv_spec_id = 20130028
      and os.obj_type = 4
      and op.prod_id =#prodId:NUMERIC#
		]]>
    	
	</select>
<!-- 样例 -->
	<select id="getItemSpec" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[
			SELECT META_KEY_VALUE C1, NAME C2
			  FROM discrete_value_list A
			 WHERE A.ITEM_SPEC_ID = #itemSpecId#
        ]]>
	</select>
	
	

	<select id="qryOfferModel" resultClass="java.util.HashMap"
		parameterClass="java.util.HashMap">
		SELECT SCENE_XML sceneXml,SCENE_ID sceneId,NAME
		modelName
		FROM PROD.SCENE_INFO a
		WHERE a.XML_TYPE = #padType:DECIMAL#
		AND a.SCENE_STATUS_CD = 2    
	</select>

	<select id="queryProdQryPwdByProdId" parameterClass="Long"
		resultClass="String">
		<![CDATA[
		select opp.pw
  			from offer_prod op, offer_prod_pw opp
 		where op.prod_id = opp.prod_id
   			and op.status_cd in (10, 11, 12, 13)
   			and opp.status_cd in (10, 11, 12, 13)
  			and op.prod_id = #prodId#
   			and opp.prod_pw_type_cd=1
   			and rownum < 2
        ]]>
	</select>

	<select id="queryProdBizPwdByProdId" parameterClass="Long"
		resultClass="String">
		<![CDATA[
		select opp.pw
  			from offer_prod op, offer_prod_pw opp
 		where op.prod_id = opp.prod_id
   			and op.status_cd in (10, 11, 12, 13)
   			and opp.status_cd in (10, 11, 12, 13)
  			and op.prod_id = #prodId#
   			and opp.prod_pw_type_cd=2
   			and rownum < 2
        ]]>
	</select>
	
	<select id="getFlag" parameterClass="String"
		resultClass="String">
		<![CDATA[
		select a.keyvalue
            from intf.intf_config a
            where a.keyflag = #keyflag#
                  and rownum < 2
         ]]>
	</select>

	<select id="queryAcctPwdByProdId" parameterClass="Long"
		resultClass="String">
		<![CDATA[
		select business_password from account where acct_id = #acctId# and rownum < 2
        ]]>
	</select>

	<select id="queryAccNBRInfo" parameterClass="java.lang.String"
		resultMap="Tel2Area">
	    <![CDATA[ 
			SELECT B.ORG_AREA_CODE, B.NAME
			  FROM BILL_ORG B, HEAD_ACESS_NUMBER H
			 WHERE B.ORG_ID = H.REGION_ID
			   AND H.HEAD LIKE '%' || #accNbr# || '%'
			   and H.type_code='52Z'
			   AND ROWNUM < 2
	    ]]>
	</select>

	<select id="queryAreaInfoByCode" parameterClass="java.lang.String"
		resultMap="AreaInfo">
	    <![CDATA[ 
	    SELECT DISTINCT SA.AREA_CODE, SUBSTR(SA.NAME, 1, 3) as NAME
          FROM STAND_ADDR SA           
         WHERE SA.AREA_CODE = #areaCode#
           AND SA.ADDR_LEVEL = 4
           AND ROWNUM < 2
	    ]]>
	</select>

	<select id="queryAreaInfoByName" parameterClass="java.lang.String"
		resultMap="AreaInfo">
	    <![CDATA[ 
			SELECT DISTINCT SA.AREA_CODE, SUBSTR(SA.NAME, 1, 3)  as NAME
			  FROM STAND_ADDR SA
			 WHERE SA.NAME LIKE '%' || #areaName# || '%'
			   AND SA.ADDR_LEVEL = 4
			   AND ROWNUM < 2
	    ]]>
	</select>

	<select id="queryOperatingOfficeInfoAll" resultMap="OperatingOfficeInfo">
	    <![CDATA[ 
	       SELECT TO_CHAR(CL.CHANNEL_ID) AS CHANNEL_ID,
	              CL.NAME,
	              CL.AREA_ID,
	              CL.CAPACITY,
	              TO_CHAR(CL.OPEN_TIME, 'yyyymmdd hh24:mi:ss') AS OPEN_TIME,
	              TO_CHAR(CL.CLOSE_TIME, 'yyyymmdd hh24:mi:ss') AS CLOSE_TIME,
	              CL.DESCRIPTION
	         FROM crm_app.CHANNEL CL
	        ORDER BY CL.CHANNEL_ID
	    ]]>
	</select>

	<select id="queryOperatingOfficeInfoByAreaCode" parameterClass="java.lang.String"
		resultMap="OperatingOfficeInfo">
	    <![CDATA[ 
        SELECT TO_CHAR(CL.CHANNEL_ID) AS CHANNEL_ID,
               CL.NAME,
               CL.AREA_ID,
               CL.CAPACITY,
               TO_CHAR(CL.OPEN_TIME, 'yyyymmdd hh24:mi:ss') AS OPEN_TIME,
               TO_CHAR(CL.CLOSE_TIME, 'yyyymmdd hh24:mi:ss') AS CLOSE_TIME,
               CL.DESCRIPTION
          FROM crm_app.CHANNEL CL, AREA AA
         WHERE AA.AREA_ID = CL.AREA_ID
           AND AA.ZONE_NUMBER = #areaCode#
	    ]]>
	</select>

	<select id="queryOperatingOfficeInfoByAreaName" parameterClass="java.lang.String"
		resultMap="OperatingOfficeInfo">
	    <![CDATA[ 
			SELECT TO_CHAR(CL.CHANNEL_ID) AS CHANNEL_ID,
			       CL.NAME,
			       CL.AREA_ID,
			       CL.CAPACITY,
			       TO_CHAR(CL.OPEN_TIME, 'yyyymmdd hh24:mi:ss') AS OPEN_TIME,
			       TO_CHAR(CL.CLOSE_TIME, 'yyyymmdd hh24:mi:ss') AS CLOSE_TIME,
			       CL.DESCRIPTION
			  FROM CHANNEL CL
			 WHERE CL.NAME LIKE '%'||#areaName#||'%'	
	    ]]>
	</select>

	<select id="queryTerminalCode" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[
			SELECT COUNT(1) FROM OFFER_PROD_2_TD 
			 WHERE STATUS_CD IN ('10', '11', '12')
             AND TERMINAL_CODE = #ICCID#
        ]]>
	</select>
	
	<select id="checkIfIdentityNum" parameterClass="java.lang.String"
		resultClass="java.lang.Integer">
		<![CDATA[
	      select count(1)
            from ctg_inst.party_identity pi
            where pi.identidies_type_cd = '1'
            and   pi.identity_num =#identityNumValue#
        ]]>
	</select>
	
	<select id="checkIsExistsParty" parameterClass="java.lang.String"
		resultClass="java.lang.Integer">
		<![CDATA[
	     select count(1) from party a where a.party_id=#custId#
        ]]>
	</select>
	
	<select id="queryCountProd" parameterClass="java.lang.String"
		resultClass="java.lang.Integer">
		<![CDATA[
	       select  sum(t.c) from (
      select count(t1.prod_id) as c
      from CTG_INST.UPLOAD_PROD_PARTY t1,CTG_INST.UPLOAD_PARTY  t2
      where t1.party_id = t2.party_id
      and t2.identity_num =#identityNumValue#
      union all
      SELECT COUNT(1) as c
      FROM offer_prod op ,party_identity pi
      WHERE op.redu_owner_id = pi.party_id
      AND op.redu_prod_spec_id in ('378','379')
      AND op.status_cd IN ('10','11','12','13')
      AND pi.identity_num=#identityNumValue# ) t
        ]]>
	</select>

	<select id="ifYKSX" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[
			SELECT COUNT(1)
			  FROM OFFER_PROD_COMP A, OFFER_PROD_2_TD B
			 WHERE A.PROD_ID = B.PROD_ID
			   AND A.PROD_COMP_RELA_ROLE_CD IN (239, 240)
			   AND B.TERMINAL_CODE = #ICCID#
        ]]>
	</select>

	<select id="queryNumOfYKSX" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[
			SELECT B.REDU_ACCESS_NUMBER
			  FROM OFFER_PROD_COMP A, OFFER_PROD B
			 WHERE A.PROD_ID = B.PROD_ID
			   AND A.PROD_COMP_RELA_ROLE_CD = 240
			   AND EXISTS (SELECT 1
			          FROM OFFER_PROD_COMP C, OFFER_PROD_2_TD D
			         WHERE C.PROD_ID = D.PROD_ID
			           AND C.PROD_COMP_RELA_ROLE_CD IN (239, 240)
			           AND A.COMP_PROD_ID = C.COMP_PROD_ID
			           AND D.TERMINAL_CODE = #ICCID#)
        ]]>
	</select>

	<select id="queryNum" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[
			SELECT B.REDU_ACCESS_NUMBER
			  FROM OFFER_PROD_2_TD A, OFFER_PROD B
			 WHERE A.PROD_ID = B.PROD_ID
			   AND A.TERMINAL_CODE = #ICCID#
			   AND A.STATUS_CD <> '22'
        ]]>
	</select>

	<insert id='insertIntoGoodsApplayIntf' parameterClass='java.util.HashMap'>
		INSERT
		INTO GOODS_APPLY_INTF
		(TRADE_ID,
		SALE_TIME,
		FLAG,
		VALUE_CARD_TYPE,
		CARD_VALUE,
		APPLY_NUM,
		CHANNELID,
		STAFFCODE)
		VALUES
		(#trade_id#,
		TO_DATE(#sale_time:VARCHAR#,'yyyy-mm-dd'),
		#flag#,
		#value_card_type_code#,
		#value_code#,
		#apply_num#,
		#channelId#,
		#staffCode#)
     </insert>

	<select id="queryCurrentTime" resultClass="java.util.Date">
		select sysdate from
		dual
	</select>

	<select id="queryRoleObjs" resultMap="RoleObjResult"
		parameterClass="java.util.HashMap">
		SELECT OBJ_ID, OBJ_TYPE, OFFER_ROLE_ID, DEFAULT_QTY,
		MIN_QTY, MAX_QTY, START_DT, END_DT, CREATE_DT, VERSION
		FROM ROLE_OBJ
		WHERE OBJ_TYPE = #objType:DECIMAL# AND OBJ_ID =
		#objId:DECIMAL#
	</select>

	<select id="findOfferByProdIdAndOfferSpecId" resultMap="OfferResult"
		parameterClass="java.util.HashMap">
		<![CDATA[
		  SELECT * FROM (
	      SELECT O.*,OM.OFFER_MEMBER_ID FROM OFFER O, OFFER_MEMBER OM 
	      WHERE O.OFFER_ID = OM.OFFER_ID
	      AND OM.STATUS_CD IN ('10','11','12','13','20','21')	
	      AND O.STATUS_CD IN ('10','11','12','13','20','21')   
	      AND O.OFFER_SPEC_ID = #offerSpecId:DECIMAL#
	      AND OM.MEMBER_ID = #prodId:DECIMAL#
	      UNION
	      SELECT O.*,OM.OFFER_MEMBER_ID FROM OFFER O, OFFER_MEMBER OM, OFFER_SERV OSERV
	      WHERE O.OFFER_ID = OM.OFFER_ID
	      AND OM.MEMBER_ID = OSERV.SERV_ID
	      AND O.STATUS_CD IN ('10','11','12','13','20','21')  
	      AND OM.STATUS_CD IN ('10','11','12','13','20','21')
	      AND OSERV.STATUS_CD IN ('10','11','12','13','20','21')
	      AND O.OFFER_SPEC_ID = #offerSpecId:DECIMAL#
	      AND OSERV.PROD_ID = #prodId:DECIMAL#)
	      ORDER BY END_DT DESC
	      
		]]>
	</select>

	<select id="findOfferRoles" resultMap="OfferRolesResult"
		parameterClass="java.util.HashMap">
		SELECT DISTINCT OROLES.* FROM SPEC.OFFER_ROLES OROLES,SPEC.ROLE_OBJ
		ROBJ
		WHERE OROLES.OFFER_SPEC_ID = #offerSpecId:DECIMAL#
		AND
		OROLES.OFFER_ROLE_ID = ROBJ.OFFER_ROLE_ID
		<dynamic prepend="AND">
			<isNotNull property="roleId" prepend="AND">
				OROLES.ROLE_CD =
				#roleId:DECIMAL#
			</isNotNull>
		</dynamic>
		AND ROBJ.OBJ_TYPE = #objType:DECIMAL#
		AND ROBJ.OBJ_ID = #objId:DECIMAL#
	</select>

	<select id="findOfferRolesByObjType" resultMap="OfferRolesResult"
		parameterClass="java.util.HashMap">
		SELECT DISTINCT OROLES.* FROM OFFER_ROLES OROLES, ROLE_OBJ ROBJ
		WHERE
		OROLES.OFFER_ROLE_ID = ROBJ.OFFER_ROLE_ID
		<dynamic prepend="AND">
			<isNotNull property="roleId" prepend="AND">
				OROLES.ROLE_CD =
				#roleId:DECIMAL#
			</isNotNull>
			<isNull property="roleId" prepend="AND">
				OROLES.if_hardcore = 'Y'
			</isNull>
		</dynamic>
		AND ROBJ.OBJ_TYPE = #objType:DECIMAL#
		AND OROLES.OFFER_SPEC_ID =
		#offerSpecId:DECIMAL#
	</select>

	<select id="findRoleObj" resultMap="RoleObjResult"
		parameterClass="java.util.HashMap">
		select OBJ_ID, OBJ_TYPE, OFFER_ROLE_ID, DEFAULT_QTY,
		MIN_QTY, MAX_QTY,
		START_DT, END_DT,
		CREATE_DT, VERSION
		from ROLE_OBJ
		where OBJ_TYPE = #objType:DECIMAL#
		and OFFER_ROLE_ID =
		#offerRoleId:DECIMAL#
  	</select>

	<select id="findOfferServ" resultMap="offerServResult"
		parameterClass="java.util.HashMap">
		SELECT * FROM INST.OFFER_SERV
		WHERE STATUS_CD in
		('10','11','12','13','21','20')
		AND SERV_SPEC_ID =
		#servSpecId:DECIMAL#
		AND
		PROD_ID
		= #prodId:DECIMAL# 
	</select>

	<select id="findOfferProdItem" resultMap="OfferProdItemResult"
		parameterClass="java.util.HashMap">
		SELECT * FROM OFFER_PROD_ITEM
		WHERE STATUS_CD IN
		('10','11','12','13','21')
		AND ITEM_SPEC_ID =
		#itemSpecId:DECIMAL#
		AND
		PROD_ID
		= #prodId:DECIMAL#
	</select>

	<select id="findOfferProd2Td" resultMap="OfferProd2TdResult"
		parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT * FROM OFFER_PROD_2_TD 
			WHERE  STATUS_CD IN ('10','11','12','13')
			AND TERMINAL_DEV_SPEC_ID = #terminalDevSpecId:DECIMAL#
			AND PROD_ID = #prodId:DECIMAL#
		]]>
	</select>

	<select id="findProdSpec2AccessNumType" resultMap="ProdSpec2AccessNumTypeResult"
		parameterClass="java.util.HashMap">
		SELECT * FROM PROD.PROD_SPEC_2_ACCESS_NUM_TYPE
		WHERE
		IS_PRIMARY = #isPrimary:VARCHAR#
		AND PROD_SPEC_ID =
		#prodSpecId:DECIMAL#
	</select>

	<select id="findAcctByAcctCd" resultMap="accountResult"
		parameterClass="java.lang.String">
		select ACCT_ID,  ACCT_CD, AREA_ID,
		PARTY_ID,
		ACCT_STATUS_CD, ACCT_STATUS_REASON_CD,
		CREDIT_CLASS_CD, LIMIT_QTY,
		PROD_ID, ACCT_TYPE_CD, START_DT, VERSION, ACCT_NAME,
		BUSINESS_PASSWORD
		from ACCOUNT
		where ACCT_CD = #acctCd:VARCHAR#
	</select>

	<select id="findAcctByAccNbrAndProdSpec" resultMap="accountResult"
		parameterClass="java.util.HashMap">
		SELECT A.* FROM CRM.ACCOUNT A,INST.OFFER_PROD_ACCOUNT
		OPA,INST.OFFER_PROD_SPEC OPSPEC,INST.OFFER_PROD_NUMBER OPN
		WHERE
		A.ACCT_ID = OPA.ACCT_ID
		AND OPA.PROD_ID = OPN.PROD_ID
		AND OPA.STATUS_CD
		= '12'
		AND OPSPEC.PROD_SPEC_ID = #prodSpecId:DECIMAL#
		AND OPSPEC.PROD_ID
		= OPN.PROD_ID
		AND OPN.STATUS_CD IN ('10','11','12','13')
		AND
		OPN.ACCESS_NUMBER = #accessNumber:VARCHAR#
	</select>

	<select id="findOfferServItemByServId" parameterClass="java.lang.Long"
		resultMap="OfferServItemResult">
		SELECT * FROM INST.OFFER_SERV_ITEM WHERE STATUS_CD IN
		('10','11','12','13','21')
		AND SERV_ID = #servId:DECIMAL#
	</select>

	<select id="findServSpecId" parameterClass="java.lang.Long"
		resultClass="java.lang.String">
		 <![CDATA[select w.serv_spec_id
		         from offer_roles t, role_obj p, serv_spec w
		         where t.offer_spec_id = #id#
		          and p.OFFER_ROLE_ID = t.OFFER_ROLE_ID
		          and p.OBJ_ID = w.serv_spec_id
		          and p.OBJ_TYPE = 4
       			and ROWNUM < 2	]]>
	</select>

	<select id="findProSpecItem" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		select t.item_spec_id
		from prod_spec_item t, role_obj p,
		offer_roles k
		where t.PROD_SPEC_ID = p.OBJ_ID
		and p.OBJ_TYPE = 2
		and
		k.OFFER_ROLE_ID = p.OFFER_ROLE_ID
		and k.offer_spec_id = #id#
	</select>

	<select id="findServSpecItem" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		select t.item_spec_id
		from sspec_item t, role_obj p,
		offer_roles k
		where t.serv_spec_id = p.OBJ_ID
		and p.OBJ_TYPE = 4
		and
		k.OFFER_ROLE_ID = p.OFFER_ROLE_ID
		and k.offer_spec_id = #id#
	</select>

	<select id="queryOfferSpecIdByAccNbr" parameterClass="java.lang.String"
		resultClass="java.lang.Long">
		select distinct c.offer_spec_id
		  from offer_prod                   a,
		       offer_member                 b,
		       offer                        c,
		       offer_spec_param             d,
		       item_spec_group_2_item_group isg2ig
		 where a.prod_id = b.member_id
		   and b.offer_id = c.offer_id
		   and c.offer_spec_id = d.offer_spec_id
		   and d.item_spec_id = isg2ig.item_spec_id
		   and isg2ig.item_spec_group_cd = 4
		   and a.redu_access_number = #accNbr#
		   and a.status_cd in ('10', '11', '12', '13', '21')
		   and b.status_cd in ('10', '11', '12', '13', '21')
		   and c.status_cd in ('10', '11', '12', '13', '21')
		   and rownum = 1
	</select>

	<select id="queryFNSNum" parameterClass="java.lang.Long"
		resultClass="java.lang.Integer">
		select count(distinct osp.item_spec_id) MaxFNSCnt
		  from offer_spec_param osp, ITEM_SPEC_GROUP_2_ITEM_GROUP ISG2IG
		 where osp.item_spec_id = ISG2IG.ITEM_SPEC_ID
		   and ISG2IG.ITEM_SPEC_GROUP_CD = 4
		   and osp.offer_spec_id = #offerSpecId#
	</select>

	<select id="queryFNSInfo" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select d.item_spec_id, aa.value
		  from (select c.offer_spec_param_id, c.value
		          from offer_prod a, offer_member b, offer_param c
		         where a.prod_id = b.member_id
		           and b.offer_id = c.offer_id
		           and a.redu_access_number = #accNbr#
		           and a.status_cd in ('10', '11', '12', '13','21')
		           and b.status_cd in ('10', '11', '12', '13','21')
		           and c.status_cd in ('10', '11', '12', '13', '21')) aa
		  join offer_spec_param d
		    on aa.offer_spec_param_id = d.offer_spec_param_id
		   and d.offer_spec_id = #offerSpecId#
		  join item_spec_group_2_item_group isg2ig
		    on d.item_spec_id = isg2ig.item_spec_id
		   and isg2ig.item_spec_group_cd = 4
	</select>

	<select id="queryUnusedFNSInfo" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		<![CDATA[
		select aa.item_spec_id
		  from offer_spec_param aa
		  join item_spec_group_2_item_group b
		    on aa.item_spec_id = b.item_spec_id
		   and b.item_spec_group_cd = 4
		   and aa.offer_spec_id = #offerSpecId#
		   and aa.item_spec_id not in
		       (select osp.item_spec_id
		          from (select om.offer_id
		                  from offer_prod op, offer_member om
		                 where op.prod_id = om.member_id
		                   and op.redu_access_number = #accNbr#
		                   and op.status_cd in ('10', '11', '12', '13', '21')
		                   and om.status_cd in ('10', '11', '12', '13', '21')) a
		          left join offer_param opa
		            on a.offer_id = opa.offer_id
		           and opa.status_cd in ('10', '11', '12', '13', '21')
		          join offer_spec_param osp
		            on opa.offer_spec_param_id = osp.offer_spec_param_id
		          join ITEM_SPEC_GROUP_2_ITEM_GROUP ISG2IG
		            on osp.item_spec_id = isg2ig.item_spec_id
		           and isg2ig.item_spec_group_cd = 4)
		   ]]>
	</select>
	
	<select id="queryFNSInfoByOfferSpecId" parameterClass="java.lang.Long" resultClass="java.util.HashMap">
		select b.item_spec_id
		  from item_spec_group_2_item_group a, offer_spec_param b
		 where a.item_spec_id = b.item_spec_id
		   and a.item_spec_group_cd = 4
		   and b.offer_spec_id = #offerSpecId#
	</select>

	<select id="isSubsidy" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT ati.status_cd,atc.coupon_id
		FROM auditing_ticket
		ati, auditing_ticket_2_coupon atc
		WHERE atc.coupon_ins_number =
		#coupon_ins_number#
		AND atc.auditing_ticket_id = ati.audit_ticket_id
	</select>

	<select id="queryYKSXInfoByAccNbr" parameterClass="java.lang.String"
		resultMap="YKSXInfo">
		<![CDATA[
		select opc2.prod_id as prodId, opc2.prod_comp_rela_role_cd as roleCd
		  from offer_prod op
		  left join offer_prod_comp opc
		    on op.prod_id = opc.prod_id
		   and opc.prod_comp_rela_role_cd in (239, 240)
		  left join offer_prod_comp opc2
		    on opc.comp_prod_id = opc2.comp_prod_id
		 where op.status_cd in (11, 12, 13, 21)
		   and opc.status_cd in (11, 12, 13, 21)
		   and op.redu_access_number = #accNbr#
            ]]>
	</select>

	<select id="queryYKSXAccNum" parameterClass="java.util.HashMap"
		resultClass="java.lang.String">
		<![CDATA[
		select distinct b.redu_access_number
		  from offer_prod_comp a
		  left join offer_prod b
		    on a.prod_id = b.prod_id
		 where a.prod_comp_rela_role_cd = #roleCd#
		   and a.prod_id = #prodId#
            ]]>
	</select>

	<select id="queryValidateServiceByAccNum" parameterClass="java.lang.String"
		resultClass="java.lang.Integer">
		<![CDATA[
	     SELECT COUNT(A.PROD_ID)
	      FROM offer_prod A, offer_PROD_STATUS B
	     WHERE A.redu_access_number = #accessNumber#
	       AND A.PROD_ID = B.PROD_ID
	       AND B.PROD_STATUS_CD = 1

            ]]>
	</select>

	<select id="isNewValidateService" parameterClass="java.lang.String"
		resultMap="NewValidate">
	    <![CDATA[ 
		 SELECT DISTINCT A.NAME               CUSTNAME,
		               B.IDENTITY_NUM       IDENTITYNUM,
		               B.IDENTIDIES_TYPE_CD IDENTIFYTYPE
		 FROM PARTY A, PARTY_IDENTITY B, offer_prod C, offer_PROD_STATUS D
		WHERE A.PARTY_ID = C.redu_OWNER_ID
		  AND B.PARTY_ID = C.redu_OWNER_ID
		  AND C.redu_access_number = #accessNumber#
		  AND C.PROD_ID = D.PROD_ID
		  AND D.PROD_STATUS_CD = 1
	    ]]>
	</select>

	<select id="getBusiOrdersByOlId" resultMap="getBusiOrdersByOlIdResult"
		parameterClass="java.lang.Long">
		select BO_ID, OL_ID, SEQ, PARTY_ID,
		COL_ID, GRP_SEQ,
		BO_ACTION_TYPE_CD, STAFF_ID, APP_START_DT,
		APP_END_DT, IF_RIGHT_NOW,
		ARCHIVE_DT, COMPLETE_DT, STATUS_CD,
		STATUS_DT
		from BUSI_ORDER
		where OL_ID
		= #olId:DECIMAL#
	</select>

	<select id="findBoActionTypeByPK" resultMap="findBoActionTypeByPKResult"
		parameterClass="java.lang.String">
		SELECT A.BO_ACTION_TYPE_CD, A.ACTION_CLASS_CD,
		A.PARENT_BO_ACTION_CD,
		A.NAME, A.DESCRIPTION
		FROM BO_ACTION_TYPE A
		WHERE
		A.BO_ACTION_TYPE_CD = #boActionTypeCd:VARCHAR#
	</select>

	<select id="findBoServOrderByBoId" resultMap="findBoServOrderByBoIdResult"
		parameterClass="java.lang.Long">
		select BO_ID, SERV_ID, SERV_SPEC_ID,
		COMP_PROD_ID
		from
		BO_SERV_ORDER
		where BO_ID = #boId:DECIMAL#
	</select>

	<select id="getProdIdByBoId" parameterClass="java.lang.Long"
		resultClass="java.lang.Long">
		<![CDATA[
			SELECT PROD_ID FROM PROD_ORDER
			where BO_ID = #boId:DECIMAL#
		]]>
	</select>

	<select id="findProdSpecByProdId1" resultMap="findProdSpecByProdIdResult"
		parameterClass="java.lang.Long">
		select ATOM_ACTION_ID, PROD_ID,
		PROD_SPEC_ID, START_DT,
		END_DT, STATUS_CD, STATUS_DT, CREATE_DT,
		VERSION
		from OFFER_PROD_SPEC
		where STATUS_CD in ('10','11','12','13')
		and PROD_ID = #prodId:DECIMAL#
	</select>

	<select id="findProdSpecByProdId2" resultMap="findProdSpecByProdIdResult"
		parameterClass="java.lang.Long">
		select ATOM_ACTION_ID, PROD_ID,
		PROD_SPEC_ID, START_DT,
		END_DT, STATUS_CD, STATUS_DT, CREATE_DT,
		VERSION
		from OFFER_PROD_SPEC
		where STATUS_CD in ('21')
		and PROD_ID = #prodId:DECIMAL#
	</select>

	<select id="queryImsiInfoByMdn" parameterClass="java.lang.Long"
		resultClass="java.lang.String">
	    <![CDATA[ 
		 select terminal_code from OFFER_PROD_2_TD where prod_id = #prodId# and status_cd IN (10,11,12,13)
	    ]]>
	</select>

	<select id="queryDtByProdId" parameterClass="java.lang.Long"
		resultClass="java.util.Date">
	    <![CDATA[ 
		 select create_dt from offer_prod where prod_id = #prodId#
	    ]]>
	</select>

	<select id="queryCntBySpecId" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		 SELECT COUNT(1)  
          FROM SPEC.OFFER_SPEC_2_CATEGORY_NODE 
         WHERE CATEGORY_NODE_ID in (#CATEGORY_NODE_ID_EJ#,
           #CATEGORY_NODE_ID_SWLH#,#CATEGORY_NODE_ID_HM#)
           AND OFFER_SPEC_ID =  #offerSpecId#
	    ]]>
	</select>

	<select id="queryCntByProdId" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		 select orr.offer_spec_id 
            from oo_role oor,offer_roles orr,SPEC.OFFER_SPEC_2_CATEGORY_NODE os2c
            where oor.offer_role_id = orr.offer_spec_id
             and os2c.offer_spec_id = orr.offer_spec_id
             and oor.obj_type = 2
             and oor.prod_id = #prodId#
             and os2c.category_node_id = #CATEGORY_NODE_ID_DX#
             and not exists
             (select  1 from atom_action a
               where oor.atom_action_id = a.atom_action_id
                 and a.status_cd = #ORDER_STATUS_DELETED#)
	    ]]>
	</select>

	<select id="queryCntByOfferSpecId" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		 SELECT COUNT(1) 
            FROM SPEC.OFFER_SPEC_2_CATEGORY_NODE 
           WHERE CATEGORY_NODE_ID = #CATEGORY_NODE_ID_LX3G#
             AND OFFER_SPEC_ID =  #offerSpecId#
	    ]]>
	</select>

	<select id="queryCntByOfferProdId" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		 select count(1)
              from offer_prod_status
              where prod_id = #prodId#
              and prod_status_cd in (#USER_STATUS_CD_2#,
                #USER_STATUS_CD_5#,#USER_STATUS_CD_6#)
              and start_dt > SYSDATE - 180
	    ]]>
	</select>

	<select id="queryMoneyByProdId" parameterClass="java.lang.Long"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		select count(1) 
          from offer_prod op,crm.acct_2_payment_acct a2pa,crm.payment_account pa
          where op.redu_acct_id = a2pa.acct_id
           and a2pa.payment_account_id = pa.payment_account_id
           and op.prod_id = #prodId#
	    ]]>
	</select>

	<select id="queryPaymentByProdId" parameterClass="java.lang.Long"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		 select pa.payment_account_type_cd 
              from offer_prod op,crm.acct_2_payment_acct a2pa,crm.payment_account pa
              where op.redu_acct_id = a2pa.acct_id
               and a2pa.payment_account_id = pa.payment_account_id
               and op.prod_id = #prodId#
	    ]]>
	</select>

	<select id="getProdSpecByProdSpecId" parameterClass="java.lang.Long"
		resultClass="com.linkage.bss.crm.model.ProdSpec">
		select PROD_SPEC_ID prodSpecId,
		NAME name,
		DESCRIPTION
		description,
		SSPEC_COMP_GRP_ID sspecCompGrpId,
		STANDARD_OFFERING_ID
		standardOfferingId,
		AREA_ID areaId,
		SPEC_STATUS_CD specStatusCd,
		PARENT_PROD_SPEC parentProdSpec,
		IS_INST isInst,
		PROD_MARKET_NAME
		prodMarketName,
		MANAGE_CD manageCd,
		START_DT startDt,
		END_DT endDt,
		COMP_PROD compProd,
		VERSION version,
		CODE code
		from PROD_SPEC PS
		where
		PS.PROD_SPEC_ID = #prodSpecId:DECIMAL#
	</select>

	<select id="selectByAcctId" parameterClass="java.lang.Long"
		resultClass="java.lang.Long">
		select PAYMENT_ACCOUNT_ID
		from CRM.ACCT_2_PAYMENT_ACCT
		where ACCT_ID =
		#acctId:DECIMAL#
		<![CDATA[ AND ROWNUM < 2 ]]>
	</select>

	<select id="queryProdByProdSpecByPartyId" parameterClass="java.util.HashMap"
		resultMap="ProdByCompProdSpec">
	    <![CDATA[ 
			SELECT op.prod_id,
			       op.redu_access_number access_number,
			       ps.prod_spec_id,
			       ps.name               prod_spec_name,
			       op.area_id,
			       ar.NAME             area_name,
			       ac.acct_cd
			  FROM offer_prod         op,
			       prod_spec          ps,
			       area ar,
			       offer_prod_account opa,
			       account            ac
			 WHERE op.status_cd IN ('10', '11', '12', '13')
			   AND op.area_id = ar.AREA_ID
			   AND op.redu_prod_spec_id = ps.prod_spec_id
			   and op.prod_id = opa.prod_id
			   and opa.acct_id = ac.acct_id
			   and opa.acct_rela_type_cd = 1
			   AND op.redu_owner_id = #partyId:DECIMAL#
			   and ps.prod_spec_id = #prodSpceId:DECIMAL#
			   AND ROWNUM < 21	    
	    ]]>
	</select>

	<select id="queryIfJoinCompProdByProdId" parameterClass="java.lang.Long"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		select count(*)
		  from offer_prod_comp opc, offer_member om, offer_roles oro, offer_spec os
		 where opc.comp_prod_id = om.member_id
		   and om.offer_role_id = oro.OFFER_ROLE_ID
		   and oro.offer_spec_id = os.offer_spec_id
		   and os.offer_spec_id in
		       (select os2cn.offer_spec_id
		          from offer_spec_2_category_node os2cn
		         where os2cn.category_node_id = 100211)
		   and opc.prod_id = #prodId#		   
	    ]]>
	</select>

	<select id="compProdRule" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
	    <![CDATA[ 
		    select count(1)
	         from offer_prod op, offer_member om
	        where op.prod_id = om.member_id
	          and OM.STATUS_CD IN ('10', '11', '12', '13')
	          and om.obj_type = 2
	          and op.STATUS_CD IN ('10', '11', '12', '13')
	          and om.offer_id = #offerId#
	          and op.redu_access_number = #accNum#
	    ]]>
	</select>

	<select id="selectRoleCdAndOfferRoles" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
	 <![CDATA[select a.offer_role_id offerRoleId, b.OBJ_TYPE objType
	  from offer_roles a, role_obj b
	 where a.OFFER_ROLE_ID = b.OFFER_ROLE_ID
	   and b.OBJ_ID = #objId:DECIMAL#
	   and a.role_cd = #roleCd:DECIMAL#
	   and a.offer_spec_id = #offerSpecId:DECIMAL# and ROWNUM < 2]]>
	</select>

	<select id="selectByAcctCd" parameterClass="java.lang.String"
		resultClass="java.lang.Long">
		SELECT A.ACCT_ID FROM ACCOUNT A WHERE A.ACCT_CD =
		#acctCd:VARCHAR#
    </select>

	<select id="queryAccNumByTerminalCode" parameterClass="java.lang.String"
		resultClass="java.lang.String">
		select op.redu_access_number
		from offer_prod_2_td opt,
		offer_prod op
		where opt.prod_id = op.prod_id
		and op.STATUS_CD IN ('10',
		'11', '12', '13')
		and opt.terminal_code = #terminalCode#
    </select>
	<select id="queryPhoneNumberInfoByAnId" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
           <![CDATA[     SELECT PHONE_NUMBER  PHONENUMBER,
           	   PHONE_NUMBER_ID PHONENUMBERID,
               RSC_STATUS_CD RSCSTATUSCD,
               AN_TYPE_CD    ANTYPECD,
               AREA_ID AREAID,
               POOL_ID POOLID
          FROM RM.PHONE_NUMBER
         WHERE ROWNUM < 2]]>
		<isNotEmpty property="phoneNumber" prepend="AND">
			PHONE_NUMBER =
			#phoneNumber:VARCHAR# 
         </isNotEmpty>
		<isNotEmpty property="anId" prepend="AND">
			PHONE_NUMBER_ID =
			#anId:DECIMAL#
         </isNotEmpty>
	</select>
	<select id="queryStaffInfoByStaffName" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		select a.staff_id staffId,
		a.staff_number staffNumber,
		b.name staffName,
		c.name areaName,
		d.name orgName,
		a.org_id orgId,
		b.area_id areaId,
		b.party_type_cd partyTypeCd
		from sm.staff_number a,
		sm.party b,
		area c,
		(select
		t.staff_id,y.name from sm.staff_number t ,
		sm.party y where
		t.org_id=y.party_id) d
		where b.area_id=c.AREA_ID and
		a.staff_id =
		b.party_id and d.staff_id =
		a.staff_id and
		b.name=#staffName:varchar2#
	</select>

	<select id="queryStaffInfoByStaffNumber" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		select a.staff_id staffId,
		a.staff_number staffNumber,
		b.name staffName,
		c.name areaName,
		d.name orgName,
		a.org_id orgId,
		b.area_id areaId,
		b.party_type_cd partyTypeCd
		from sm.staff_number a,
		sm.party b,
		area c,
		(select
		t.staff_id,y.name from sm.staff_number t ,
		sm.party y where
		t.org_id=y.party_id) d
		where b.area_id=c.AREA_ID and
		a.staff_id =
		b.party_id and d.staff_id =
		a.staff_id and
		a.staff_number=upper(#staffNumber:varchar2#)
    </select>

	<select id="getClerkId" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		select a.clerk_id clerkId,
		a.name name
		from clerk_info a
		where a.state = 0 and a.access_number=#accNbr:varchar2#
    </select>

	<select id="isRPLogExist" parameterClass="java.lang.String"
		resultClass="java.lang.Integer">
		select count(1)
		from receipt_print_log
		where
		co_nbr=#coNbr:varchar2#
    </select>

	<insert id="insertReceiptPringLog" parameterClass="java.util.HashMap">
		INSERT INTO
		receipt_print_log(CO_NBR, FLAG, CREATE_DATE)
		VALUES(#coNbr:VARCHAR#,#flag:VARCHAR#,sysdate)
    </insert>

	<select id="judgeCoupon2OfferSpec" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		SELECT COUNT(1)
		FROM OFFER_SPEC OS,
		OFFER_ROLES ORS,
		ROLE_OBJ_2_CFG_RULE T,
		CFG_RULE_2_REQ_OBJ_GRP G,
		REQ_OBJ_GRP_2_OBJ B,
		COUPON_GRP C,
		COUPON_GRP_NUMBER N,
		COUPON P
		WHERE OS.OFFER_SPEC_ID =
		ORS.OFFER_SPEC_ID
		AND ORS.OFFER_ROLE_ID = T.OFFER_ROLE_ID
		AND
		T.CFG_RULE_ID = G.CFG_RULE_ID
		AND G.REQ_OBJ_GRP_ID = B.OBJ_GRP_ID
		AND
		B.OBJ_ID = C.COUPON_GRP_ID
		AND C.COUPON_GRP_ID = N.COUPON_GRP_ID
		AND
		N.COUPON_ID = P.COUPON_ID
		AND B.OBJ_TYPE = 15
		AND OS.OFFER_SPEC_ID =
		#offer_spec_id#
		AND P.COUPON_ID = #couponId#
    </select>


	<select id="queryCustProfiles" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		select pp.party_id as cust_id,
		       max(decode(pp.party_profile_catg_cd, '10022', profile_value, '')) as contact_name,
		       max(decode(pp.party_profile_catg_cd, '900002', profile_value, '')) as contact_address,
		       max(decode(pp.party_profile_catg_cd, '1', profile_value, '')) as telephone,
		       max(decode(pp.party_profile_catg_cd, '44', profile_value, '')) as mobile,
		       max(decode(pp.party_profile_catg_cd, '40074', profile_value, '')) as post_code,
		       max(decode(pp.party_profile_catg_cd, '4', profile_value, '')) as email_address,
		       max(decode(pp.party_profile_catg_cd, '333333', profile_value, '')) as link_email_address,
		       max(decode(pp.party_profile_catg_cd, '310000015', profile_value, '')) as credits_accnbr,
		       max(decode(pp.party_profile_catg_cd, '201519', profile_value, '')) as zrrXm,
		       max(decode(pp.party_profile_catg_cd, '201520', profile_value, '')) as zrrZjlx,
		       max(decode(pp.party_profile_catg_cd, '201521', profile_value, '')) as zrrZjhm,
		       max(decode(pp.party_profile_catg_cd, '201522', profile_value, '')) as zrrLxdh
		  from party_profile pp
		 where pp.party_id = #partyId#
		 group by pp.party_id
    </select>

	<select id="queryIdentifyList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		<![CDATA[
		SELECT distinct PI.identidies_type_cd, PI.identity_num, IT.NAME
		  FROM PARTY_IDENTITY PI, IDENTIFY_TYPE IT
		 WHERE IT.identidies_type_cd = PI.identidies_type_cd
		   AND PI.Identidies_Type_Cd <> '13'
		   and PI.party_id = #partyId#
		   order by identidies_type_cd asc
       ]]>
	</select>


	<select id="qryPartyInfo" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select b.identity_num identityNum, a.name name
		from PARTY a,
		party_identity b
		WHERE a.party_id = b.party_id
		AND b.identidies_type_cd
		= '13'
		and A.NAME = #partyName:VARCHAR#
		<dynamic>
			<isNotNull property="startNum" prepend="AND">
   		<![CDATA[ rownum > #startNum#
	   	and rownum < #endNum# ]]>
			</isNotNull>
		</dynamic>
	</select>

	<select id="getChannelId" parameterClass="java.lang.String"
		resultClass="java.lang.String">
		select b.channel_id
		From crm.channel b
		Where b.manage_code =
		#parentOrg#
    </select>

	<select id="getPartyIdSeq" resultClass="java.lang.Long">
		select
		sm.seq_party.nextval
		from dual
    </select>

	<insert id='insertCrmParty' parameterClass="java.util.HashMap">
		INSERT INTO party
		p
		(PARTY_ID,
		NAME,
		AREA_ID,
		PARTY_TYPE_CD,
		DEFAULT_ID_TYPE,
		MAIL_ADDRESS_ID,
		BUSINESS_PASSWORD,
		QUERY_PASSWORD,
		CREATE_DT,
		VERSION,
		SIMPLE_SPELL,
		PARTY_STATUS_CD)
		VALUES
		(#partyId#,
		#agentName#,
		11000,
		22,
		42,
		to_number(#mailAddressId#),
		'888888',
		'888888',
		sysdate,
		sysdate,
		to_number(#mailAddressId#),
		1)
	</insert>

	<insert id='insertIntfParty' parameterClass='java.util.HashMap'>
		INSERT INTO
		intf.intf_party
		(SERIAL_NO,
		SYS_FLAG,
		PARTY_TYPE,
		ACTION_TYPE,
		PARTY_CODE,
		PARTY_NAME,
		STAFF_PWD,
		PARENT_ORG_ID,
		INSERT_DATE,
		DEAL_FLAG,
		DEAL_DATE,
		DESCRIPTION)
		VALUES
		(INTF.SEQ_INTF_PARTY_SN.nextval,
		#SYS_FLAG#,
		#PARTY_TYPE#,
		#ACTION_TYPE#,
		#PARTY_CODE#,
		#PARTY_NAME#,
		null,
		#PARENT_ORG_ID#,
		sysdate,
		#DEAL_FLAG#,
		sysdate,
		null)
     </insert>

	<update id="deleteChannel" parameterClass="java.lang.String">
		update crm.channel a
		set name = '（PRM删除）' || name, version = sysdate
		where a.manage_code =
		#partyId#;
     </update>

	<select id="getChannelIdSeq" resultClass="java.lang.Long">
		select
		crm.seq_channel.nextval
		from dual
     </select>

	<insert id='insertCrmChannel' parameterClass='java.util.HashMap'>
		insert into
		crm.channel c
		(CHANNEL_ID,
		NAME,
		MANAGE_CODE,
		AREA_ID,
		CHANNEL_SPEC_ID,
		CAPACITY,
		CHANNEL_STATUS_CD,
		START_DT,
		END_DT,
		OPEN_TIME,
		CLOSE_TIME,
		PARENT_CHANNEL_ID,
		DESCRIPTION,
		VERSION)
		values
		(#CHANNEL_ID#,
		#NAME#,
		#MANAGE_CODE#,
		#AREA_ID#,
		#CHANNEL_SPEC_ID#,
		#CAPACITY#,
		#CHANNEL_STATUS_CD#,
		sysdate,
		TO_DATE('3000-01-01', 'yyyy-mm-dd'),
		sysdate,
		TO_DATE('3000-01-01', 'yyyy-mm-dd'),
		#PARENT_CHANNEL_ID#,
		#DESCRIPTION#,
		sysdate);
     </insert>

	<update id="updateCrmChannel" parameterClass="java.util.HashMap">
		update crm.channel
		a
		set name = #name#, version = sysdate
		where a.manage_code =
		#manage_code#
     </update>

	<update id="storeUpdateChannel" parameterClass="java.util.HashMap">
		update
		crm.channel a
		set a.name = #name#
		where a.channel_id = #channel_id#
	</update>

	<update id="storeDeleteChannel" parameterClass="java.lang.String">
		update
		crm.channel a
		set name = '（PRM删除）' || name, version = sysdate
		where
		a.channel_id = #channel_id#
     </update>

	<insert id='insertCrmGisParty' parameterClass='java.util.HashMap'>
		Insert Into
		Crm.Gis_Party
		(Party_Id,
		Store_Name,
		Agent_Name,
		Address_Str,
		District,
		Opendate,
		Storelevel,
		Pointtype,
		Direction,
		Managerid,
		Longitude,
		Latitude,
		Storephone)
		Values
		(#Party_Id#,
		#Store_Name#,
		#Agent_Name#,
		#Address_Str#,
		#District#,
		To_Date(#Opendate#, 'yyyy/mm/dd'),
		#Storelevel#,
		#Pointtype#,
		#Direction#,
		#Managerid#,
		#Longitude#,
		#Latitude#,
		#Storephone#)
	</insert>

	<update id="updateCrmGisParty" parameterClass="java.util.HashMap">
		Update
		Crm.Gis_Party Set
		Store_Name = #Store_Name#,
		Agent_Name = #Agent_Name#,
		Address_Str = #Address_Str#,
		District = #District#,
		Opendate =
		To_Date(#Opendate#, 'yyyy/mm/dd'),
		Storelevel = #Storelevel#,
		Pointtype
		= #Pointtype#,
		Direction = #Direction#,
		Managerid = #Managerid#,
		Longitude = #Longitude#,
		Latitude = #Latitude#,
		Storephone =
		#Storephone#
		Where PARTY_ID = #PARTY_ID#
     </update>

	<select id="queryCustBrand" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		<![CDATA[
		select b.CATEGORY_NODE_ID, b.name
		  from (Select a.parent_node, a.CATEGORY_NODE_ID, a.NAME
		          From crm_app.category_node a
		         Start With a.CATEGORY_NODE_ID =
		                    (select aa.category_node_id
		                       from offer_spec_2_category_node aa, category_node bb
		                      where aa.category_node_id = bb.CATEGORY_NODE_ID
		                        and aa.offer_spec_id =
		                            (select distinct b.offer_spec_id
		                               from crm_app.offer a
		                              right join offer_spec b
		                                 on a.offer_spec_id = b.offer_spec_id
		                                and b.OFFER_TYPE_CD = 1
		                              where a.party_id = #partyId#
		                                and a.status_cd in (10, 11, 12, 13, 20, 21)
		                                and rownum = 1)
		                        and aa.category_node_id > 0
		                        and bb.CATEGORY_ID = 100
		                        and rownum < 2)
		        Connect By Prior a.PARENT_NODE = a.CATEGORY_NODE_ID) b
		 where b.parent_node is null
		 ]]>
	</select>

	<select id="queryCustLevel" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		select sg.name custLevel, sg.segment_id levelId
		from
		segment sg,
		segment_group_2_segment sgs,
		party_segment_member_list sgml
		where sgml.party_id = #partyId#
		and sgml.segment_id = sgs.segment_id
		and sg.segment_id = sgs.segment_id
		and sgs.segment_group_id in ('5',
		'8', '9')
    </select>


	<select id="queryCustSegment" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		select sg.name segmentName, sg.segment_id segmentId
		from
		segment sg,
		segment_group_2_segment sgs,
		party_segment_member_list sgml
		where sgml.party_id = #partyId#
		and sgml.segment_id = sgs.segment_id
		and sg.segment_id = sgs.segment_id
		and sgs.segment_group_id = '1'
	</select>


	<select id="qryPartyManager" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		select c.party_id partyId ,c.name name
		from party_identity
		a, party_role_party b, party c
		where a.party_id = b.party_id
		and
		b.role_party_id = c.party_id
		and a.identidies_type_cd = '13'
		and
		a.identity_num=#identityNum:varchar#
	</select>

	<select id="getBrandLevelDetail" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		 <![CDATA[select
		  p.prod_id PRODID,
       p.redu_owner_id PARTYID, 
       to_char(p.start_dt, 'yyyy-mm-dd hh24:mi:ss') INNETDATE,
       p.area_id AREAID, 
       p.redu_prod_spec_id PRODSPECID, 
       pa.name PARTYNAME,
       pa.ADDRESS_STR ADDRESSSTR,
       (select max(prod_status_cd)
          from OFFER_PROD_STATUS ps
         where ps.prod_id = p.prod_id) USERSTATUSCD, 
       pi.identity_num IDENTITYNUM,
       pi.identidies_type_cd  IDENTIDIESTYPECD, 
       (select pp.profile_value from   party_profile pp  where pp.party_profile_catg_cd = '11003' and  pp.party_id = pa.PARTY_ID and rownum <2)  POSTCODE ,
       (select pp.profile_value from   party_profile pp  where pp.party_profile_catg_cd = '1'and  pp.party_id = pa.PARTY_ID and rownum <2 )  LINKPHONE ,
       a.zip_code AREACODE, 
       (select c.name
          from Party_Segment_Member_List a,
               segment                   c,
               Segment_Group_2_Segment   b
         where a.party_Id = pa.party_id
           and a.segment_id = c.segment_id
           and b.segment_Id = a.segment_id
           and rownum < 2) PARTYTYPE ,
            (select c.segment_id
          from Party_Segment_Member_List a,
               segment                   c,
               Segment_Group_2_Segment   b
         where a.party_Id = pa.party_id
           and a.segment_id = c.segment_id
           and b.segment_Id = a.segment_id
           and rownum < 2) PARTYTYPEID ,
           '' MANAGERNAME,
           ft.name FEETYPE,
           ft.fee_type feeTypeCd
      from offer_prod p, party pa, party_identity pi,area a,offer_prod_fee_type ofee ,fee_type ft 
     where ofee.prod_id = p.prod_id and ofee.fee_type =ft.fee_type and ofee.status_cd in(10,11,12,20,13,21) 
     and pa.DEFAULT_ID_TYPE = pi.identidies_type_cd
     and a.area_id = p.area_id
     and p.redu_owner_id = pa.PARTY_ID
     and pi.party_id = pa.party_id
     and p.status_cd in(10,11,12,20,13,21)
     and rownum<2
	 and p.redu_access_number = #accNum:DECIMAL#]]>
	</select>
	<select id="queryInstStatusByCd" resultMap="statusResult"
		parameterClass="com.linkage.bss.crm.model.InstStatus">
		select
		STATUS_CD, NAME, DESCRIPTION
		from INST_STATUS
		where STATUS_CD =
		#statusCd:VARCHAR#
	</select>

	<select id="qryIfPkByPartyId" resultClass="java.util.HashMap"
		parameterClass="java.util.HashMap">
	<![CDATA[select if_pk IFPK from ctg_inst.party where  party_id = #partyId:VARCHAR# and ROWNUM < 2]]>
	</select>


	<select id="queryProdServRelas" resultClass="com.linkage.bss.crm.intf.model.ProdServRela"
		parameterClass="java.lang.Integer">
		SELECT SPR.SERV_SPEC_ID servSpecId,
		SPR.SERV_SPEC2_ID
		servSpec2Id,
		SPR.SERV_RELA_REASON_CD servRelaReasonCd,
		RT.NAME
		servRelaTypeName,
		SP.name servSpec2IdName
		FROM SERV_SPEC_RELA SPR,
		RELA_TYPE RT,SERV_SPEC SP
		WHERE SPR.SERV_SPEC_ID = #servSpecId#
		AND
		SPR.SERV_RELA_REASON_CD = RT.RELA_TYPE_CD
		AND
		SP.serv_spec_id=SPR.SERV_SPEC2_ID
	</select>
	<select id="queryOfferProdComp" resultClass="com.linkage.bss.crm.model.OfferProdComp"
		parameterClass="java.lang.Long">
		SELECT distinct OPC.PROD_COMP_ID           prodCompId,
		                OPC.COMP_PROD_ID           compProdId,
		                OPC.PROD_ID                prodId,
		                OPC.PROD_COMP_RELA_ROLE_CD prodCompRelaRoleCd
		  FROM OFFER_PROD_COMP OPC
		 WHERE OPC.PROD_COMP_ID = #prodCompId#
	</select>

	<select id="findCheckedIndentifyInfoNoPhoto" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		select count(*)
		from party_identify_extend
		where
		identify_num = #identifyValue#
		and name = #name#
		and check_from =
		#dataFrom#
	</select>

	<select id="findCheckedIndentifyInfoBack" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		<![CDATA[select photo1,address 
		from party_identify_extend 
		where identify_num= #identifyValue# 
		and name=#name# 
		and ROWNUM<2]]>
	</select>

	<select id="findCheckedIndentifyInfoNoBack" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		<![CDATA[select photo,address 
		from party_identify_extend 
		where identify_num= #identifyValue# 
		and name=#name# 
		and ROWNUM<2]]>
	</select>
	<!--查询agent2prm表 -->
	<select id="selectAgent2prm" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			 select * from AGENT_2_PRM cds where cds.agent_id = #agentId#
		]]>
   </select>
	
	<!--同步agent2prm表 -->
	<insert id="addAgent2prm" parameterClass="java.util.HashMap">
		INSERT INTO
		AGENT_2_PRM(AREA_ID,AGENT_NAME,AGENT_CODE,AGENT_TYPE,AGENT_ID,NATION_CODE,CHANNEL_TYPE,CREATE_DATE,STATE_DATE,STATE,STAFF_CODE)
		VALUES
		(11000,#agentName#,#agentCode#,#agentType#,#agentId#,'中国',#channelType#,SYSDATE,SYSDATE,'1',#staffCode#)
	</insert>
	<update id="updateAgent2prm" parameterClass="java.util.HashMap">
		UPDATE AGENT_2_PRM SET STATE_DATE = SYSDATE
		<dynamic>
		<isNotNull property="agentName" prepend=",">
				AGENT_NAME=#agentName#
		</isNotNull>
		<isNotNull property="agentType" prepend=",">
				AGENT_TYPE=#agentType#
		</isNotNull>
		<isNotNull property="agentAddr" prepend=",">
				ADDRESS_ID =#agentAddr#
		</isNotNull>
		<isNotNull property="channelType" prepend=",">
				CHANNEL_TYPE
				=#channelType# 
		</isNotNull>
		<isNotNull property="staffCode" prepend=",">
				STAFF_CODE
				=#staffCode# 
		</isNotNull>
		</dynamic>
		where AGENT_ID=#agentId#
	</update>
	
	<update id="updateAgent2prmManager" parameterClass="java.util.HashMap">
		UPDATE AGENT_2_PRM SET STATE_DATE = SYSDATE,STAFF_CODE=#staffCode#
		where AGENT_ID=#mailAddressId#
	</update>
	<delete id="deleteAgent2prm" parameterClass="java.util.HashMap">
		DELETE FROM
		AGENT_2_PRM WHERE AGENT_ID=#agentId#
	</delete>
	<!-- 同步CRM.channel表 -->
	<insert id="addChannelForCrm" parameterClass="java.util.HashMap">
		insert into channel
		(CHANNEL_ID,
		NAME,
		MANAGE_CODE,
		AREA_ID,
		CHANNEL_SPEC_ID,
		CAPACITY,
		CHANNEL_STATUS_CD,
		START_DT,
		END_DT,
		OPEN_TIME,
		CLOSE_TIME,
		PARENT_CHANNEL_ID,
		DESCRIPTION,
		VERSION,
		CHANNEL_TYPE_CD,
		CHANNEL_SUBTYPE_CD,
		CHANNEL_LEVEL_CD,
		CHANNEL_NBR,
		STATUS_CD)
		values
		(#channelIdSeq#,
		#agentName#,
		#partyId#,
		11000,
		#channelSpecId#,
		1000,
		1,
		sysdate,
		TO_DATE('3000-01-01', 'yyyy-mm-dd'),
		sysdate,
		TO_DATE('3000-01-01',
		'yyyy-mm-dd'),
		#parentChannelId#,
		#agentName#,
		sysdate,
		1100,
		100100,
		10,
		00011000000000,
		1000
		)
	</insert>
	<update id="updateChannelForCrm" parameterClass="java.util.HashMap">
		update channel a
		set a.name = #storeName#, version = SYSDATE
		where a.manage_code = #partyId#
	</update>
	<delete id="deleteChannelForCrm" parameterClass="java.util.HashMap">
		update channel a
		set name = '(PRM删除)' || name, version = sysdate
		where a.manage_code = #partyId#
	</delete>
	<!-- 针对网点的处理 -->
	<update id="updateWDChannelForCrm" parameterClass="java.util.HashMap">
		update channel
		a
		set a.name = #storeName#
		where a.channel_id = #channelId#
	</update>
	<update id="deleteWDChannelForCrm" parameterClass="java.util.HashMap">
		update channel
		a
		set name = '(PRM删除)' || name, version = sysdate
		where a.channel_id =
		#channelId#
	</update>
	<!--针对CEP_CHANNEL 的处理 -->
	<insert id="insertCepChannelFromPrmToCrm" parameterClass="java.util.HashMap">
		insert
		into cep_channel(channel_id,channel_type,agent_code) values
		(#channelId#,#channelType#,#agentCode#)
	</insert>
	<update id="updateCepChannelFromPrmToCrm" parameterClass="java.util.HashMap">
		update
		cep_channel set channel_type =#channelType# , agent_code =#agentCode#
		where channel_id =#channelId#
	</update>
	<update id="deleteCepChannelFromPrmToCrm" parameterClass="java.util.HashMap">
		delete
		from cep_channel where channel_id =#channelId#
	</update>
	<select id="selectPartyInfoFromSmParty" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select t.party_id partyId, t.name
		from SM.party t
		where
  		 <![CDATA[ROWNUM < 2 ]]>
		<dynamic>
			<isNotEmpty property="partyId" prepend="AND">
				t.party_id =
				#partyId#
		</isNotEmpty>
			<isNotEmpty property="mailAddressId" prepend="AND">
				t.mail_address_id =
				#mailAddressId#
		</isNotEmpty>
		</dynamic>
		order by create_dt desc
	</select>
	<select id="queryAttachOfferByProd" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		<![CDATA[
			SELECT OS.offer_spec_id offerSpecId, OS.name offerSpecName
			  FROM SPEC.OFFER_ROLES         OO,
			       SPEC.REQ_OBJ_RELA        RR,
			       SPEC.ROLE_OBJ_2_CFG_RULE ROR,
			       SPEC.OFFER_SPEC          OS
			 WHERE OO.OFFER_ROLE_ID = ROR.OFFER_ROLE_ID
			   AND RR.CFG_RULE_ID = ROR.CFG_RULE_ID
			   AND RR.RELA_TYPE_CD = 23
			   AND OS.OFFER_SPEC_ID = RR.OBJ_ID
			   AND OO.OFFER_SPEC_ID = #offerSpecId:DECIMAL#
			UNION 
			SELECT OS.offer_spec_id offerSpecId, OS.name offerSpecName
			  FROM SPEC.OFFER_SPEC_RELA A, SPEC.OFFER_SPEC OS
			 WHERE A.RELA_OFFER_SPEC_ID = OS.OFFER_SPEC_ID
			   AND A.RELA_TYPE_CD = 100000
			   AND A.OFFER_SPEC_ID = #offerSpecId:DECIMAL#
			UNION
			SELECT OS.offer_spec_id offerSpecId, OS.name offerSpecName
			  FROM PROD.PROD_SPEC              PS,
			       PROD.SSPEC_COMP_GRP         SCG,
			       PROD.SSPEC_COMP_GRP_2_SSPEC SCGS,
			       PROD.SERV_SPEC              SS,
			       OFFER_ROLES                 ORS,
			       ROLE_OBJ                    RO,
			       OFFER_SPEC                  OS
			 WHERE SCG.SSPEC_COMP_GRP_ID IN
			       (SELECT SSPEC_COMP_GRP_ID
			          FROM PROD.SSPEC_COMP_GRP
			         WHERE SSPEC_COMP_GRP_ID IN
			               (SELECT SSPEC_COMP_GRP_ID
			                  FROM PROD.SSPEC_COMP_GRP_RELA
			                 START WITH SSPEC_COMP_GRP_ID = PS.SSPEC_COMP_GRP_ID
			                CONNECT BY SSPEC_COMP_SUB_ID = SSPEC_COMP_GRP_ID)
			            OR SSPEC_COMP_GRP_ID IN
			               (SELECT SSPEC_COMP_SUB_ID
			                  FROM PROD.SSPEC_COMP_GRP_RELA
			                 START WITH SSPEC_COMP_GRP_ID = PS.SSPEC_COMP_GRP_ID
			                CONNECT BY PRIOR SSPEC_COMP_SUB_ID = SSPEC_COMP_GRP_ID)
			            OR SSPEC_COMP_GRP_ID = PS.SSPEC_COMP_GRP_ID)
			   AND SCG.SSPEC_COMP_GRP_ID = SCGS.SSPEC_COMP_GRP_ID
			   AND SCGS.SERV_SPEC_ID = SS.SERV_SPEC_ID
			   AND ORS.OFFER_ROLE_ID = RO.OFFER_ROLE_ID
			   AND RO.OBJ_ID = SS.SERV_SPEC_ID
			   AND ORS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
			   AND PS.PROD_SPEC_ID = #prodSpecId:DECIMAL#
			   AND (SCGS.MIN_QTY = 1 OR SCGS.DEFAULT_QTY = 1)
		]]>
	</select>
	<select id ="queryAttachOfferByProdIdForPad" parameterClass="java.lang.Long" resultMap="attachOfferDtoResultMap">
		<![CDATA[
		SELECT O.OFFER_SPEC_ID AS OFFERSPECID,
		       OSPEC.NAME 
		       ||(SELECT osi.value FROM offer_serv_item osi 
					WHERE osi.status_cd IN ('10','11','12','13','21')
					AND osi.item_spec_id = 17028 
					AND os.serv_id = osi.serv_id)  
		       AS OFFERSPECNAME,
		       O.OFFER_ID AS OFFERID,
			   OM.OFFER_MEMBER_ID AS OM_OFFERMEMBERID,
		       OM.OFFER_ID AS OM_OFFERID,
		       OM.OFFER_ROLE_ID AS OFFERROLEID,
		       OM.OBJ_TYPE AS OBJTYPE,
		       OM.MEMBER_ID AS MEMBERID,
		       O.START_DT AS STARTDT,
		       O.END_DT AS ENDDT,
		       O.STATUS_CD AS STATUSCD,
		       O.STATUS_DT AS STATUSDT,
		       OS.SERV_SPEC_ID AS SERVSPECID,
		       'SERV' AS OFFERSPECFLAG,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = OS.ATOM_ACTION_ID) AS OS_ATOMACTIONID,
		       O.ATOM_ACTION_ID AS ATOMACTIONID,
		       O.STATUS_CD AS OSTATUSCD,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = O.ATOM_ACTION_ID) AS BOID
		  FROM OFFER_MEMBER OM, OFFER_SERV OS, OFFER_SPEC OSPEC, OFFER O
		 WHERE OM.OFFER_ID = O.OFFER_ID
		   AND OM.MEMBER_ID = OS.SERV_ID
		   AND OM.OBJ_TYPE = 4
		   AND OSPEC.OFFER_SPEC_ID = O.OFFER_SPEC_ID
		   AND OM.STATUS_CD IN ('10','11','12','13','21')
		   AND O.STATUS_CD IN ('10','11','12','13','21')
		   AND OS.STATUS_CD IN ('10','11','12','13','21')
		   AND OS.SERV_ID IN (SELECT OS.SERV_ID
		                        FROM OFFER_SERV OS
		                       WHERE OS.STATUS_CD IN ('10','11','12','13','21')
		                         AND OS.PROD_ID = #prodId#)
		   AND OSPEC.OFFER_TYPE_CD = 2
		]]>		   
		<![CDATA[			      
		UNION
		SELECT O.OFFER_SPEC_ID AS OFFERSPECID,
		       OSPEC.NAME AS OFFERSPECNAME,
		       O.OFFER_ID AS OFFERID,
			   OM.OFFER_MEMBER_ID AS OM_OFFERMEMBERID,
		       OM.OFFER_ID AS OM_OFFERID,
		       OM.OFFER_ROLE_ID AS OFFERROLEID,
		       OM.OBJ_TYPE AS OBJTYPE,
		       OM.MEMBER_ID AS MEMBERID,
		       O.START_DT AS STARTDT,
		       O.END_DT AS ENDDT,
		       O.STATUS_CD AS STATUSCD,
		       O.STATUS_DT AS STATUSDT,
		       NULL AS SERVSPECID,
		       'PROD' AS OFFERSPECFLAG,
		       NULL AS OS_ATOMACTIONID,
		       O.ATOM_ACTION_ID AS ATOMACTIONID,
		       O.STATUS_CD AS OSTATUSCD,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = O.ATOM_ACTION_ID) AS BOID
		  FROM OFFER_MEMBER OM, OFFER_SPEC OSPEC, OFFER O, OFFER_PROD OP
		 WHERE OM.OFFER_ID = O.OFFER_ID
		   AND OM.OBJ_TYPE = 2
		   AND OM.MEMBER_ID = OP.PROD_ID
		   AND OSPEC.OFFER_SPEC_ID = O.OFFER_SPEC_ID
		   AND OM.STATUS_CD IN ('10','11','12','13','21')
		   AND O.STATUS_CD IN ('10','11','12','13','21')
		   AND OP.PROD_ID = #prodId#
		   AND OSPEC.OFFER_TYPE_CD = 2	
		]]>
	</select>
	<select id ="queryAttachOfferInfo" parameterClass="java.lang.Long" resultMap="attachOfferDtoResultMap">
		<![CDATA[
		SELECT O.OFFER_SPEC_ID AS OFFERSPECID,
		       OSPEC.NAME 
		       ||(SELECT osi.value FROM offer_serv_item osi 
					WHERE osi.status_cd IN ('22')
					AND osi.item_spec_id = 17028 
					AND os.serv_id = osi.serv_id)  
		       AS OFFERSPECNAME,
		       O.OFFER_ID AS OFFERID,
			   OM.OFFER_MEMBER_ID AS OM_OFFERMEMBERID,
		       OM.OFFER_ID AS OM_OFFERID,
		       OM.OFFER_ROLE_ID AS OFFERROLEID,
		       OM.OBJ_TYPE AS OBJTYPE,
		       OM.MEMBER_ID AS MEMBERID,
		       O.START_DT AS STARTDT,
		       O.END_DT AS ENDDT,
		       O.STATUS_CD AS STATUSCD,
		       O.STATUS_DT AS STATUSDT,
		       OS.SERV_SPEC_ID AS SERVSPECID,
		       'SERV' AS OFFERSPECFLAG,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = OS.ATOM_ACTION_ID) AS OS_ATOMACTIONID,
		       O.ATOM_ACTION_ID AS ATOMACTIONID,
		       O.STATUS_CD AS OSTATUSCD,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = O.ATOM_ACTION_ID) AS BOID
		  FROM OFFER_MEMBER OM, OFFER_SERV OS, OFFER_SPEC OSPEC, OFFER O
		 WHERE OM.OFFER_ID = O.OFFER_ID
		   AND OM.MEMBER_ID = OS.SERV_ID
		   AND OM.OBJ_TYPE = 4
		   AND OSPEC.OFFER_SPEC_ID = O.OFFER_SPEC_ID
		   AND OM.STATUS_CD IN ('22')
		   AND O.STATUS_CD IN ('22')
		   AND OS.STATUS_CD IN ('22')
		   AND OS.SERV_ID IN (SELECT OS.SERV_ID
		                        FROM OFFER_SERV OS
		                       WHERE OS.STATUS_CD IN ('22')
		                         AND OS.PROD_ID = #prodId#)
		   AND OSPEC.OFFER_TYPE_CD = 2
		]]>		   
		<![CDATA[			      
		UNION
		SELECT O.OFFER_SPEC_ID AS OFFERSPECID,
		       OSPEC.NAME AS OFFERSPECNAME,
		       O.OFFER_ID AS OFFERID,
			   OM.OFFER_MEMBER_ID AS OM_OFFERMEMBERID,
		       OM.OFFER_ID AS OM_OFFERID,
		       OM.OFFER_ROLE_ID AS OFFERROLEID,
		       OM.OBJ_TYPE AS OBJTYPE,
		       OM.MEMBER_ID AS MEMBERID,
		       O.START_DT AS STARTDT,
		       O.END_DT AS ENDDT,
		       O.STATUS_CD AS STATUSCD,
		       O.STATUS_DT AS STATUSDT,
		       NULL AS SERVSPECID,
		       'PROD' AS OFFERSPECFLAG,
		       NULL AS OS_ATOMACTIONID,
		       O.ATOM_ACTION_ID AS ATOMACTIONID,
		       O.STATUS_CD AS OSTATUSCD,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = O.ATOM_ACTION_ID) AS BOID
		  FROM OFFER_MEMBER OM, OFFER_SPEC OSPEC, OFFER O, OFFER_PROD OP
		 WHERE OM.OFFER_ID = O.OFFER_ID
		   AND OM.OBJ_TYPE = 2
		   AND OM.MEMBER_ID = OP.PROD_ID
		   AND OSPEC.OFFER_SPEC_ID = O.OFFER_SPEC_ID
		   AND OM.STATUS_CD IN ('22')
		   AND O.STATUS_CD IN ('22')
		   AND OP.PROD_ID = #prodId#
		   AND OSPEC.OFFER_TYPE_CD = 2
		]]>
	</select>
	
	<select id="queryChargeInfo" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT OFS.name OFFER_NAME,
		BA.OL_ID,
		BA.ACCT_ITEM_ID,
		BA.ACCT_ITEM_TYPE_ID,
		BA.ACCT_ITEM_TYPE_NAME,
		BA.CHARGE,
		BA.BO_ID,
		BA.APP_CHARGE,
		SPS.name SERV_NAME
		FROM BAM_ACCT_ITEM_INFO BA
		left join
		OFFER_SPEC OFS
		on BA.OFFER_ID = OFS.offer_spec_id
		left join serv_spec
		SPS
		on BA.SERV_ID = SPS.serv_spec_id
		WHERE BA.OL_ID = #ol_id#
		AND
		ba.state = 'C0C'
	</select>
	
		<select id="queryChargeInfoBySpec" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
	    select d.name      OFFER_NAME,
          b.charge_item_id ACCT_ITEM_TYPE_ID,
          c.name           ACCT_ITEM_TYPE_NAME,
          b.charge         CHARGE,
          b.charge         APP_CHARGE,
          a.offer_spec_id  SPEC_ID
        from offer_action_price a, charge_plan b, charge_item c, offer_spec d
        where a.default_charge_plan_id = b.charge_plan_id
        and b.charge_item_id = c.charge_item_cd
        and a.offer_spec_id = d.offer_spec_id
        and a.bo_action_type_cd = 'S1'
        and exists (select 1
            from CTG_SPEC.NUMBER_LEV_2_OFFER_SPEC ns
            where ns.prod_offer_id = a.offer_spec_id
            union all
            select 1
            from spec.offer_spec_2_category_node oe
            where oe.category_node_id = -2010002
            and oe.offer_spec_id = a.offer_spec_id)
       and a.offer_spec_id in ($offerSpecId$)
	</select>
	<select id="getChannelIdByPartyId" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select channel_id channelId from channel where
		manage_code = #partyId#
	</select>
	<select id="getAccessNumberByUimNo" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select p.access_number mdn, pP.name state
		from
		offer_prod_2_td t,
		offer_prod_number p,
		resource_status pP,
		phone_number
		y
		where t.prod_id = p.prod_id
		and p.an_type_cd = 103
		and t.status_cd in
		(10,11,12,13)
		and p.access_number
		= y.phone_number
		and y.rsc_status_cd =
		pP.rsc_status_cd
		and
		t.terminal_code = #uimNo#
	</select>
	
	<select id="queryFreeOfBank" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select a.unfreeze_date,
       a.freeze_money,
       a.freeze_sub_acctno,
       a.party_identitytype,
       a.freeze_date,
       a.party_identityno,
       a.party_name,
       a.freeze_acctno
  from crm.freezerent a
 where a.bank_type = '105'
   and a.freeze_no = #freezeNo#
	</select>
	<select id="getSaComponentInfo" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
	  select a.service_id,
       a.service_name,
       a.service_type_id,
       a.manager_id,
       a.link_man,
       a.link_nbr,
       a.service_party_id,
       a.building_id,
       a.building_type,
       a.status_cd
       from sa_2_component a
        where a.service_id=#serviceId#	
	</select>
	<select id="checkUIMChannelId" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select count(1)
        from crm.channel_2_store a, sr.store_detail b
        where a.store_id = b.STORE_ID
          and b.BCD_CODE = #bcdCode#
          and a.channel_id = #channelId#
	</select>
	
	<select id="checkGoupUIM" parameterClass="java.util.HashMap" resultClass="java.lang.String">
		select count(1) 
		FROM sr.mkt_res_inst a 
		where a.Mkt_Res_Inst_Code = #bcdCode#
	</select>
	
		<select id="checkUIMStore" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select count(1)
        from crm.channel_2_store a, sr.store_detail b
        where a.store_id = b.STORE_ID
          and b.BCD_CODE = #bcdCode#
          and a.channel_id = #channelId#
	   </select>
	
	
	
	<select id="getUserZJInfoByAccessNumber" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select t.offer_id, t.end_dt ,t.start_dt startDt, b.*
		from offer_spec b,
		offer a, offer_member t, offer_prod_number c
		where a.offer_spec_id =
		b.offer_spec_id
		and c.status_cd in (10,11,12,13,20,21)
		and t.status_cd in
		(10,11,12,13,20,21)
		and c.access_number = #accNum:varchar#
		and
		b.offer_type_cd
		= '2'
		and t.offer_id = a.offer_id
		and t.member_id =
		c.prod_id
		and
		b.offer_spec_id in
		(select t.offer_spec_id
		from
		spec.offer_spec_2_category_node t
		where t.category_node_id = -2010002)
		and 	<![CDATA[t.end_dt > SYSDATE and rownum < 2]]>
	</select>
	<!--移动网点信息处理-->
	<insert id="insertAgentOrAgentPointInfo" parameterClass="java.util.HashMap">
		Insert
		Into Gis_Party
		(Party_Id,
		Store_Name,
		Agent_Name,
		Address_Str,
		District,
		openDate,
		storeLevel,
		pointType,
		Direction,
		managerId,
		Longitude,
		Latitude,
		storePhone,
		SYS_FLAG,
		STATE)
		Values
		(#partyId#,
		#storeName#,
		#agentName#,
		#addressStr#,
		#district#,
		To_Date(#openDate#, 'YYYY/MM/DD'),
		#storeLevel#,
		#pointType#,
		#direction#,
		#managerId#,
		decode(#longitude#,null,Null,to_number(#longitude#,'9999.99999999')),
		decode(#latitude#,null,Null,to_number(#latitude#,'9999.99999999')),
		#storePhone#,
		'PRM',
		'A'
		)
   </insert>
	<update id="updateAgentOrAgentPointInfoByPartyId"
		parameterClass="java.util.HashMap">
		Update Gis_Party
		<dynamic prepend="set">
			<isNotNull property="storeName" prepend=",">
				Store_Name =
				#storeName#
   </isNotNull>
			<isNotNull property="agentName" prepend=",">
				Agent_Name =
				#agentName#
   </isNotNull>
			<isNotNull property="location" prepend=",">
				Address_Str =
				#location#
    </isNotNull>
			<isNotNull property="district" prepend=",">
				District =
				#district#
      </isNotNull>
			<isNotNull property="openDate" prepend=",">
				openDate =
				To_Date(#openDate#, 'YYYY/MM/DD')
      </isNotNull>
			<isNotNull property="storeLevel" prepend=",">
				storeLevel =
				#storeLevel#
      </isNotNull>
			<isNotNull property="pointType" prepend=",">
				pointType =
				#pointType#
      </isNotNull>
			<isNotNull property="direction" prepend=",">
				Direction =
				#direction#
      </isNotNull>
			<isNotNull property="managerId" prepend=",">
				managerId =
				#managerId#
      </isNotNull>
			<isNotNull property="longitude" prepend=",">
				Longitude =
				decode(#longitude#,null,Null,to_number(#longitude#,'9999.99999999'))
			</isNotNull>
			<isNotNull property="latitude" prepend=",">
				Latitude =
				decode(#latitude#,null,Null,to_number(#latitude#,'9999.99999999'))
			</isNotNull>
			<isNotNull property="storePhone" prepend=",">
				storePhone =
				#storePhone#
      </isNotNull>
		</dynamic>
		Where PARTY_ID = #partyId#
	</update>
	<update id="updateAgentOrAgentPointNameByPartyId"
		parameterClass="java.util.HashMap">
		Update Gis_Party Set
		Store_Name = '(PRM删除)'
		||#storeName#,
		STATE = 'X'
		Where PARTY_ID = #partyId#
   </update>

	<select id="queryOfferSpecAttr" parameterClass="java.lang.Long"
		resultClass="java.lang.String">
		SELECT OSA.ITEM_SPEC_ID
		FROM OFFER_SPEC_ATTR OSA
		WHERE
		OSA.OFFER_SPEC_ID = #offerSpecId#
   </select>

	<select id="queryOfferSpecValueParam" parameterClass="java.lang.Long"
		resultClass="java.lang.String">
		SELECT CP.CHARGE
		FROM OFFER_ACTION_PRICE OAP,
		SPEC.CHARGE_PLAN CP
		WHERE OAP.DEFAULT_CHARGE_PLAN_ID =
		CP.CHARGE_PLAN_ID
		AND OAP.BO_ACTION_TYPE_CD = 'S1'
		AND OAP.OFFER_SPEC_ID
		= #offerSpecId#
	</select>

	<select id="getStatusList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		select t.name, s.prod_status_cd
		from offer_prod_status s,
		prod_status_type t
		where s.prod_status_cd = t.prod_status_cd
		and prod_id
		=#prod_id#
	</select>

	<select id="getAcctList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT B.ACCT_CD, B.ACCT_ID
		FROM OFFER_PROD_ACCOUNT A,
		ACCOUNT B
		WHERE A.ACCT_ID = B.ACCT_ID
		AND A.PROD_ID =#prod_id#
	</select>

	<select id="getManagerList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT B.STAFF_NUMBER, A.PARTY_ID
		FROM PARTY_2_PROD A,
		STAFF_NUMBER B
		WHERE A.PARTY_ID = B.STAFF_ID
		AND
		A.PARTY_PRODUCT_RELA_ROLE_CD = 6
		AND A.PROD_ID =#prod_id#
	</select>

	<select id="getManagerToList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT B.STAFF_NUMBER, B.STAFF_ID
		FROM PARTY_ROLE_PARTY
		A,STAFF_NUMBER B
		WHERE A.ROLE_PARTY_ID = B.STAFF_ID
		AND
		A.PARTY_ROLE_TYPE_CD = 30
		AND A.PARTY_ID =#owner_id#
	</select>

	<select id="getDevList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT B.STAFF_NUMBER, A.Staff_Id as PARTY_ID
        FROM crm_app.offer_prod_2_staff A,  
        crm_app.STAFF_NUMBER B
        WHERE A.Staff_Id = B.STAFF_ID
        AND A.PARTY_RELA_ROLE_CD = 11
		AND A.PROD_ID =#prod_id#
	</select>

	<select id="getDevNameList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT A.NAME FROM PARTY A WHERE A.PARTY_ID =#party_id#
	</select>

	<select id="getDevTelList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT A.PROFILE_VALUE
		FROM PARTY_PROFILE A
		WHERE
		A.PARTY_PROFILE_CATG_CD = 44
		AND A.PARTY_ID =#party_id#
	</select>

	<select id="getDevOrgIdList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT A.ORG_ID FROM STAFF_NUMBER A WHERE
		A.STAFF_ID=#party_id#
	</select>

	<select id="getAcctItemList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT A.VALUE
		FROM ACCOUNT_ITEM A
		WHERE A.ITEM_SPEC_ID =
		333342
		AND A.ACCT_ID =#acct_id#
	</select>

	<select id="getTelList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		SELECT A.VALUE
		FROM ACCOUNT_ITEM A
		WHERE A.ITEM_SPEC_ID IN
		(363341, 363342)
		and A.ACCT_ID =#acct_id#
	</select>

	<select id="getWxList" parameterClass="java.lang.Long"
		resultClass="java.util.HashMap">
		select item_spec_id, value
		from offer_prod_item a
		where
		item_spec_id in (1000003, 1000004)
		and a.prod_id=#prod_id#
	</select>
	<!-- 登录设备有效性验证 -->
	<select id="checkDeviceIdInLogin" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select a.state
		from SM.staff_number s, pad_pwd a,
		pad_pwd_staff b
		where s.staff_number = b.staff_number
		and
		s.staff_status_cd = 1
		and a.serial_no = b.serial_no(+)
		and a.serial_no =
		#serialNo#
	</select>
	<update id="updatePadPwdInLogin" parameterClass="java.util.HashMap">
		update pad_pwd
		<dynamic prepend="set">
			<isNotNull property="loginRandom" prepend=",">
				login_random =
				#loginRandom# 
	 </isNotNull>
			<isNotNull property="state" prepend=",">
				state=#state#
			</isNotNull>
			<isNotNull property="resetRandom" prepend=",">
				reset_random=#resetRandom#
	 </isNotNull>
		</dynamic>
		where serial_no = #serialNo#
	</update>

	<!-- 随机数校验 -->
	<select id="checkSnPwdInLogin" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select PP.real_no, PP.login_random, PPS.serial_no,
		PPS.staff_number,PPS.access_number ,PP.state
		from pad_pwd PP,
		pad_pwd_staff PPS
		where PP.serial_no=PPS.serial_no
		<isEqual property="operType" compareValue="3" prepend="AND">
			PPS.staff_number=upper(#serialNo#)
        </isEqual>
		<isNotEqual property="operType" compareValue="3" prepend="AND">
			PPS.serial_no=#serialNo#
       </isNotEqual>
	</select>
	<insert id="insertPadPwdLog" parameterClass="java.util.HashMap">
		insert into
		pad_pwd_log
		(serial_no,
		staff_number,
		state,
		oper_date,
		oper_staff,
		oper_type,
		sys_flag)
		values
		(#serialNo#, upper(#staffNumber#), #state#, SYSDATE
		, upper(#staffNumber#),#operType#, '0')
	</insert>
	<select id="checkSnPwd4SelectStaffInfoByStaffNumber"
		parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT SN.ORG_ID,
		SN.STAFF_ID,
		P1.NAME STAFF_NAME,
		SN.staff_number,
		P2.NAME ORG_NAME
		FROM
		SM.STAFF_NUMBER SN, PARTY P1, PARTY P2
		WHERE SN.STAFF_ID = P1.PARTY_ID
		AND SN.ORG_ID = P2.PARTY_ID
		AND SN.STAFF_STATUS_CD = 1
		AND
		SN.STAFF_NUMBER = upper(#staffNumber#)
     </select>
	<select id="checkSnPwd4SelectChannelInfoByPartyId"
		parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT B.channel_id,
		B.name
		FROM PARTY_2_CHANNEL A, CHANNEL B
		WHERE
		A.channel_id =
		B.channel_id
		AND A.PARTY_CHANNEL_RELA_ROLE_CD = 1
		AND
		B.channel_status_cd = 1
		AND A.PARTY_ID = #partyId#
     </select>

	<!-- 设备同步随机数 -->
	<select id="transmitRandom4SelectStaffInfoByDeviceId"
		parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		select staff_number,
		access_number
		from pad_pwd_staff
		where serial_no = #serialNo#
     </select>
	<insert id="insertSmsWaitSendCrmSomeInfo" parameterClass="java.util.HashMap">
		<selectKey resultClass="int" type="pre" keyProperty="id">
			SELECT
			CRM.SEQ_SMS_ID.NEXTVAL AS VALUE FROM DUAL  
	</selectKey>
		INSERT INTO crm.SMS_INFO
		(ID,
		MSISDN,
		FLAG,
		MSG,
		STS,
		GET_DATE,
		REMIND_TYPE_CODE)
		values
		( #id#,
		#accessNumber#, 'SEND','pad耳机密码重置为'||#random#, 'A', SYSDATE,'CRM118')
	</insert>
	<!--设备有效性校验-->
	<select id="getStaffCodeAndStaffName" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select p.name
		from SM.staff_number s, party p
		where
		s.staff_id = p.party_id
		and s.staff_number = upper(#staffNumber#)
	</select>

	<insert id='saveOCS' parameterClass='java.util.HashMap'>
		INSERT INTO
		INTF.OCS_RENT_DEAL(ACTIVITYID, filename, SERVID, PRODUCTCODE,
		APPLYTIME, CREATETIME)
		VALUES(seq_OCS_RENT_DEAL.Nextval, #fileName#,
		#servId#, #productCode#, #applyTime#, SYSDATE)
	</insert>

	<select id="getPartyIdentifyDetailss" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		SELECT
		RESULTCODE,GENDER,BIRTHDAY,NATIONALITY,ADDRESS,SIGNUNIT,DEGREE,CAREER,ADDRESSCODE,ADDRESSCOUNT
		FROM PARTY_IDENTIFY_EXTEND
		WHERE IDENTIFY_NUM = #identifyValue#
		AND NAME
		= #name#
		ORDER BY CHECK_FROM DESC
     </select>

	<select id="oldCGFlag" parameterClass="java.lang.String"
		resultClass="java.lang.String">
		select b_rule_id
		from spec.rule_code_2_offer_spec rc
		where
		rc.b_rule_id = 20045
		and rc.code = 'CRMBJ0022'
		and rc.state = 1
		and
		offer_spec_id = #materialId#
     </select>

	<select id="queryOfferSpecParam" parameterClass="java.lang.String"
		resultMap="offerSpecParamResultMap">
		select osp.offer_spec_param_id OFFER_SPEC_PARAM_ID,
		osp.offer_spec_id OFFER_SPEC_ID,
		osp.item_spec_id ITEM_SPEC_ID,
		osp.name PARAM_NAME
		from offer_spec_param osp
		where
		osp.offer_spec_param_id = #offerSpecParamId#
 	 </select>

	<select id="queryMainOfferSpecNameAndIdByOlId" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		select d.offer_spec_id,d.name
		from order_list a, busi_order b,
		offer_order c, offer_spec d
		where a.ol_id = b.ol_id
		and b.bo_id =
		c.bo_id
		and c.offer_spec_id = d.offer_spec_id
		and d.offer_type_cd = 1
     <![CDATA[ and ROWNUM < 2]]>
		and a.ol_id=#olId#
	</select>

	<select id="queryIfPk" parameterClass="java.lang.Long"
		resultClass="java.lang.Integer">
		select pp.if_pk
		from ctg_inst.party pp
		where pp.party_id = #partyId#
 	 </select>

	<select id="getPartyIdByGroupSeq" parameterClass="java.lang.String"
		resultClass="java.lang.String">
 	 <![CDATA[
 	    SELECT c.party_id 
 	    FROM ctg_inst.cust c 
 	    WHERE c.group_cust_seq = #groupSeq#
 	    AND ROWNUM < 2
 	    ]]>
	</select>

	<select id="getOlNbrByOlId" parameterClass="java.lang.Long"
		resultClass="java.lang.String">
		select ol_nbr from order_list where ol_id =#olId#
 	 </select>

	<select id="getGroupSeqByPartyId" parameterClass="java.lang.String"
		resultClass="java.lang.String">
 	 <![CDATA[
 	    SELECT PI.IDENTITY_NUM
        FROM PARTY_IDENTITY PI
        WHERE PI.IDENTIDIES_TYPE_CD = '13'
        AND PI.PARTY_ID = #partyId#
 	    AND ROWNUM < 2
 	    ]]>
	</select>

	<select id="getAnTypeCdByProdSpecId" parameterClass="java.util.HashMap"
		resultClass="java.lang.String">
 	 <![CDATA[
 	    SELECT A.AN_TYPE_CD
  		FROM PROD_SPEC_2_ACCESS_NUM_TYPE A
 		WHERE A.PROD_SPEC_ID = #prodSpecId#
  		AND A.IS_PRIMARY = #isPrimary#
 	    AND ROWNUM < 2
 	    ]]>
	</select>
	
	<insert id="insertServActivate" parameterClass="java.util.HashMap">
		INSERT INTO
		B_SERV_ACTIVATE(OPER_ID,SERV_ID,ACTIVATE_TYPE,ACTIVATE_DATE,ACCESS_NUMBER,OUTER_SEQUENCE,BILLING_MODE,STATE_DATE,CREATED_DATE)
		VALUES
		(SEQ_B_SERV_A_OPER_ID.nextval,#servId#,#activateType#,#activateDate#,#accNbr#,#sequence#,#billingMode#,SYSDATE,SYSDATE)
	</insert>

	<insert id="insertServActivatePps" parameterClass="java.util.HashMap">
		INSERT INTO
		B_SERV_ACTIVATE_PPS(OPER_ID,SERV_ID,MANAGE_CODE,START_DATE,END_DATE,STATE_DATE,CREATED_DATE)
		VALUES
		(SEQ_B_SERV_A_PPS_OPER_ID.nextval,#servId#,#manageCode#,#startDate#,#endDate#,SYSDATE,SYSDATE)
	</insert>
	
	<select id="getPayIndentIdByBcdCode" parameterClass="java.lang.String"
		resultClass="java.lang.String">
 	 <![CDATA[
 	    SELECT  US.PAYINDENTID 
		FROM    UNITYPAY_SR US 
		WHERE   US.BCD_CODE = #bcdCode#
 	    AND ROWNUM < 2
 	    ]]>
	</select>
	
	<insert id="savePayIndentId" parameterClass="java.util.HashMap">
 	    INSERT INTO unityPay_sr (Unitypay_Sr_Id, Bcd_Code, Payindentid)
		VALUES(SEQ_UNITYPAY_SR_INTF.NEXTVAL, #bcdCode#, #payIndentId#)
	</insert>
	
	<select id="queryCategoryNodeId" parameterClass="java.lang.Long"
		resultClass="java.lang.Long">
		select os2cn.category_node_id
		  from offer_spec_2_category_node os2cn, category_node cn, category cg
		 where os2cn.category_node_id = cn.CATEGORY_NODE_ID
		   and cg.category_id = cn.CATEGORY_ID
		   and cg.category_id=100
		   and os2cn.offer_spec_id = #offerSpecId#
	</select>	

	<select id="queryIfRootNode" parameterClass="java.lang.Long" resultClass="java.lang.Long">
		select a.PARENT_NODE from category_node a where a.CATEGORY_NODE_ID=#categoryNodeId#
 	</select>
 	
 	<select id="queryUimNum" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	  <![CDATA[ select * from (
	    select distinct d.start_dt,
	                    a.prod_id,
	                    a.access_number,
	                    b.party_id,
	                    c.redu_prod_spec_id,
	                    b.Name,
	                    d.terminal_code
	      from crm_app.offer_prod_number a, crm_app.party b, crm_app.offer_prod c, crm_app.offer_prod_2_td d
	     where a.prod_id = c.prod_id
	       and a.status_cd in (10, 11, 12, 13)
	       and d.status_cd in (10, 11, 12, 13)
	       and a.prod_id = d.prod_id(+)
	       and c.redu_owner_id = b.party_id(+)
	       and a.access_number = #phoneNumber#
	       order by d.start_dt desc) where rownum =1]]>
 	</select>
 	
 	<select id="getPartyIdentityList" parameterClass="java.lang.String" resultClass="java.util.HashMap">
 	   select i.identidies_type_cd type, it.name, i.identity_num value
  from party_identity i, identify_type it
 where i.identidies_type_cd = it.identidies_type_cd
   and i.party_id = #partyId# order by i.identidies_type_cd asc 
 	</select>
 	
 	<select id="getTmlCodeByPhoneNumber" parameterClass="java.lang.String" resultClass="java.lang.String">
 	   	select c.code
          from rm.phone_number a, rm.device_2_ne b, rm.device c
         where a.number_element_id = b.number_element_id
           and b.device_id = c.device_id
           and a.phone_number = #phoneNumber#
 	</select>
 	
 	<select id="getPartyPW" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		select a.BUSINESS_PASSWORD,a.QUERY_PASSWORD from party a where a.party_id=#partyId#
	</select>
 	
 	<insert id="saveIndentPay" parameterClass="java.util.HashMap">
 	    INSERT INTO UNITYPAY_IndentItemPay_intf
			(IndentItemPay_ID,
			REQUEST_ID,
			REQUEST_TIME,
			PLAT_ID,
			CHANNEL_ID,
			CYCLE_ID,
			PAY_INDENT_ID,
			CUST_TYPE,
			CUST_ID,
			CUST_NAME,
			STAFF_ID,
			interfaceSerial)
		VALUES
			(#id#,
			#requestId#,
			#requestTime#,
			#platId#,
			#channelId#,
			#cycleId#,
			#payIndentId#,
			#custType#,
			#custName#,
			#custId#,
			#staffId#,
			#interfaceSerial#)
	</insert>
	
	<insert id="saveIndentItemList" parameterClass="java.util.HashMap">
	INSERT INTO UNITYPAY_ITEMLIST_intf(
		itemlist_id,
		Request_Id,
		Refund_Pay_Indent_Id,
		Cust_Indent_Nbr,
		Item_Id,
		Item_Flag,
		Item_Type_Id,
		Charge_Std,
		Charge,
		Commission_Type,
		Commission,
		Product_Offer_Id,
		Product_Offer_Instance_Id,
		Count,
		Serv_Id,
		Acct_Id,
		Acc_Nbr,
		Billing_Mode,
		Product_Spec_Id,
		Product_Spec_Name)
	VALUES
		(#id#,
		#requestId#,
		#refundPayIndentId#,
		#custIndentNbr#,
		#itemId#,
		#itemFlag#,
		#itemTypeId#,
		#chargeStd#,
		#charge#,
		#commissionType#,
		#commission#,
		#productOfferId#,
		#productOfferInstanceId#,
		#count#,
		#servId#,
		#acctId#,
		#accNbr#,
		#billingMode#,
		#productSpecId#,
		#productSpecName#)
	</insert>
	
	<insert id="saveIndentPayList" parameterClass="java.util.HashMap">
	INSERT INTO UNITYPAY_PAYLIST_intf
		(paylist_id,
		request_id,
		method,
		amount,
		appendinfo)
	VALUES
		(#id#,
		#requestId#,
		#method#,
		#amount#,
		#appendInfo#)
	</insert>
	<select id="getPartyNumberCount" parameterClass="java.lang.String" resultClass="java.lang.Integer">
	select count(1)
	  from offer_prod c
	 where c.redu_owner_id in
	       (select b.redu_owner_id
	          from offer_prod_number a, offer_prod b, party d
	         where a.prod_id = b.prod_id
	           and b.redu_owner_id = d.party_id
	           and d.party_type_cd = 1
	           and a.status_cd in (10, 11, 12, 13)
	           and b.status_cd in (10, 11, 12, 13)
	           and a.access_number = #accessNumber#)
    </select>
    
    <select id="ifImportantPartyByPartyId" parameterClass="java.lang.Long" resultClass="java.lang.Integer">
		select count(*) as cnt
		  from party_segment_member_list
		 where segment_id = 100000348
		   and party_id=#partyId#
    </select>
    
    <select id="getPayItemId" resultClass="java.lang.String">
 	   	select SEQ_PAY_ITEM_ID_INTF.NEXTVAL
          from dual
 	</select>
 	
 	<select id="getItemTypeByBcdCode" parameterClass="java.lang.String" resultClass="java.lang.String">
 	   SELECT CHARGE_ITEM_CD
  		FROM sr.MATERIAL_KIND
 		WHERE MATERIAL_KIND_ID =
       (SELECT MKT_RES_TYPE_CD
          FROM sr.MKT_RESOURCE_TYPE
         WHERE MKT_RES_TYPE_ID =
               (SELECT MKT_RES_TYPE_ID
                  FROM sr.MKT_RESOURCE
                 WHERE MKT_RES_ID =
                       (SELECT MKT_RES_ID
                          FROM sr.MKT_RES_INST
                         WHERE MKT_RES_INST_CODE = #bcdCode#)))
 	</select>
 	
 	<select id="queryCardinfoByAcct" parameterClass="java.lang.String" resultClass="java.lang.String">
		select b.identity_num
		  from offer_prod a, party_identity b, offer_prod_status c
		 where a.redu_owner_id = b.party_id
		   and a.prod_id = c.prod_id
		   and c.prod_status_cd = 1
		   and a.redu_access_number=#accessNumber#
 	</select>
 	
 	<select id="getSecondAccNbrByProdId" parameterClass="java.lang.String" resultClass="java.lang.String">
		<![CDATA[
		SELECT OPAN.ACCESS_NUMBER
 		FROM OFFER_PROD_2_ACCESS_NUMBER OPAN
 		WHERE OPAN.PROD_ID = #PRODID#
 		AND ROWNUM < 2
 		]]>
 	</select>
 	
 	<select id="getOfferSpecIdByBoId" parameterClass="java.lang.String" resultClass="java.lang.String">
        select offer_spec_id from offer_roles where offer_role_id =(select  distinct offer_role_id from  oo_role where bo_id =#boId# )
 	</select>
 	<select id="getProdSpecIdByBoId" parameterClass="java.lang.String" resultClass="java.lang.String">
 	 	select  prod_spec_id from bo_prod_spec t where t.bo_id = #boId#
 	</select>
 	<select id="getNewOlIdByOlIdForPayIndentId" parameterClass="java.lang.String" resultClass="java.lang.String">
 	 	select a.ol_id from ol_opencle_2_ol a where a.rela_ol_id  = #olId# and a.status_cd = 'C'
 	</select>
 	<select id="getInterfaceIdBySystemId" parameterClass="java.lang.String" resultClass="java.lang.String">
 	 	select interface_id from platforminfo t where t.platform_code =#systemId#
 	</select>
 	
	<select id ="queryAttachOfferSpecBySpec" parameterClass="java.util.HashMap" resultClass="AttachOfferInfoDto">
		  	SELECT T.* FROM
				   (SELECT  OS.OFFER_SPEC_ID AS OFFERSPECID,
			                OS.NAME AS OFFERSPECNAME,
			                OS.SIMPLE_SPELL AS SIMPLESPELL,
			                DECODE(L.NAME, NULL, '附属业务', L.NAME) AS LABELNAME,
			                DECODE(L.LABEL_ID, NULL, -1, L.LABEL_ID) AS LABELID,
			                <!-- add by zhangzc@20121030 租机类标签未归类显示，直接与普通附属标签显示在附属订购界面 -->
			                DECODE(L.LABEL_TYPE, NULL, '0', L.LABEL_TYPE) AS LABELTYPE,
			            	<!-- end by zhangzc@20121030 -->
			                'SERV' AS OFFERSPECFLAG,
			                OS2L.SEQ_ID AS SEQID
			  FROM ROLE_OBJ RO, OFFER_ROLES ORS, OFFER_SPEC OS
			  LEFT JOIN OFFER_SPEC_2_LABEL OS2L ON OS2L.OFFER_SPEC_ID =
			                                       OS.OFFER_SPEC_ID
			  LEFT JOIN LABEL L ON L.LABEL_ID = OS2L.LABEL_ID
						AND L.STATUS_CD = 2		  
			 <isNotNull property="offerSpecIds" prepend=",">
			 	OFFER_PACKAGE_2_OFFER_SPEC OP2OS
			  </isNotNull>
			 <![CDATA[ WHERE OS.START_DT <= SYSDATE
			   AND OS.END_DT >= SYSDATE
			   AND ORS.START_DT <= SYSDATE
			   AND ORS.END_DT >= SYSDATE
			   AND RO.START_DT <= SYSDATE
			   AND RO.END_DT >= SYSDATE				   
			   ]]>
			   AND NOT EXISTS (SELECT 1
		          	FROM OFFER_SPEC_ATTR OSA
		         	WHERE OSA.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
		          	 AND OSA.ITEM_SPEC_ID = #osAttrClass# 
		          	 AND OSA.Default_Value = 1)	
			   AND OS.AGREEMENT_TYPE_CD = 1
			   AND RO.OFFER_ROLE_ID = ORS.OFFER_ROLE_ID
			   AND ORS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
			   AND OBJ_TYPE = 4
			   AND OFFER_TYPE_CD = 2
			   AND OS.STATUS_CD = 2
			   <isNotNull property="oneAcceptance">
				   AND EXISTS(SELECT 'X'
					          	FROM OFFER_SPEC_ATTR OSA
					           WHERE OSA.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
					          	 AND OSA.ITEM_SPEC_ID = 300000018
					          	 AND OSA.Default_Value = 'Y')	
			   </isNotNull>		   
			   AND OBJ_ID IN
			       (SELECT SCG2S.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S
			          JOIN SERV_SPEC SS ON SS.SERV_SPEC_ID = SCG2S.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN
			               (SELECT SSPEC_COMP_GRP_ID
			                  FROM PROD_SPEC
			                 WHERE PROD_SPEC_ID = #prodSpecId#) 
			        UNION
			        SELECT SCG2S1.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S1
			          JOIN SERV_SPEC SS1 ON SS1.SERV_SPEC_ID = SCG2S1.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN
		                       (SELECT SSPEC_COMP_SUB_ID
		                          FROM PROD.SSPEC_COMP_GRP_RELA
		                         START WITH SSPEC_COMP_GRP_ID =
		                                    (SELECT SSPEC_COMP_GRP_ID
		                                       FROM PROD_SPEC
		                                      WHERE PROD_SPEC_ID = #prodSpecId#) 
		                        CONNECT BY SSPEC_COMP_GRP_ID = PRIOR SSPEC_COMP_SUB_ID)
		            <isNotNull property="sspecCompGrpIds" prepend="UNION">
		            SELECT SCG2S.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S
			          JOIN SERV_SPEC SS ON SS.SERV_SPEC_ID = SCG2S.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN (
			         <iterate property="sspecCompGrpIds" conjunction=",">#sspecCompGrpIds[]#</iterate>
			         )
			         UNION
			         SELECT SCG2S1.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S1
			          JOIN SERV_SPEC SS1 ON SS1.SERV_SPEC_ID = SCG2S1.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN
		                       (SELECT SSPEC_COMP_SUB_ID
		                          FROM PROD.SSPEC_COMP_GRP_RELA
		                         START WITH SSPEC_COMP_GRP_ID IN(
		                          <iterate property="sspecCompGrpIds" conjunction=",">#sspecCompGrpIds[]#</iterate>
		                         ) 
		                        CONNECT BY SSPEC_COMP_GRP_ID = PRIOR SSPEC_COMP_SUB_ID)		            	
		            </isNotNull>
			         )
			   AND (NOT EXISTS
			        (SELECT 1
			           FROM ROLE_OBJ_2_CFG_RULE RO2CR, CFG_RULE CR, REQ_OBJ_RELA ROR
			          WHERE RO2CR.CFG_RULE_ID = CR.CFG_RULE_ID
			            AND ROR.CFG_RULE_ID = CR.CFG_RULE_ID
			            AND RO2CR.OBJ_TYPE = RO.OBJ_TYPE
			            AND ROR.OBJ_TYPE = 2
			            AND RO2CR.OBJ_ID = RO.OBJ_ID) OR EXISTS
			        (SELECT 1
			           FROM ROLE_OBJ_2_CFG_RULE RO2CR, CFG_RULE CR, REQ_OBJ_RELA ROR
			          WHERE RO2CR.CFG_RULE_ID = CR.CFG_RULE_ID
			            AND ROR.CFG_RULE_ID = CR.CFG_RULE_ID
			            AND RO2CR.OBJ_TYPE = RO.OBJ_TYPE
			            AND ROR.OBJ_TYPE = 2
			            AND RO2CR.OBJ_ID = RO.OBJ_ID
			            AND ROR.OBJ_ID = #prodSpecId#))			   
			   <isNotNull property="offerSpecIds">
			   AND OP2OS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
			   <!-- 增加地区及时间的过滤 ADD BY HZQ  -->
			   <isEqual property="filterByArea" compareValue="Y">
			   <isNotNull property="areaId">
			   AND EXISTS(
			   	 SELECT 1
			   	   FROM AREA
		          WHERE AREA.AREA_ID = OP2OS.AREA_ID
		          START WITH AREA.AREA_ID = #areaId#
		        CONNECT BY AREA.AREA_ID = PRIOR AREA.PARENT_AREA
			   )
			   </isNotNull>
			   AND SYSDATE BETWEEN OP2OS.START_DT AND OP2OS.END_DT
			   </isEqual>
			   <isEqual property="maskByDt" compareValue="Y">
			   AND SYSDATE BETWEEN OS.START_DT AND OS.END_DT
			   </isEqual>
			   <!-- END ADD HZQ -->
			   AND OP2OS.OFFER_PACKAGE_ID IN
			       (SELECT A.OFFER_PACKAGE_ID
			          FROM OFFER_PACKAGE_2_OFFER_SPEC A
			         WHERE A.OFFER_SPEC_ID IN 
			         (
			            <iterate property="offerSpecIds" conjunction=",">#offerSpecIds[]#</iterate>
			          )
			          )			               
			   </isNotNull>
			   <isEqual property="specialFlag" compareValue="Y">
				   AND OS.OFFER_SPEC_ID NOT IN(SELECT OFFER_SPEC_ID FROM OFFER_SPEC_2_LABEL OL WHERE OL.LABEL_ID IN (<iterate property="PTariffLabelList" conjunction=",">#PTariffLabelList[]#</iterate>))
				   <isEqual property="IvpnFlag" compareValue="Y">
			UNION ALL
					SELECT OS.OFFER_SPEC_ID AS OFFERSPECID,
				                OS.NAME AS OFFERSPECNAME,
				                OS.SIMPLE_SPELL AS SIMPLESPELL,
				                DECODE(L.NAME, NULL, '附属业务', L.NAME) AS LABELNAME,
				                DECODE(L.LABEL_ID, NULL, -2, L.LABEL_ID) AS LABELID,
				                <!-- add by zhangzc@20121030 租机类标签未归类显示，直接与普通附属标签显示在附属订购界面 -->
				                DECODE(L.LABEL_TYPE, NULL, '0', L.LABEL_TYPE) AS LABELTYPE,
				                <!-- end by zhangzc@20121030 -->
				                'PROD' AS OFFERSPECFLAG,
				                OS2L.SEQ_ID AS SEQID
					FROM OFFER_SPEC OS
					LEFT JOIN OFFER_SPEC_2_LABEL OS2L ON OS2L.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
					LEFT JOIN LABEL L ON L.LABEL_ID = OS2L.LABEL_ID AND L.STATUS_CD = 2
					WHERE OS.OFFER_SPEC_ID IN (SELECT DPR.PERSONAL_TARIFF_ID FROM DEFAULT_PERSONAL_RELA DPR WHERE DEFAULT_TARIFF_ID in (<iterate property="DefaultTariffLabelList" conjunction=",">#DefaultTariffLabelList[]#</iterate>)
					AND PERSONAL_TARIFF_LABEL in(<iterate property="CompPTriffLableList" conjunction=",">#CompPTriffLableList[]#</iterate>) AND STATUS_CD = 1)
					 <![CDATA[ AND OS.START_DT <= SYSDATE
				    AND OS.END_DT >= SYSDATE
				    AND OS.STATUS_CD = 2]]>
				  </isEqual>
			  </isEqual>
			  and exists
						(select 1 from intf_dzqd_offer_spec idos where idos.offer_spec_id=os.offer_spec_id)
			  and not exists
			   			(select 1 from offer_spec_2_category_node os2cn where os2cn.offer_spec_id=os.offer_spec_id and os2cn.category_node_id in (-1030038))	   
			UNION ALL
			SELECT DISTINCT OS.OFFER_SPEC_ID AS OFFERSPECID,
			                OS.NAME AS OFFERSPECNAME,
			                OS.SIMPLE_SPELL AS SIMPLESPELL,
			                DECODE(L.NAME, NULL, '附属叠加包', L.NAME) AS LABELNAME,
			                DECODE(L.LABEL_ID, NULL, -2, L.LABEL_ID) AS LABELID,
			                <!-- add by zhangzc@20121030 租机类标签未归类显示，直接与普通附属标签显示在附属订购界面 -->
			                DECODE(L.LABEL_TYPE, NULL, '0', L.LABEL_TYPE) AS LABELTYPE,
			                <!-- end by zhangzc@20121030 -->
			                'PROD' AS OFFERSPECFLAG,
			                OS2L.SEQ_ID AS SEQID
			  FROM ROLE_OBJ RO, OFFER_ROLES ORS, OFFER_SPEC OS
			  LEFT JOIN OFFER_SPEC_2_LABEL OS2L ON OS2L.OFFER_SPEC_ID =
			                                       OS.OFFER_SPEC_ID
			  LEFT JOIN LABEL L ON L.LABEL_ID = OS2L.LABEL_ID
						AND L.STATUS_CD = 2				  
			  <isNotNull property="offerSpecIds" prepend=",">
			 	OFFER_PACKAGE_2_OFFER_SPEC OP2OS
			  </isNotNull>
			 <![CDATA[ WHERE OS.START_DT <= SYSDATE
			   AND OS.END_DT >= SYSDATE 
			   AND ORS.START_DT <= SYSDATE
           	   AND ORS.END_DT >= SYSDATE
           	   AND RO.START_DT <= SYSDATE
           	   AND RO.END_DT >= SYSDATE
			   ]]>
			   AND NOT EXISTS (SELECT 1
			          FROM OFFER_SPEC_ATTR OSA
			         WHERE OSA.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
			           AND OSA.ITEM_SPEC_ID = #osAttrClass# 
			           AND OSA.Default_Value = 1)				   
			   AND OS.AGREEMENT_TYPE_CD = 1
			   AND OS.OFFER_TYPE_CD = 2
			   AND OS.OFFER_SPEC_ID = ORS.OFFER_SPEC_ID
			   AND ORS.OFFER_ROLE_ID = RO.OFFER_ROLE_ID
			   AND RO.OBJ_ID = #prodSpecId#
			   AND RO.OBJ_TYPE = 2
			   AND OS.STATUS_CD = 2
			   <isNotNull property="oneAcceptance">
				   AND EXISTS(SELECT 'X'
					          	FROM OFFER_SPEC_ATTR OSA
					           WHERE OSA.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
					          	 AND OSA.ITEM_SPEC_ID = 300000018
					          	 AND OSA.Default_Value = 'Y')	
			   </isNotNull>					   
			   <isNotNull property="offerSpecIds">
			   <!-- 增加地区及时间的过滤 ADD BY HZQ  -->
			   <isEqual property="filterByArea" compareValue="Y">
			   <isNotNull property="areaId">
				   AND EXISTS(
				   	 SELECT 1
				   	   FROM AREA
			          WHERE AREA.AREA_ID = OP2OS.AREA_ID
			          START WITH AREA.AREA_ID = #areaId#
			        CONNECT BY AREA.AREA_ID = PRIOR AREA.PARENT_AREA
				   )
			   </isNotNull>
			   AND SYSDATE BETWEEN OP2OS.START_DT AND OP2OS.END_DT
			   </isEqual>
			   <isEqual property="maskByDt" compareValue="Y">
			   AND SYSDATE BETWEEN OS.START_DT AND OS.END_DT
			   </isEqual>
			   <!-- END ADD HZQ -->
			   AND OP2OS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
			   AND OP2OS.OFFER_PACKAGE_ID IN
			       (SELECT A.OFFER_PACKAGE_ID
			          FROM OFFER_PACKAGE_2_OFFER_SPEC A
			         WHERE A.OFFER_SPEC_ID IN
			         (
			         <iterate property="offerSpecIds" conjunction=",">#offerSpecIds[]#</iterate>
			         )
			         )
			   </isNotNull> 
			   <isEqual property="specialFlag" compareValue="Y" >
			        AND OS.OFFER_SPEC_ID NOT IN(SELECT OFFER_SPEC_ID FROM OFFER_SPEC_2_LABEL OL WHERE OL.LABEL_ID IN (<iterate property="PTariffLabelList" conjunction=",">#PTariffLabelList[]#</iterate>))
			   </isEqual>			   
			   and exists
						(select 1 from intf_dzqd_offer_spec idos where idos.offer_spec_id=os.offer_spec_id)
			   and not exists
			   			(select 1 from offer_spec_2_category_node os2cn where os2cn.offer_spec_id=os.offer_spec_id and os2cn.category_node_id in (-1030038))) T
			   
			   <isEqual property="queryByCondDim" compareValue="Y" prepend=",">
			         	OFFER_SPEC_COND_DIM OSDM
			   </isEqual>      
			   <isEqual property="queryByCondDim" compareValue="Y" >
			           WHERE OSDM.OFFER_SPEC_ID = T.OFFERSPECID
			     		<isNotNull property="partyId">
			           AND (OSDM.SEGMENT_ID IN
			               (SELECT SEGMENT_ID
			                   FROM PARTY_SEGMENT_MEMBER_LIST
			                  WHERE PARTY_ID = #partyId#) OR OSDM.SEGMENT_ID = -9999)
			           </isNotNull>
			           <isNotNull property="areaId">
			           AND (OSDM.AREA_ID =#areaId# OR  OSDM.AREA_ID =-9999)
			           </isNotNull>
			           <isNotNull property="channelId">
			           AND (OSDM.CHANNEL_ID =#channelId# OR  OSDM.CHANNEL_ID =-9999)
			            </isNotNull>
			           <!-- 增加销售角色过滤/去除有角色的销售品  ADD BY HZQ 0612 -->
                       AND ( OSDM.DIM_1 = -9999
                           <isNotNull property="osAuth"><isNotEmpty property="osAuth">
                             OR OSDM.DIM_1 IN (
                             <iterate property="osAuth" conjunction=",">#osAuth[]#</iterate> )
                           </isNotEmpty></isNotNull>
                           ) 
                       <!-- end add hzq 0612 -->
                       <!-- add by hzq gz 0908 增加业务动作过滤 -->
                       <isNotNull property="filterByBoAction">
                       <isEqual property="filterByBoAction" compareValue="Y">
                        AND ( OSDM.DIM_2 = -9999
                           <isNotNull property="boActionTypes"><isNotEmpty property="boActionTypes">
                             OR OSDM.DIM_2 IN (
                             <iterate property="boActionTypes" conjunction=",">#boActionTypes[]#</iterate> )
                           </isNotEmpty></isNotNull>
                            ) 
                       </isEqual>
                       </isNotNull>
                       <!-- end add hzq 0908 -->
			           </isEqual>
		             and not exists
						   (select 1
						            from (SELECT oss.offer_spec_id
						                    FROM BUSI_LIMIT_2_AUTH          BLA,
						                         BUSI_LIMIT_GRP_RELA        BLGR,
						                         BUSI_LIMIT                 BL,
						                         BUSI_LIMIT_2_OBJ           BLO,
						                         OFFER_SPEC                 OSS
						                   WHERE BLA.LIMIT_GRP_ID = BLGR.LIMIT_GRP_ID
						                     AND BLGR.SUB_LIMIT_ID = BL.LIMIT_ID
						                     AND BL.LIMIT_ID = BLO.LIMIT_ID
						                     AND TO_NUMBER(BLO.OBJ_ID) = OSS.OFFER_SPEC_ID
						                     AND SYSDATE BETWEEN OSS.START_DT AND OSS.END_DT
						                     AND OSS.OFFER_TYPE_CD = 2
						                     AND BLA.STATUS = 0
						                     AND SYSDATE BETWEEN BLA.START_DT AND BLA.END_DT
						                     AND SYSDATE BETWEEN BLGR.START_DT AND BLGR.END_DT
						                     AND BL.STATUS = 0
						                     AND SYSDATE BETWEEN BL.START_DT AND BL.END_DT
						                     AND BLO.STATUS = 0
						                     AND SYSDATE BETWEEN BLO.START_DT AND BLO.END_DT
						                     AND BLGR.BUSI_OBJECT_CD = #objTypeId:DECIMAL#
						                     AND BLGR.LIMIT_ROLE_CD = 2) osh
						           where osh.offer_spec_id = osdm.offer_spec_id)
											           
	</select>
	<!-- 查询业务权限控制的附属销售品信息 -->
	<select id="queryAttachOfferSpecLimit" resultMap="AttachOfferInfoResult" parameterClass="java.util.HashMap">
		SELECT OS.OFFER_SPEC_ID AS OFFERSPECID,
		       OS.NAME AS OFFERSPECNAME,
		       OS.SIMPLE_SPELL AS SIMPLESPELL,
		       DECODE(RO.OBJ_TYPE,4,DECODE(L.NAME, NULL, '附属业务', L.NAME),DECODE(L.NAME, NULL, '附属叠加包', L.NAME)) AS LABELNAME,
		       DECODE(RO.OBJ_TYPE,4,DECODE(L.LABEL_ID, NULL, -1, L.LABEL_ID),DECODE(L.LABEL_ID, NULL, -2, L.LABEL_ID)) AS LABELID,
		       DECODE(RO.OBJ_TYPE, 4, 'SERV', 'PROD') AS OFFERSPECFLAG,
		       BLA.AUTH_OBJ_TYPE AS AUTHOBJTYPE
		  FROM BUSI_LIMIT_2_AUTH     BLA,
		       BUSI_LIMIT_GRP_RELA   BLGR,
		       BUSI_LIMIT_2_OBJ_RELA BLOR,
		       ROLE_OBJ              RO,
		       OFFER_ROLES           ORS,
		       OFFER_SPEC            OS
		  LEFT JOIN OFFER_SPEC_2_LABEL OS2L
		    ON OS2L.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
		  LEFT JOIN LABEL L
		    ON L.LABEL_ID = OS2L.LABEL_ID
		   AND L.STATUS_CD = 2
		 WHERE BLA.LIMIT_GRP_ID = BLGR.LIMIT_GRP_ID
		   AND BLGR.SUB_LIMIT_ID = BLOR.LIMIT_ID
		   AND OS.OFFER_SPEC_ID = TO_NUMBER(BLOR.OBJ_ID)
		   AND ORS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
		   AND RO.OFFER_ROLE_ID = ORS.OFFER_ROLE_ID
		   AND BLOR.BUSI_OBJECT_CD = BLGR.BUSI_OBJECT_CD
		   AND SYSDATE BETWEEN OS.START_DT AND OS.END_DT
		   AND SYSDATE BETWEEN BLA.START_DT AND BLA.END_DT
		   AND SYSDATE BETWEEN BLGR.START_DT AND BLGR.END_DT
		   AND OS.OFFER_TYPE_CD = 2
		   AND OS.STATUS_CD = '2'
		   AND OS.AGREEMENT_TYPE_CD = 1
		   AND BLA.STATUS = 0
		   AND BLGR.BUSI_OBJECT_CD = #objTypeId:DECIMAL#
		   AND BLGR.LIMIT_ROLE_CD = #limitRoleCd:DECIMAL#
		   <isNotNull property="boActionTypeCd">
		        AND BLOR.RELA_VALUE = #boActionTypeCd:VARCHAR#
		   </isNotNull>
		   AND RO.OBJ_TYPE = 4
		   AND EXISTS (SELECT 1 FROM (
		        SELECT SCG2S.SERV_SPEC_ID
		          FROM SSPEC_COMP_GRP_2_SSPEC SCG2S
		          JOIN SERV_SPEC SS
		            ON SS.SERV_SPEC_ID = SCG2S.SERV_SPEC_ID
		         WHERE SSPEC_COMP_GRP_ID IN
		               (SELECT SSPEC_COMP_GRP_ID
		                  FROM PROD_SPEC
		                 WHERE PROD_SPEC_ID = #prodSpecId#)
		        UNION
		        SELECT SCG2S1.SERV_SPEC_ID
		          FROM SSPEC_COMP_GRP_2_SSPEC SCG2S1
		          JOIN SERV_SPEC SS1
		            ON SS1.SERV_SPEC_ID = SCG2S1.SERV_SPEC_ID
		         WHERE SSPEC_COMP_GRP_ID IN
		               (SELECT SSPEC_COMP_SUB_ID
		                  FROM SSPEC_COMP_GRP_RELA
		                 START WITH SSPEC_COMP_GRP_ID =
		                            (SELECT SSPEC_COMP_GRP_ID
		                               FROM PROD_SPEC
		                              WHERE PROD_SPEC_ID = #prodSpecId#)
		                CONNECT BY SSPEC_COMP_GRP_ID = PRIOR SSPEC_COMP_SUB_ID)
		         	<isNotNull property="sspecCompGrpIds" prepend="UNION">
				            SELECT SCG2S.SERV_SPEC_ID
					          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S
					          JOIN SERV_SPEC SS ON SS.SERV_SPEC_ID = SCG2S.SERV_SPEC_ID
					         WHERE SSPEC_COMP_GRP_ID IN (
					         <iterate property="sspecCompGrpIds" conjunction=",">#sspecCompGrpIds[]#</iterate>
					         )
					         UNION
					         SELECT SCG2S1.SERV_SPEC_ID
					          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S1
					          JOIN SERV_SPEC SS1 ON SS1.SERV_SPEC_ID = SCG2S1.SERV_SPEC_ID
					         WHERE SSPEC_COMP_GRP_ID IN
				                       (SELECT SSPEC_COMP_SUB_ID
				                          FROM PROD.SSPEC_COMP_GRP_RELA
				                         START WITH SSPEC_COMP_GRP_ID IN(
				                          <iterate property="sspecCompGrpIds" conjunction=",">#sspecCompGrpIds[]#</iterate>
				                         ) 
				                        CONNECT BY SSPEC_COMP_GRP_ID = PRIOR SSPEC_COMP_SUB_ID)		            	
				      </isNotNull>  ) T WHERE RO.OBJ_ID = T.SERV_SPEC_ID  )
		           AND ((BLA.AUTH_OBJ_TYPE = #staffAuthType:DECIMAL# AND BLA.AUTH_OBJ_ID = #staffId:DECIMAL#) or
				       (BLA.AUTH_OBJ_TYPE = #channelSpecAuthType:DECIMAL# AND BLA.AUTH_OBJ_ID = #channelSpecId#) or
				       (BLA.AUTH_OBJ_TYPE = #channelAuthType:DECIMAL# AND BLA.AUTH_OBJ_ID = #channelId:DECIMAL#)
				       <isNotNull property="sysRoleAuthType" prepend="or">
				       (BLA.AUTH_OBJ_TYPE = #sysRoleAuthType:DECIMAL# 
				       AND BLA.AUTH_OBJ_ID IN (SELECT PPR.POST_ROLE_ID
									            FROM SM.PARTY_2_POST_ROLE PPR, SM.POST_ROLE PR
									           WHERE PPR.POST_ROLE_ID = PR.POST_ROLE_ID
									             AND PPR.PARTY_ID = #staffId:DECIMAL#
									             AND SYSDATE BETWEEN PPR.START_DT AND PPR.END_DT
									             AND SYSDATE BETWEEN PR.START_DT AND PR.END_DT))
				       </isNotNull>)
				UNION
				SELECT OS.OFFER_SPEC_ID AS OFFERSPECID,
				       OS.NAME AS OFFERSPECNAME,
				       OS.SIMPLE_SPELL AS SIMPLESPELL,
				       DECODE(RO.OBJ_TYPE,4,DECODE(L.NAME, NULL, '附属业务', L.NAME),DECODE(L.NAME, NULL, '附属叠加包', L.NAME)) AS LABELNAME,
				       DECODE(RO.OBJ_TYPE,4,DECODE(L.LABEL_ID, NULL, -1, L.LABEL_ID),DECODE(L.LABEL_ID, NULL, -2, L.LABEL_ID)) AS LABELID,
				       DECODE(RO.OBJ_TYPE, 4, 'SERV', 'PROD') AS OFFERSPECFLAG,
				       BLA.AUTH_OBJ_TYPE AS AUTHOBJTYPE
				  FROM BUSI_LIMIT_2_AUTH     BLA,
				       BUSI_LIMIT_GRP_RELA   BLGR,
				       BUSI_LIMIT_2_OBJ_RELA BLOR,
				       ROLE_OBJ              RO,
				       OFFER_ROLES           ORS,
				       OFFER_SPEC            OS
				  LEFT JOIN OFFER_SPEC_2_LABEL OS2L
				    ON OS2L.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
				  LEFT JOIN LABEL L
				    ON L.LABEL_ID = OS2L.LABEL_ID
				   AND L.STATUS_CD = 2
				 WHERE BLA.LIMIT_GRP_ID = BLGR.LIMIT_GRP_ID
				   AND BLGR.SUB_LIMIT_ID = BLOR.LIMIT_ID
				   AND OS.OFFER_SPEC_ID = TO_NUMBER(BLOR.OBJ_ID)
				   AND BLOR.BUSI_OBJECT_CD = BLGR.BUSI_OBJECT_CD
				   AND ORS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
				   AND RO.OFFER_ROLE_ID = ORS.OFFER_ROLE_ID
				   AND SYSDATE BETWEEN OS.START_DT AND OS.END_DT
				   AND SYSDATE BETWEEN BLA.START_DT AND BLA.END_DT
				   AND SYSDATE BETWEEN BLGR.START_DT AND BLGR.END_DT
				   AND OS.OFFER_TYPE_CD = 2
				   AND OS.STATUS_CD = '2'
				   AND OS.AGREEMENT_TYPE_CD = 1
				   AND BLA.STATUS = 0
				   AND BLGR.BUSI_OBJECT_CD = #objTypeId:DECIMAL#
				   AND BLGR.LIMIT_ROLE_CD = #limitRoleCd:DECIMAL#
				   <isNotNull property="boActionTypeCd">
								AND BLOR.RELA_VALUE = #boActionTypeCd:VARCHAR#
					 </isNotNull>
				   AND RO.OBJ_TYPE = 2
				   <isNotNull property="prodSpecId">
				       AND RO.OBJ_ID = #prodSpecId#
				   </isNotNull>
				   AND ((BLA.AUTH_OBJ_TYPE = #staffAuthType:DECIMAL# AND BLA.AUTH_OBJ_ID = #staffId:DECIMAL#) or
						       (BLA.AUTH_OBJ_TYPE = #channelSpecAuthType:DECIMAL# AND BLA.AUTH_OBJ_ID = #channelSpecId#) or
						       (BLA.AUTH_OBJ_TYPE = #channelAuthType:DECIMAL# AND BLA.AUTH_OBJ_ID = #channelId:DECIMAL#)
			       <isNotNull property="sysRoleAuthType" prepend="or">
			       (BLA.AUTH_OBJ_TYPE = #sysRoleAuthType:DECIMAL# 
			       AND BLA.AUTH_OBJ_ID IN (SELECT PPR.POST_ROLE_ID
								            FROM SM.PARTY_2_POST_ROLE PPR, SM.POST_ROLE PR
								           WHERE PPR.POST_ROLE_ID = PR.POST_ROLE_ID
								             AND PPR.PARTY_ID = #staffId:DECIMAL#
								             AND SYSDATE BETWEEN PPR.START_DT AND PPR.END_DT
								             AND SYSDATE BETWEEN PR.START_DT AND PR.END_DT))
	   				 </isNotNull>)
	</select>	
	<select id ="queryLimitAttachOfferSpecInfoBySpec" parameterClass="java.util.HashMap" resultClass="AttachOfferInfoDto" >
					   SELECT OS.OFFER_SPEC_ID AS OFFERSPECID,
					       OS.NAME AS OFFERSPECNAME,
					       OS.SIMPLE_SPELL AS SIMPLESPELL,
					       DECODE(L.NAME, NULL, '附属业务', L.NAME) AS LABELNAME,
					       DECODE(L.LABEL_ID, NULL, -1, L.LABEL_ID) AS LABELID,
					       DECODE(L.LABEL_TYPE, NULL, '0', L.LABEL_TYPE) AS LABELTYPE,
					       'SERV' AS OFFERSPECFLAG,
					       OS2L.SEQ_ID AS SEQID
					  FROM BUSI_LIMIT_GRP_RELA   BLGR,
					       BUSI_LIMIT_2_OBJ_RELA BLOR,
					       ROLE_OBJ              RO,
					       OFFER_ROLES           ORS,
					       OFFER_SPEC            OS
					  LEFT JOIN OFFER_SPEC_2_LABEL OS2L
					    ON OS2L.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
					  LEFT JOIN LABEL L
					    ON L.LABEL_ID = OS2L.LABEL_ID
					   AND L.STATUS_CD = 2
					 WHERE BLGR.SUB_LIMIT_ID = BLOR.LIMIT_ID
					   AND OS.OFFER_SPEC_ID = TO_NUMBER(BLOR.OBJ_ID)
					   AND ORS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
					   AND RO.OFFER_ROLE_ID = ORS.OFFER_ROLE_ID
					   AND BLOR.BUSI_OBJECT_CD = BLGR.BUSI_OBJECT_CD
					   AND SYSDATE BETWEEN OS.START_DT AND OS.END_DT
					   AND SYSDATE BETWEEN BLGR.START_DT AND BLGR.END_DT
					   AND OS.OFFER_TYPE_CD = 2
					   AND OS.STATUS_CD = '2'
					   AND RO.OBJ_TYPE = 4
					   AND BLGR.LIMIT_ROLE_CD = 2
					   AND OS.AGREEMENT_TYPE_CD = 1
					   AND BLOR.BUSI_OBJECT_CD = #objTypeId:DECIMAL#
					   <isNotNull property="boActionTypeCd">
				          AND BLOR.RELA_VALUE = #boActionTypeCd:VARCHAR#
				       </isNotNull>
					   AND EXISTS
					 (SELECT 1
					          FROM (SELECT SCG2S.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S
			          JOIN SERV_SPEC SS ON SS.SERV_SPEC_ID = SCG2S.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN
			               (SELECT SSPEC_COMP_GRP_ID
			                  FROM PROD_SPEC
			                 WHERE PROD_SPEC_ID = #prodSpecId#) 
			        UNION
			        SELECT SCG2S1.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S1
			          JOIN SERV_SPEC SS1 ON SS1.SERV_SPEC_ID = SCG2S1.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN
		                       (SELECT SSPEC_COMP_SUB_ID
		                          FROM PROD.SSPEC_COMP_GRP_RELA
		                         START WITH SSPEC_COMP_GRP_ID =
		                                    (SELECT SSPEC_COMP_GRP_ID
		                                       FROM PROD_SPEC
		                                      WHERE PROD_SPEC_ID = #prodSpecId#) 
		                        CONNECT BY SSPEC_COMP_GRP_ID = PRIOR SSPEC_COMP_SUB_ID)
		            <isNotNull property="sspecCompGrpIds" prepend="UNION">
		            SELECT SCG2S.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S
			          JOIN SERV_SPEC SS ON SS.SERV_SPEC_ID = SCG2S.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN (
			         <iterate property="sspecCompGrpIds" conjunction=",">#sspecCompGrpIds[]#</iterate>
			         )
			         UNION
			         SELECT SCG2S1.SERV_SPEC_ID
			          FROM PROD.SSPEC_COMP_GRP_2_SSPEC SCG2S1
			          JOIN SERV_SPEC SS1 ON SS1.SERV_SPEC_ID = SCG2S1.SERV_SPEC_ID
			         WHERE SSPEC_COMP_GRP_ID IN
		                       (SELECT SSPEC_COMP_SUB_ID
		                          FROM PROD.SSPEC_COMP_GRP_RELA
		                         START WITH SSPEC_COMP_GRP_ID IN(
		                          <iterate property="sspecCompGrpIds" conjunction=",">#sspecCompGrpIds[]#</iterate>
		                         ) 
		                        CONNECT BY SSPEC_COMP_GRP_ID = PRIOR SSPEC_COMP_SUB_ID)		            	
		            </isNotNull>) T
					         WHERE T.SERV_SPEC_ID = RO.OBJ_ID)
					
					UNION
					SELECT OS.OFFER_SPEC_ID AS OFFERSPECID,
					       OS.NAME AS OFFERSPECNAME,
					       OS.SIMPLE_SPELL AS SIMPLESPELL,
					       DECODE(L.NAME, NULL, '附属业务', L.NAME) AS LABELNAME,
					       DECODE(L.LABEL_ID, NULL, -2, L.LABEL_ID) AS LABELID,
					       DECODE(L.LABEL_TYPE, NULL, '0', L.LABEL_TYPE) AS LABELTYPE,
					       'PROD' AS OFFERSPECFLAG,
					       OS2L.SEQ_ID AS SEQID
					  FROM BUSI_LIMIT_GRP_RELA   BLGR,
					       BUSI_LIMIT_2_OBJ_RELA BLOR,
					       ROLE_OBJ              RO,
					       OFFER_ROLES           ORS,
					       OFFER_SPEC            OS
					  LEFT JOIN OFFER_SPEC_2_LABEL OS2L
					    ON OS2L.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
					  LEFT JOIN LABEL L
					    ON L.LABEL_ID = OS2L.LABEL_ID
					   AND L.STATUS_CD = 2
					 WHERE BLGR.SUB_LIMIT_ID = BLOR.LIMIT_ID
					   AND OS.OFFER_SPEC_ID = TO_NUMBER(BLOR.OBJ_ID)
					   AND ORS.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
					   AND RO.OFFER_ROLE_ID = ORS.OFFER_ROLE_ID
					   AND BLOR.BUSI_OBJECT_CD = BLGR.BUSI_OBJECT_CD
					   AND SYSDATE BETWEEN OS.START_DT AND OS.END_DT
					   AND SYSDATE BETWEEN BLGR.START_DT AND BLGR.END_DT
					   AND OS.OFFER_TYPE_CD = 2
					   AND OS.STATUS_CD = '2'
					   AND BLGR.LIMIT_ROLE_CD = 2
					   AND RO.OBJ_TYPE = 2
					   AND OS.AGREEMENT_TYPE_CD = 1
					   AND BLOR.BUSI_OBJECT_CD = #objTypeId:DECIMAL#
					   <isNotNull property="boActionTypeCd">
				          AND BLOR.RELA_VALUE = #boActionTypeCd:VARCHAR#
				       </isNotNull>
					   AND RO.OBJ_ID = #prodSpecId#
   </select>
	
	<!-- 根据渠道id查询对应的渠道规格id -->
	<select id="queryChannelSpecByChannelId" resultClass="java.lang.String" parameterClass="java.lang.Integer">
		SELECT CHANNEL_SPEC_ID channelSpecId FROM CHANNEL WHERE CHANNEL_ID = #channelId#
	</select>
	
 	<insert id="insertTableInfoPayInfoListForOrderSubmit" parameterClass="java.util.HashMap" >
		insert into pay_info_list
         (ol_id, pay_method, amount, append_info, create_date)
       values
         (#olId#, #payMethod#, #amount#, #appendInfo#, sysdate)
 	</insert>
 	
	<select id="getRenewOfferSpecAttr" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
		SELECT count(*)
		  FROM OFFER_SPEC_ATTR T
		 WHERE T.ITEM_SPEC_ID = 300000005
		   AND T.OFFER_SPEC_ID = #offerSpecId#
	</select>
	<select id="getAccessNumberByProdId" resultClass="java.lang.String" parameterClass="java.lang.Long">
	select access_number from offer_prod_number where prod_id =#prodId# AND status_cd = '12'
	</select>
	
	<select id="getOfferSpecSummary" resultClass="java.lang.String" parameterClass="java.lang.Long">
	select a.SUMMARY from offer_spec a where a.offer_spec_id=#offerSpecId#
	</select>
	
	<select id="getOfferItemByAccNum" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
			select count(1) from offer_prod_item item where item.item_spec_id = 20130048 and item.prod_id = (select prod_id from offer_prod o where o.redu_access_number = #accnum# and o.status_cd in(10, 11, 12, 13) and rownum < 2)
		]]>
	</select>
	
	<select id="getPartyIdByCard" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		<![CDATA[
			select T.party_id
        from party_identity t ,PARTY P
       where t.identidies_type_cd = #certType#
         and T.identity_num = #certValue#
         AND T.party_id = P.party_id
         AND P.PARTY_STATUS_CD = '1'
         and rownum < 2
		]]>
	</select>
	
	
	<select id="getPartyIdByIdentityNum" resultClass="java.lang.Long" parameterClass="java.lang.String">
		select p.party_id
		  from party p, party_identity pi
		 where p.party_id = pi.party_id
		   and pi.identidies_type_cd = 1
		   and pi.identity_num =#identifyValue#							
	</select>
	<insert id="insertAmaLinkman" parameterClass="com.linkage.bss.crm.intf.model.LinkManInfo" >
		insert into ama_linkman(AMA_LINKMAN_ID,AGENT_KIND,BUNIESS_TYPE,TELECOM_OFFICIAL,OFFICIAL_PHONE,LINK_MAN,LINK_PHONE,LINK_SEX,LINK_BIRTHDAY,LINK_ADDRESS,LINK_EMAIL,SUP_ID,SUP_TYPE,STATE,CARD_TYPE,CARD_NUM,LINK_POST)
		 values
         (#agentId#, #agentKind#, #buniessType#, #telecomOfficial#, #officialPhone#,#linkManName#,#linkPhone#,#linkSex#,#linkBirthday#,#linkAddress#,#linkEmail#,#agentId#,#supType#,#state#,#cardType#,#cardNum#,#linkPost#)
 	</insert>
 	
 	<delete id="deleteAmaLinkman" parameterClass="java.lang.Integer" >
		delete from ama_linkman where sup_id = #agentId#
 	</delete>
 	
 	<select id="isYKSXByPartyId" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
		select count(*)
		  from ctg_spec.offer_roles a
		 where a.role_cd in (239, 240)
		   and a.offer_spec_id in
		       (select b.offer_spec_id
		          from crm_app.offer b
		         where b.party_id = #partyId#)	
	</select>
	<select id="isIndividualCustByPartyId" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
	select count(*) from  party_segment_member_list a where a.segment_id = 10007 and a.party_id=#partyId#
	</select>
	<select id="getRunOrderByPartyId" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
	select count(*)
	  from busi_order a, bo_prod_spec b
	 where a.bo_id = b.bo_id
	   and a.party_id = #partyId#
	   and a.status_cd not in ('C', 'R', 'T', 'U', 'D', 'G')
	   and b.prod_spec_id in ('378', '379')
	   and not exists (select 1
	          from atom_action aa
	         where aa.atom_action_id = b.atom_action_id
	           and aa.status_cd = 'D')
	</select>
	<select id="getOwnCDMANumByPartyId" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
	select count(*)
	  from offer_prod op, INST.offer_prod_status ops
	 where op.prod_id = ops.prod_id
	   and ops.prod_status_cd = 1
	   and op.status_cd in (10, 11, 12, 13)
	   and op.redu_prod_spec_id in ('378', '379')
	   and op.redu_owner_id = #partyId#
	</select>
	
	<select id="queryOfferServNotInvalid" resultClass="OfferServItemDto" parameterClass="java.lang.Long">
	select a.serv_id as servId, a.item_spec_id as itemSpecId, c.name as itemSpecName, a.value as value
	  from offer_serv_item a, offer_member b, item_spec c
	 where a.serv_id = b.member_id
	   and b.obj_type = 4
	   and a.item_spec_id = c.item_spec_id
	   and b.offer_id =#offerId#
	   and a.status_cd in (10, 11, 12, 13, 21)
	</select>
	
	<insert id ="insertAbm2crmProvince" parameterClass="java.util.HashMap">
	insert into abm2crm_province(abm_id,req_xml,state,create_dt ) values (#coGroupId#,#reqXml#,#state#,SYSDATE )
	</insert>
	
	<insert id ="updateAbm2crmProvince" parameterClass="java.util.HashMap">
	update abm2crm_province
    set state = #state#, fiish_dt = SYSDATE, res_xml = #resXml#
			<isNotNull property="olId" prepend=",">
			co_id=#olId#
			</isNotNull>
 	where abm_id = #coGroupId#
	</insert>
	<select id="queryOfferProdInfoByAccessNumber" resultClass="java.util.HashMap" parameterClass="java.lang.String">
   	select t.prod_id prodId,t.redu_owner_id partyId,t.redu_prod_spec_id prodSpecId,t2.name , t2.offer_spec_id mainId
    from offer_prod t ,offer_member t1, offer_spec t2,offer t3
   where t.redu_access_number =#phoneNumber:VARCHAR#
   and t1.member_id =t.prod_id
   and t1.status_cd in (10,11,12,13)
   and t1.offer_id = t3.offer_id
   and t3.status_cd in (10,11,12,13)
   and t3.offer_spec_id = t2.offer_spec_id
   and t2.OFFER_TYPE_CD = '1'
   and t.status_cd in (10,11,12,13) 
   and <![CDATA[rownum < 2]]>
   </select>
   <select id="queryOfferSpecItemId" resultClass="java.util.HashMap" parameterClass="java.lang.Long">
   select item_spec_id from offer_spec_param where offer_spec_id =#id#
   </select>
   
   <select id="getProdStatusByProdId" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
		SELECT T.PROD_STATUS_CD
  		FROM (SELECT PROD_STATUS_CD
          FROM OFFER_PROD_STATUS OPS
         WHERE PROD_ID = #prodId#
           AND STATUS_CD IN (10, 11, 12, 13)
         ORDER BY OPS.STATUS_DT DESC) T
 		WHERE ROWNUM < 2
		]]>
	</select>
	
	<select id="queryOptionServSpecs" resultClass="ServSpecDto" parameterClass="java.util.HashMap">
	<![CDATA[
		select oss.offer_spec_id as servSpecId,
			   ass.serv_spec_id as servSpecIdReal,
		       oss.name as servSpecName,
		       (select la.label_id
		          from spec.offer_spec_2_label os2l, spec.label la
		         where os2l.label_id = la.label_id
		           and oss.offer_spec_id = os2l.offer_spec_id
		           and rownum = 1) as groupId,
		       (select la.name
		          from spec.offer_spec_2_label os2l, spec.label la
		         where os2l.label_id = la.label_id
		           and oss.offer_spec_id = os2l.offer_spec_id
		           and rownum = 1) as groupName,
		       ass.sspec_comp_grp_id as groupId,
		       ass.default_sel as ifDefaultSel,
		       ass.IS_NUST_SEL as ifMustSel,
		       ass.is_exclusive as ifExclusive,
		       ass.min_member_qty as minsize
		  from (select d.serv_spec_id,
		               d.name,
		               b.sspec_comp_grp_id,
		               c.default_qty default_sel,
		               decode(c.min_qty, c.max_qty, 'Y', 'N') IS_NUST_SEL,
		               b.is_exclusive,
		               b.min_member_qty,
		               b.name group_name
		          from prod.sspec_comp_grp         b,
		               prod.sspec_comp_grp_2_sspec c,
		               prod.sspec_comp_grp_rela    e,
		               prod.serv_spec_2_area       f,
		               prod.serv_spec              d,
		               prod.prod_spec              a
		         where a.sspec_comp_grp_id = e.sspec_comp_grp_id
		           and b.sspec_comp_grp_id = c.sspec_comp_grp_id
		           and c.serv_spec_id = d.serv_spec_id
		           and d.serv_spec_id = f.serv_spec_id
		           and b.sspec_comp_grp_id in
		               (select o.sspec_comp_sub_id
		                  from prod.sspec_comp_grp_rela o
		                 Start With o.sspec_comp_grp_id = e.sspec_comp_grp_id
		                Connect By o.sspec_comp_grp_id = Prior o.sspec_comp_sub_id
		                union
		                select e.sspec_comp_grp_id from dual)
		           and a.spec_status_cd = 2
		           and d.spec_status_cd = 2
		           and exists (select 1
		                  from offer_prod op, offer_prod_status ops
		                 where op.redu_prod_spec_id = a.prod_spec_id
		                   and op.prod_id = #prodId#
		                   and op.prod_id = ops.prod_id
		                   and ops.prod_status_cd = 1)
		        union
		        select d.serv_spec_id,
		               d.name,
		               b.sspec_comp_grp_id,
		               c.default_qty default_sel,
		               decode(c.min_qty, c.max_qty, 'Y', 'N') IS_NUST_SEL,
		               b.is_exclusive,
		               b.min_member_qty,
		               b.name group_name
		          from prod.sspec_comp_grp         b,
		               prod.sspec_comp_grp_2_sspec c,
		               prod.serv_spec_2_area       f,
		               prod.serv_spec              d,
		               prod.prod_spec              a
		         where a.sspec_comp_grp_id = b.sspec_comp_grp_id
		           and b.sspec_comp_grp_id = c.sspec_comp_grp_id
		           and c.serv_spec_id = d.serv_spec_id
		           and d.serv_spec_id = f.serv_spec_id
		           and a.spec_status_cd = 2
		           and d.spec_status_cd = 2
		           and not exists
		         (select 1
		                  from prod.sspec_comp_grp_rela e
		                 where e.sspec_comp_grp_id = b.sspec_comp_grp_id)
		           and exists (select 1
		                  from offer_prod op, offer_prod_status ops
		                 where op.redu_prod_spec_id = a.prod_spec_id
		                   and op.prod_id = #prodId#
		                   and op.prod_id = ops.prod_id
		                   and ops.prod_status_cd = 1)) ass,
		       spec.role_obj ro,
		       spec.offer_roles ros,
		       offer_spec oss
		 where not exists (select *
		          from offer_serv os
		         inner join offer_prod op
		            on os.prod_id = op.prod_id
		         where os.status_cd in ('10', '11', '12', '13')
		           and op.prod_id = #prodId#
		           and op.redu_prod_spec_id = #prodSpecId#
		           and ass.serv_spec_id = os.serv_spec_id)
		   
		   and ass.serv_spec_id = ro.OBJ_ID
		   and ro.OFFER_ROLE_ID = ros.OFFER_ROLE_ID
		   and ros.offer_spec_id = oss.offer_spec_id
		   
		   and ro.OBJ_TYPE = 4
		   
		   AND oss.STATUS_CD = 2
		   AND oss.END_DT > SYSDATE
		   AND ros.END_DT > SYSDATE
		   AND ro.END_DT > SYSDATE 
		   
		   and exists
		 (select 1
		          from offer_package_2_offer_spec a, offer_package_2_offer_spec aa
		         where a.offer_package_id = aa.offer_package_id
		           and aa.offer_spec_id =
		               (select c.offer_spec_id
		                  from offer_member b, offer c, offer_spec d
		                 where b.offer_id = c.offer_id
		                   and c.offer_spec_id = d.offer_spec_id
		                   and d.OFFER_TYPE_CD = 1
		                   and b.status_cd in ('10', '11', '12', '13', '20', '21')
		                   and c.status_cd in ('10', '11', '12', '13', '20', '21')
		                   and b.member_id = #prodId#
		                   and rownum < 2)
		           and a.offer_spec_id = ros.offer_spec_id)
		           
		  and exists (select 1
		          from intf.intf_channel_serv_spec ics
		         where ics.serv_spec_id = ass.serv_spec_id
		           and ics.channel_flag = 1)
		           
         order by (select la.label_id
             from spec.offer_spec_2_label os2l, spec.label la
            where os2l.label_id = la.label_id
              and oss.offer_spec_id = os2l.offer_spec_id
              and rownum = 1) desc		           
		           ]]>
	</select>
	
	<select id="queryOrderServSpecs" resultClass="ServSpecDto" parameterClass="java.util.HashMap">
	<![CDATA[
		select oss.offer_spec_id as servSpecId,
			   ass.serv_spec_id  as servSpecIdReal,
		       oss.name as servSpecName,
		       (select la.label_id
		          from spec.offer_spec_2_label os2l, spec.label la
		         where os2l.label_id = la.label_id
		           and oss.offer_spec_id = os2l.offer_spec_id
		           and rownum = 1) as groupId,
		       (select la.name
		          from spec.offer_spec_2_label os2l, spec.label la
		         where os2l.label_id = la.label_id
		           and oss.offer_spec_id = os2l.offer_spec_id
		           and rownum = 1) as groupName,
		       ass.default_sel as ifDefaultSel,
		       ass.IS_NUST_SEL as ifMustSel,
		       ass.is_exclusive as ifExclusive,
		       ass.min_member_qty as minsize
		  from (select d.serv_spec_id,
		               d.name,
		               b.sspec_comp_grp_id,
		               c.default_qty default_sel,
		               decode(c.min_qty, c.max_qty, 'Y', 'N') IS_NUST_SEL,
		               b.is_exclusive,
		               b.min_member_qty,
		               b.name group_name
		          from prod.sspec_comp_grp         b,
		               prod.sspec_comp_grp_2_sspec c,
		               prod.sspec_comp_grp_rela    e,
		               prod.serv_spec_2_area       f,
		               prod.serv_spec              d,
		               prod.prod_spec              a
		         where a.sspec_comp_grp_id = e.sspec_comp_grp_id
		           and b.sspec_comp_grp_id = c.sspec_comp_grp_id
		           and c.serv_spec_id = d.serv_spec_id
		           and d.serv_spec_id = f.serv_spec_id
		           and b.sspec_comp_grp_id in
		               (select o.sspec_comp_sub_id
		                  from prod.sspec_comp_grp_rela o
		                 Start With o.sspec_comp_grp_id = e.sspec_comp_grp_id
		                Connect By o.sspec_comp_grp_id = Prior o.sspec_comp_sub_id
		                union
		                select e.sspec_comp_grp_id from dual)
		           and a.spec_status_cd = 2
		           and d.spec_status_cd = 2
		           and exists (select 1
		                  from offer_prod op, offer_prod_status ops
		                 where op.redu_prod_spec_id = a.prod_spec_id
		                   and op.prod_id = #prodId#
		                   and op.prod_id = ops.prod_id
		                   and ops.prod_status_cd = 1)
		        union
		        select d.serv_spec_id,
		               d.name,
		               b.sspec_comp_grp_id,
		               c.default_qty default_sel,
		               decode(c.min_qty, c.max_qty, 'Y', 'N') IS_NUST_SEL,
		               b.is_exclusive,
		               b.min_member_qty,
		               b.name group_name
		          from prod.sspec_comp_grp         b,
		               prod.sspec_comp_grp_2_sspec c,
		               prod.serv_spec_2_area       f,
		               prod.serv_spec              d,
		               prod.prod_spec              a
		         where a.sspec_comp_grp_id = b.sspec_comp_grp_id
		           and b.sspec_comp_grp_id = c.sspec_comp_grp_id
		           and c.serv_spec_id = d.serv_spec_id
		           and d.serv_spec_id = f.serv_spec_id
		           and a.spec_status_cd = 2
		           and d.spec_status_cd = 2
		           and not exists
		         (select 1
		                  from prod.sspec_comp_grp_rela e
		                 where e.sspec_comp_grp_id = b.sspec_comp_grp_id)
		           and exists (select 1
		                  from offer_prod op, offer_prod_status ops
		                 where op.redu_prod_spec_id = a.prod_spec_id
		                   and op.prod_id = #prodId#
		                   and op.prod_id = ops.prod_id
		                   and ops.prod_status_cd = 1)) ass,
		       spec.role_obj ro,
		       spec.offer_roles ros,
		       offer_spec oss
		 where exists (select *
		          from offer_serv os
		         inner join offer_prod op
		            on os.prod_id = op.prod_id
		         where os.status_cd in ('10', '11', '12', '13', '21')
		           and op.prod_id = #prodId#
		           and op.redu_prod_spec_id = #prodSpecId#
		           and ass.serv_spec_id = os.serv_spec_id)
		           
		   and ass.serv_spec_id = ro.OBJ_ID
		   and ro.OFFER_ROLE_ID = ros.OFFER_ROLE_ID
		   and ros.offer_spec_id = oss.offer_spec_id
		   
		   and ro.OBJ_TYPE = 4
		   
		   and exists
		 (select 1
		          from offer_package_2_offer_spec a, offer_package_2_offer_spec aa
		         where a.offer_package_id = aa.offer_package_id
		           and aa.offer_spec_id =
		               (select c.offer_spec_id
		                  from offer_member b, offer c, offer_spec d
		                 where b.offer_id = c.offer_id
		                   and c.offer_spec_id = d.offer_spec_id
		                   and d.OFFER_TYPE_CD = 1
		                   and b.status_cd in ('10', '11', '12', '13', '20', '21')
		                   and c.status_cd in ('10', '11', '12', '13', '20', '21')
		                   and b.member_id = #prodId#
		                   and rownum < 2)
		           and a.offer_spec_id = ros.offer_spec_id)
		           ]]>
	</select>
	<select id = "queryServItemsByServSpecIdAndProdId" resultClass ="ServParam" parameterClass="java.util.HashMap">
		select a.item_spec_id as id, a.value as value
		  from offer_serv_item a
		 where a.serv_id in (select b.serv_id
		                       from offer_serv b
		                      where b.serv_spec_id = #servSpecId#
		                        and b.prod_id = #prodId#)
		   and a.item_spec_id not in (75801, 75802, 952)
		   and a.status_cd in ('10', '11', '12', '13')
		   and a.item_spec_id not in
			       (select d.attr1
			          from srule_app.busicode_rule_total d
			         where d.busicode = 'unusedItemInINTF')   
	</select>
	<select id = "queryItemSpecsByItemSpecIdAndServSpecId" resultClass ="ServParam" parameterClass="java.util.HashMap">
		SELECT DISTINCT ISP.NAME as name, SSI.IS_OPTIONAL as ifNullAble, ssi.default_value as defaultSpecValue, ISP.ITEM_SPEC_ID as id
		  FROM BSS_SYS.ITEM_SPEC ISP, BSS_SYS.DATA_TYPE DT, PROD.SSPEC_ITEM SSI
		 WHERE ISP.DATA_TYPE_CD = DT.DATA_TYPE_CD
		   AND SSI.ITEM_SPEC_ID = ISP.ITEM_SPEC_ID
		   AND ISP.ITEM_SPEC_ID = #itemSpecId#
		   AND SSI.SERV_SPEC_ID = #servSpecId#
		   and isp.item_spec_id not in
		       (select d.attr1
		          from srule_app.busicode_rule_total d
		         where d.busicode = 'unusedItemInINTF')		   
	</select>
	<select id = "queryDiscreateValuesByItemSpecId" resultClass ="DiscreateValue" parameterClass="java.lang.Long">
		SELECT DVL.META_KEY_VALUE as discreateValue, DVL.NAME as discreateValueName
		  FROM BSS_SYS.DISCRETE_VALUE_LIST DVL
		 WHERE DVL.ITEM_SPEC_ID = #itemSpecId# 
	</select>
	<select id = "querySservItemsByServSpecId" resultClass ="java.lang.Long" parameterClass="java.lang.Long">
		SELECT SSS.ITEM_SPEC_ID as id
		  FROM PROD.SSPEC_ITEM SSS
		 WHERE SSS.SERV_SPEC_ID = #servSpecId#
		   and sss.item_spec_id not in (75801, 75802, 952)
	</select>
	
	 <select id="isHaveInOffer" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
	 <![CDATA[    select distinct d.name offerName ,d.offer_spec_id  offerSpecId
         from offer_member a, offer b, prod_status_type c, offer_spec d
        where a.offer_id = b.offer_id
          and d.offer_spec_id = b.offer_spec_id
          and d.offer_type_cd = '1'
          and a.member_id = #prodId:VARCHAR#
          and a.status_cd in (10, 11, 12, 13)
          and b.status_cd in (10, 11, 12, 13)
          and a.obj_type = 2
          and rownum < 2
          union 
          select d.name offerName ,d.offer_spec_id  offerSpecId
          from offer_member a, offer b,  offer_spec d
          where a.offer_id = b.offer_id
          and d.offer_type_cd = '1'
          and d.offer_spec_id = b.offer_spec_id
          and a.member_id in ( select ov.serv_id from offer_serv ov where ov.prod_id = #prodId:VARCHAR#)
          and a.status_cd in (10, 11, 12, 13)
          and b.status_cd in (10, 11, 12, 13)
          and a.obj_type = 4
          and rownum < 2]]>
	</select>
	<select id = "qryPhoneNumberInfoByAccessNumber" resultClass ="java.util.HashMap" parameterClass="java.lang.String">
	 select * from rm.phone_number where phone_number =#accessNumber:VARCHAR# 
	</select>
	
	<select id="getOfferSpecNameByOfferSpecId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[SELECT OS.NAME FROM OFFER_SPEC OS WHERE OS.OFFER_SPEC_ID = #OFFERSPECID# AND ROWNUM < 2 ]]>
	</select>
	
	<select id="getPartyIdByAccNbr" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[SELECT op.redu_owner_id FROM offer_prod op WHERE op.redu_access_number = #accNbr# AND op.status_cd in ('10', '11', '12', '13','21') AND ROWNUM < 2 ]]>
	</select>
	<select id="findOfferProdComp"  resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT A.PROD_COMP_ID,
			       A.ATOM_ACTION_ID,
			       A.COMP_PROD_ID,
			       A.PROD_ID,
			       A.PROD_COMP_RELA_ROLE_CD,
			       A.START_DT,
			       A.END_DT,
			       A.STATUS_CD,
             A.STATUS_DT,
			       A.CREATE_DT,
			       A.VERSION
			  FROM OFFER_PROD_COMP A
			 WHERE A.STATUS_CD IN ('10', '11', '12', '13','21')
			   AND A.PROD_ID = #prodId:DECIMAL#
			   AND A.COMP_PROD_ID = #compProdId:DECIMAL#
	    ]]>
	</select>
		
	<insert id ="channelInfoGoDown" parameterClass="java.util.HashMap">
		insert into busiauth_interface t
		  (t.request_id,
		   t.channel_id,
		   t.parent_channel_id,
		   t.name,
		   t.manage_code,
		   t.channel_spec_id,
		   t.channel_spec_name,
		   t.action_flag,
		   t.read_date,
		   t.deal_state,
		   t.deal_date)
			values
		  (#id#,
		   #channelId#,
		   #parentChannelId#,
		   #agentName#,
		   #partyId#,
		   #channelSpecId#,
		   #channelSpecName#,
		   #actionFlag#,
		   SYSDATE,
		   '-1',
		   SYSDATE)
	</insert>
	
	<select id="yesOrNoAliveInOfferSpecRoles" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		SELECT *
	  FROM CTG_SPEC.OFFER_SPEC             OS,
	       SPEC.OFFER_PACKAGE_2_OFFER_SPEC OP,
	       CTG_SPEC.OFFER_SPEC             OS2
	 WHERE OS.OFFER_SPEC_ID = OP.OFFER_PACKAGE_ID
	   AND OP.OFFER_SPEC_ID = OS2.OFFER_SPEC_ID
	   AND OS.OFFER_SPEC_ID = #mainId#
	   AND OS2.OFFER_SPEC_ID = #id#
	</select>
	<select id="queryOfferInstByProdId" resultClass="com.linkage.bss.crm.intf.common.OfferIntf" parameterClass="java.lang.Long">
		<![CDATA[select o.offer_id as offerId,
			       os.offer_spec_id as offerSpecId,
			       os.name as offerSpecName,
			       o.status_cd as statusCd,
			       os.offer_type_cd as offerTypeCd,
			       (select om.offer_id
			          from offer_member om
			         where om.obj_type = 7
			           and om.offer_id = o.offer_id
			           and rownum < 2) as parentOfferId,
			       o.start_dt as startDt,
			       o.end_dt as endDt,
			       os.SUMMARY as summary,
			       o.party_id as partyId
			  from offer o, offer_spec os
			 where o.status_cd in ('11', '12', '13', '20', '21')
			   and o.offer_spec_id = os.offer_spec_id
			   and o.offer_id in
			       (select a.offer_id
			          from offer_member a
			         where a.obj_type = 2
			           and a.member_id = #prodId#
			           and a.status_cd in ('11', '12', '13', '20', '21')
			        union
			        select a.offer_id
			          from offer_member a, offer_serv b
			         where a.obj_type = 4
			           and a.member_id = b.serv_id
			           and b.prod_id = #prodId#
			           and a.status_cd in ('11', '12', '13', '20', '21')
			        union
			        select a.offer_id
			          from offer_member a, offer_coupon b
			         where a.obj_type = 8
			           and a.member_id = b.coupon_instance_id
			           and b.prod_id = #prodId#
			           and a.status_cd in ('11', '12', '13', '20', '21'))
				and os.offer_type_cd=1			           
			 order by os.offer_spec_id, o.offer_id, os.offer_type_cd, o.status_cd]]>			 
	</select>
	
	<select id="queryOrderOffersByProdId" resultClass="OfferInfoKF" parameterClass="java.lang.Long">
	<![CDATA[
		select distinct os.offer_spec_id as offerSpecId,
		                os.name          as offerSpecName,
		                os.SUMMARY       as summary,
		                o.start_dt       as startDt,
		                o.end_dt         as endDt,
		                l.label_id       as labelId,
		                l.name           as labelName,
		                l.min_number     as minNumber,
		                l.max_number     as maxNumber,
		                os.OFFER_TYPE_CD as offerTypeCd
		  from spec.label              l,
		       spec.offer_spec_2_label sl,
		       offer_spec              os,
		       offer                   o,
		       offer_member            om
		 where om.offer_id = o.offer_id
		   and o.offer_spec_id = os.offer_spec_id
		   and os.offer_spec_id = sl.offer_spec_id
		   and sl.label_id = l.label_id
		   and om.obj_type = 2
		   and om.member_id = #prodId#
		   and o.status_cd in ('10', '11', '12', '13', '21')
		union all
		select os.offer_spec_id as offerSpecId,
		       os.name as offerSpecName,
		       os.summary as summary,
		       o.start_dt as startDt,
		       o.end_dt as endDt,
		       decode(trunc(o.end_dt),trunc(last_day(sysdate)),-2,-1) as labelId,
		       '主体套餐包(此组套餐必选且只允许选择一款)' as labelName,
		       decode(trunc(o.end_dt),trunc(last_day(sysdate)),0,1) as min_number,
		       decode(trunc(o.end_dt),trunc(last_day(sysdate)),999,1) as max_number,
		       os.OFFER_TYPE_CD as offerTypeCd
		  from offer_spec                   os,
		       offer                        o,
		       offer_member                 om
		 where om.offer_id = o.offer_id
		   and o.offer_spec_id = os.offer_spec_id
		   and om.member_id = #prodId#
		   and os.OFFER_TYPE_CD=1
		   and o.status_cd in ('10', '11', '12', '13', '20', '21')	
		    ]]>
	</select>
	<select id="queryOptionOfferSpecsByProdId" resultClass="OfferInfoKF" parameterClass="java.util.HashMap">
	<![CDATA[
			select abc.offer_spec_id as offerSpecId,
			       abc.name          as offerSpecName,
			       abc.summary       as summary,
			       abc.label_id      as labelId,
			       abc.labelName     as labelName,
			       abc.min_number    as minNumber,
			       abc.max_number    as maxNumber,
			       abc.OFFER_TYPE_CD as offerTypeCd
			  from (select distinct os.offer_spec_id,
			                        os.name,
			                        os.summary,
			                        l.label_id,
			                        l.name as labelName,
			                        l.min_number,
			                        l.max_number,
			                        os.OFFER_TYPE_CD
			          from SPEC.label              l,
			               spec.offer_spec_2_label sl,
			               offer_spec              os,
			               spec.offer_roles        ros,
			               spec.role_obj           ro
			         where os.offer_spec_id = sl.offer_spec_id
			           and sl.label_id = l.label_id
			           and os.offer_spec_id = ros.offer_spec_id
			           and ros.OFFER_ROLE_ID = ro.OFFER_ROLE_ID
			              
			           and l.label_type = '3'
			           and ro.OBJ_TYPE <> '4'
			              
			           AND os.STATUS_CD = 2
			           AND os.END_DT > SYSDATE
			           AND ros.END_DT > SYSDATE
			           AND ro.END_DT > SYSDATE
			              
			           and os.offer_spec_id in
			               (select os2cn.offer_spec_id
			                  from crm_app.offer_package_2_offer_spec os2cn,
			                       crm_app.offer_package_2_offer_spec oscn
			                 where os2cn.offer_package_id = oscn.offer_package_id
			                   and oscn.offer_spec_id = #offerSpecId#
			                   and os2cn.offer_spec_id <> #offerSpecId#)
			              
			           and not exists
			         (select 1
			                  from crm_app.offer_member om, crm_app.offer o
			                 where o.offer_spec_id = os.offer_spec_id
			                   and om.offer_id = o.offer_id
			                   and om.member_id = #prodId#
			                   and o.status_cd in (11, '12', '13', '21'))
			              
			           and exists
			         (select 1
			                  from intf.intf_channel_offer_spec icos
			                 where icos.offer_spec_id = os.offer_spec_id
			                   and icos.channel_flag = 1)
			              
			           and ro.OBJ_ID = (select rso.OBJ_ID
			                              from offer_roles ors, crm_app.role_obj rso
			                             where ors.OFFER_ROLE_ID = rso.OFFER_ROLE_ID
			                               and ors.offer_spec_id = #offerSpecId#
			                               and rownum = 1)
			        union all
			        select osss.offer_spec_id as offerSpecId,
			               osss.name as offerSpecName,
			               osss.summary as summary,
			               -1 as labelId,
			               '主体套餐包(此组套餐必选且只允许选择一款)' as labelName,
			               1 as minNumber,
			               1 as maxNumber,
			               osss.OFFER_TYPE_CD as offerTypeCd
			          from offer_spec_2_category_node os2cn
			        
			          left join offer_spec_2_category_node oscn
			            on os2cn.category_node_id = oscn.category_node_id
			           and oscn.category_node_id > 0
			        
			          left join category_node bb
			            on oscn.category_node_id = bb.CATEGORY_NODE_ID
			           and bb.CATEGORY_ID = 100
			        
			         right join (select ao.offer_spec_id
			                       from (select os.offer_spec_id
			                               from crm_app.offer_member om
			                               join crm_app.offer o
			                                 on om.offer_id = o.offer_id
			                                and om.member_id = #prodId#
			                                and o.status_cd in
			                                    (11, '12', '13', '20', '21')
			                               join offer_spec os
			                                 on o.offer_spec_id = os.offer_spec_id
			                                and os.OFFER_TYPE_CD = 1
			                              order by o.status_cd asc) ao
			                      where rownum = 1) a
			            on oscn.offer_spec_id = a.offer_spec_id
			           and os2cn.category_node_id != '-1030038'
			        
			         right join offer_spec osss
			            on os2cn.offer_spec_id = osss.offer_spec_id
			           and osss.OFFER_TYPE_CD = 1
			        
			         where exists (select 1
			                  from intf.intf_channel_offer_spec icos
			                 where icos.offer_spec_id = os2cn.offer_spec_id
			                   and icos.channel_flag = 1)  and not exists
               (select 1
                        from crm_app.offer_member om, crm_app.offer o
                       where o.offer_spec_id = os2cn.offer_spec_id
                         and om.offer_id = o.offer_id
                         and om.member_id = #prodId#
                         and o.status_cd in (11, '12', '13', '21'))) abc
			
			 order by abc.label_id desc
		           ]]>
	</select>
	<select id="queryOfferParamsByOfferSpecId" resultClass="OfferParamKF" parameterClass="java.lang.Long">
	<![CDATA[
		select b.offer_spec_param_id as offerSpecParamId,
		       c.name as itemSpecName,
		       b.if_constant as notModify,
		       b.is_optional as ifNullAble,
		       c.data_type_cd as dataTypeCd,
		       c.unit_cd as unitCd,
		       c.item_spec_id as itemSpecId,
		       decode(c.unit_cd, 9, b.default_value / 100, b.default_value) as defaultValue
		  from crm_app.offer_spec_param b, crm_app.item_spec c
		 where b.item_spec_id = c.item_spec_id
		   and b.offer_spec_id = #offerSpecId#
		   and b.item_spec_id not in
		       (select d.attr1
		          from srule_app.busicode_rule_total d
		         where d.busicode = 'unusedItemInINTF')
		         ]]>
	</select>
	<select id="queryOfferParamsByProdIdAndOfferSpecId" resultClass="OfferParamKF" parameterClass="java.util.HashMap">
	<![CDATA[
		select b.offer_spec_param_id as offerSpecParamId,
		       a.name as itemSpecName,
		       b.if_constant as notModify,
		       b.is_optional as ifNullAble,
		       a.data_type_cd as dataTypeCd,
		       a.unit_cd as unitCd,
		       a.item_spec_id as itemSpecId,
		       decode(a.unit_cd, 9, cc.value / 100, cc.value) as value
		  from crm_app.item_spec a, crm_app.offer_spec_param b
		  left join (select c.*
		               from crm_app.offer_param c
		              where c.status_cd in ('10', '11', '12', '21')
		                and c.offer_id in
		                    (select om.offer_id
		                       from crm_app.offer_member om
		                      where om.member_id = #prodId#
		                        and om.status_cd in ('10', '11', '12', '21'))
		              order by c.status_cd desc) cc
		    on b.offer_spec_param_id = cc.offer_spec_param_id
		 where a.item_spec_id = b.item_spec_id
		   and b.offer_spec_id = #offerSpecId#
		   and a.item_spec_id not in
		       (select d.attr1
		          from srule_app.busicode_rule_total d
		         where d.busicode = 'unusedItemInINTF')		
		         ]]>                         
	</select>
	<select id="queryServOfferRelaByOfferSpecId" resultClass="ServSpecDto" parameterClass="java.lang.Long">
		SELECT DISTINCT R.RELA_OFFER_SPEC_ID as servSpecId,
		                T.NAME as servSpecName,
		                DECODE(R.RELA_TYPE_CD, 2, 'Y', 'N') IFMUSTSEL
		  FROM CTG_SPEC.OFFER_SPEC_RELA R,
		       CTG_SPEC.OFFER_ROLES     B,
		       CTG_SPEC.ROLE_OBJ        C,
		       CTG_SPEC.OFFER_SPEC      T
		 WHERE R.RELA_OFFER_SPEC_ID = B.OFFER_SPEC_ID
		   AND B.OFFER_ROLE_ID = C.OFFER_ROLE_ID
		   AND R.RELA_OFFER_SPEC_ID = T.OFFER_SPEC_ID
		   AND C.OBJ_TYPE = 4
		   AND R.RELA_TYPE_CD = 2
		   AND R.OFFER_SPEC_ID = #offerSpecId#
		UNION
		SELECT DISTINCT ROR.OBJ_ID as servSpecId,
		                T.NAME as servSpecName,
		                DECODE(ROR.RELA_TYPE_CD, 23, 'N', 'N') IFMUSTSEL
		  FROM CTG_SPEC.OFFER_ROLES     ORS,
		       SPEC.ROLE_OBJ_2_CFG_RULE ROCR,
		       SPEC.REQ_OBJ_RELA        ROR,
		       CTG_SPEC.OFFER_ROLES     B,
		       CTG_SPEC.ROLE_OBJ        C,
		       CTG_SPEC.OFFER_SPEC      T
		 WHERE ORS.OFFER_ROLE_ID = ROCR.OFFER_ROLE_ID
		   AND ROCR.CFG_RULE_ID = ROR.CFG_RULE_ID
		   AND ROR.OBJ_TYPE = 7
		   AND ROR.OBJ_ID = B.OFFER_SPEC_ID
		   AND B.OFFER_ROLE_ID = C.OFFER_ROLE_ID
		   AND C.OBJ_TYPE = 4
		   AND ROR.OBJ_ID = T.OFFER_SPEC_ID
		   AND ROR.RELA_TYPE_CD = 23
		   AND ORS.OFFER_SPEC_ID = #offerSpecId# 
	</select>
	<select  id="queryOfferSpecParamIdByItemSpecId" resultClass="java.lang.String" parameterClass="java.util.HashMap" >
	select offer_spec_param_id id from offer_spec_param where item_spec_id =#itemSpecId# and offer_spec_id =#offerSpecId#
	</select>	
	
	<select  id="queryProductSpec2CategroyNodeByProdSpecId" resultClass="java.lang.Integer" parameterClass="java.lang.Integer" >
		SELECT COUNT(1)
		  FROM PROD.PRODUCT_SPEC_2_CATEGORY_NODE PS
		 WHERE PS.CATEGORY_NODE_ID = -1010051
		   AND PS.PROD_SPEC_ID = #prodSpecId#
	</select>	
	
	<insert id ="insertCtgInstParty" parameterClass="java.util.HashMap">
		insert into ctg_inst.party
		  (PARTY_ID,
		   PARTY_NAME,
		   PARTY_TYPE,
		   CREATE_DATE,
		   STATUS_DATE
		   )
			values
		  (#partyId#,
		   #agentName#,
		   '2',
		   SYSDATE,
		   SYSDATE
		   )
	</insert>
	<insert id ="insertCtgInstCust" parameterClass="java.util.HashMap">
		insert into ctg_inst.cust
		  (CUST_ID,
		   PARTY_ID,
		   COMMON_REGION_ID,
		   ENTER_DATE,
		   CREATE_DATE,
		   STATUS_DATE,
		   MOD_DATE,
		   MAIL_ADDRESS_ID,
		   BUSINESS_PASSWORD,
		   QUERY_PASSWORD) 	
			values
		  (#partyId#,
		   #partyId#,
		   #AREA_ID#
		   SYSDATE,
		   SYSDATE,
		   SYSDATE,
		   SYSDATE,
		   #mailAddressId#,
		   #BUSINESS_PASSWORD#,
		   #QUERY_PASSWORD#
		   )
	</insert>
	
	<select id ="queryAttachOfferByProdId" parameterClass="java.lang.Long" resultMap="attachOfferDtoResultMap">
		<![CDATA[
		SELECT O.OFFER_SPEC_ID AS OFFERSPECID,
		       OSPEC.NAME 
		       ||(SELECT osi.value FROM offer_serv_item osi 
					WHERE osi.status_cd IN ('11','12','13','21')
					AND osi.item_spec_id = 17028 
					AND os.serv_id = osi.serv_id)  
		       AS OFFERSPECNAME,
		       O.OFFER_ID AS OFFERID,
			   OM.OFFER_MEMBER_ID AS OM_OFFERMEMBERID,
		       OM.OFFER_ID AS OM_OFFERID,
		       OM.OFFER_ROLE_ID AS OFFERROLEID,
		       OM.OBJ_TYPE AS OBJTYPE,
		       OM.MEMBER_ID AS MEMBERID,
		       O.START_DT AS STARTDT,
		       O.END_DT AS ENDDT,
		       O.STATUS_CD AS STATUSCD,
		       O.STATUS_DT AS STATUSDT,
		       OS.SERV_SPEC_ID AS SERVSPECID,
		       'SERV' AS OFFERSPECFLAG,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = OS.ATOM_ACTION_ID) AS OS_ATOMACTIONID,
		       O.ATOM_ACTION_ID AS ATOMACTIONID,
		       O.STATUS_CD AS OSTATUSCD,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = O.ATOM_ACTION_ID) AS BOID
		  FROM OFFER_MEMBER OM, OFFER_SERV OS, OFFER_SPEC OSPEC, OFFER O
		 WHERE OM.OFFER_ID = O.OFFER_ID
		   AND OM.MEMBER_ID = OS.SERV_ID
		   AND OM.OBJ_TYPE = 4
		   AND OSPEC.OFFER_SPEC_ID = O.OFFER_SPEC_ID
		   AND OM.STATUS_CD IN ('11','12','13','21')
		   AND O.STATUS_CD IN ('11','12','13','21')
		   AND OS.STATUS_CD IN ('11','12','13','21')
		   AND OS.SERV_ID IN (SELECT OS.SERV_ID
		                        FROM OFFER_SERV OS
		                       WHERE OS.STATUS_CD IN ('11','12','13','21')
		                         AND OS.PROD_ID = #prodId#)
		   AND OSPEC.OFFER_TYPE_CD = 2
		]]>		   
		<![CDATA[			      
		UNION
		SELECT O.OFFER_SPEC_ID AS OFFERSPECID,
		       OSPEC.NAME AS OFFERSPECNAME,
		       O.OFFER_ID AS OFFERID,
			   OM.OFFER_MEMBER_ID AS OM_OFFERMEMBERID,
		       OM.OFFER_ID AS OM_OFFERID,
		       OM.OFFER_ROLE_ID AS OFFERROLEID,
		       OM.OBJ_TYPE AS OBJTYPE,
		       OM.MEMBER_ID AS MEMBERID,
		       O.START_DT AS STARTDT,
		       O.END_DT AS ENDDT,
		       O.STATUS_CD AS STATUSCD,
		       O.STATUS_DT AS STATUSDT,
		       NULL AS SERVSPECID,
		       'PROD' AS OFFERSPECFLAG,
		       NULL AS OS_ATOMACTIONID,
		       O.ATOM_ACTION_ID AS ATOMACTIONID,
		       O.STATUS_CD AS OSTATUSCD,
		       (SELECT BO_ID
		          FROM ATOM_ACTION AA
		         WHERE AA.ATOM_ACTION_ID = O.ATOM_ACTION_ID) AS BOID
		  FROM OFFER_MEMBER OM, OFFER_SPEC OSPEC, OFFER O, OFFER_PROD OP
		 WHERE OM.OFFER_ID = O.OFFER_ID
		   AND OM.OBJ_TYPE = 2
		   AND OM.MEMBER_ID = OP.PROD_ID
		   AND OSPEC.OFFER_SPEC_ID = O.OFFER_SPEC_ID
		   AND OM.STATUS_CD IN ('11','12','13','21')
		   AND O.STATUS_CD IN ('11','12','13','21')
		   AND OP.PROD_ID = #prodId#
		   AND OSPEC.OFFER_TYPE_CD = 2	
		]]>
	</select>
	
	<select id ="getAuditingTicketInfoByOlId" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	 select distinct b.audit_ticket_id  id, b.value ,c.audit_ticket_cd cd
     from bo_2_audit a, auditing_ticket_attr b ,AUDITING_TICKET c
	 where a.bo_id in (select c.bo_id from busi_order c where c.ol_id = #olId#)
     and a.audit_ticket_id = b.audit_ticket_id
     and c.audit_ticket_id = a.audit_ticket_id
     and b.item_spec_id = '900000012' and <![CDATA[ ROWNUM < 2]]>
	</select>
		<!-- 查询有效的销售品参数 -->	
	<select id="queryOfferParamByOfferId" parameterClass="java.lang.Long" resultClass="OfferParams">
		SELECT OFFER_PARAM_ID AS OFFERPARAMID,
		       OFFER_ID AS OFFERID,
		       OFFER_SPEC_PARAM_ID AS OFFERSPECPARAMID,
		       VALUE AS VALUE,
		       STATUS_CD AS STATUSCD,
		       STATUS_DT AS STATUSDT,
		       START_DT AS STARTDT,
		       END_DT ENDDT,
		       CREATE_DT CREATEDT,
		       VERSION VERSION
		  FROM OFFER_PARAM
		 WHERE STATUS_CD IN ('10','11','12','13','21')  
    	   AND OFFER_ID = #offerId:DECIMAL#
	</select>
	<select id ="queryCountPS2CNByAccNbr" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		select count(1) as cnt
		  from offer_prod a, prod.product_spec_2_category_node b
		 where a.redu_prod_spec_id = b.prod_spec_id
		   and b.category_node_id in ('-1010051', '-1010053')
		   and a.redu_access_number = #accNbr#	
	</select>
	<select id ="queryCurrentPPInfosFixedByAccNbr" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT os.offer_spec_id as offerSpecId,
		       os.name          as name,
		       om.start_dt      as startDt,
		       om.end_dt        as endDt
		  FROM SPEC.OFFER_SPEC_GRP      P,
		       SPEC.OFFER_SPEC_GRP_RELA A,
		       offer_prod               op,
		       offer_member             om,
		       offer                    o,
		       offer_spec               os,
		       offer_prod_status        ops
		 WHERE P.OFFER_SPEC_GRP_ID = A.OFFER_SPEC_GRP_ID
		   AND P.OFFER_SPEC_GRP_ID = 262
		   and op.prod_id = om.member_id
		   and om.offer_id = o.offer_id
		   and o.offer_spec_id = os.offer_spec_id
		   and os.offer_spec_id = a.sub_offer_spec_id
		   and op.redu_access_number = #accNbr#
		   and op.prod_id=ops.prod_id
		   and ops.prod_status_cd = 1	
	</select>
	<select id ="queryContinuePPInfosFixedByAccNbr" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT os.offer_spec_id as offerSpecId,
		       os.name          as name,
		       om.start_dt      as startDt,
		       om.end_dt        as endDt
		  FROM SPEC.OFFER_SPEC_GRP      P,
		       SPEC.OFFER_SPEC_GRP_RELA A,
		       offer_prod               op,
		       offer_member             om,
		       offer                    o,
		       offer_spec               os
		 WHERE P.OFFER_SPEC_GRP_ID = A.OFFER_SPEC_GRP_ID
		   AND P.OFFER_SPEC_GRP_ID = 262
		   and op.prod_id = om.member_id
		   and om.offer_id = o.offer_id
		   and o.offer_spec_id = os.offer_spec_id
		   and os.offer_spec_id = a.sub_offer_spec_id
		   and op.redu_access_number = #accNbr#	
	</select>
	<select id ="queryWlaneLogByAccNbr" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT count(1) as cnt
		  FROM intf.WLANE_LOG WL
		 WHERE WL.ACCNBR = #accNbr#
		   AND WL.CREATE_DT >= ADD_MONTHS(SYSDATE, -5)	
	</select>
	<select id ="queryCountContinueOrderOfferByAccNbr" parameterClass="java.lang.String" resultClass="java.lang.Integer">
	<![CDATA[
		SELECT COUNT(*) as cnt
		  FROM offer_spec                     os,
		       intf.continue_order_offer_spec coos,
		       offer_spec_param               osp,
		       BSS_SYS.ITEM_SPEC              I
		 WHERE os.offer_spec_id = coos.FUTURE_OFFER_SPEC_ID
		   AND coos.FUTURE_OFFER_SPEC_ID = osp.OFFER_SPEC_ID
		   and os.STATUS_CD = '2'
		   AND osp.ITEM_SPEC_ID IN (20447,
		                            20458,
		                            20434,
		                            20426,
		                            20427,
		                            23981,
		                            23990,
		                            23982,
		                            23991,
		                            23983,
		                            23992,
		                            23984,
		                            23993,
		                            20457,
		                            20439,
		                            20584,
		                            20438,
		                            20585,
		                            20435,
		                            20448,
		                            20465,
		                            20445,
		                            20432,
		                            20446,
		                            20455,
		                            20466,
		                            20582,
		                            20433,
		                            20456,
		                            20583)
		   AND I.ITEM_SPEC_ID = osp.ITEM_SPEC_ID
		   AND coos.Offer_Spec_Id IN
		       (select distinct e.offer_spec_id
		          from offer_prod_status              a,
		               offer_prod                     b,
		               offer_member                   c,
		               offer                          d,
		               offer_spec                     e,
		               intf.continue_order_offer_spec f
		         where a.prod_id = b.prod_id
		           and a.prod_status_cd = 1
		           and b.prod_id = c.member_id
		           and c.offer_id = d.offer_id
		           and d.offer_spec_id = e.offer_spec_id
		           and e.offer_spec_id = f.offer_spec_id
		           and b.redu_access_number = #accNbr#
		           and d.end_dt < LAST_DAY(TRUNC(SYSDATE)) + 1
		           and d.status_cd in (11, 12, 13, 20, 21)
		           and not exists (select 1
		                  from offer_prod_status ps2
		                 where a.prod_id = ps2.prod_id
		                   and ps2.prod_status_cd = '13'))
     ]]>	
	</select>
	<select id ="queryCurrentPPInfosByAccNbr" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	<![CDATA[
		select distinct os.offer_spec_id    as offerSpecId,
		       os.name             as name,
		       o.start_dt          as startDt,
		       o.end_dt            as endDt,
		       o.status_cd         as statusCd,
		       osp.default_value   as defaultValue,
		       isp.item_spec_id    as itemSpecId,
		       isp.name            as itemSpecName,
		       osi.change_eff_time as changeEffTime
		  from offer_prod_status              ops,
		       offer_prod                     op,
		       offer_member                   om,
		       offer                          o,
		       offer_spec                     os,
		       intf.continue_order_offer_spec coos
		  left join offer_spec_param osp
		    on coos.offer_spec_id = osp.offer_spec_id
		 right join item_spec isp
		    on osp.item_spec_id = isp.item_spec_id
		   and isp.item_spec_id in (20447,
		                            20458,
		                            20434,
		                            20426,
		                            20427,
		                            23981,
		                            23990,
		                            23982,
		                            23991,
		                            23983,
		                            23992,
		                            23984,
		                            23993,
		                            20457,
		                            20439,
		                            20584,
		                            20438,
		                            20585,
		                            20435,
		                            20448,
		                            20465,
		                            20445,
		                            20432,
		                            20446,
		                            20455,
		                            20466,
		                            20582,
		                            20433,
		                            20456,
		                            20583)
		  left join SPEC.OFFER_SPEC_INFO osi
		    on osi.offer_spec_id = coos.offer_spec_id
		 where op.prod_id = ops.prod_id
		   and ops.prod_status_cd = 1
		   and op.prod_id = om.member_id
		   and om.offer_id = o.offer_id
		   and o.offer_spec_id = os.offer_spec_id
		   and os.offer_spec_id = coos.offer_spec_id
		   and op.redu_access_number = #accNbr#
		   and o.status_cd in (11, 12, 13, 20, 21)
		   ]]>
	</select>
	<select id ="queryContinuePPInfosByAccNbr" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	<![CDATA[
		select distinct os.offer_spec_id    as offerSpecId,
		                os.name             as name,
		                osp.default_value   as defaultValue,
		                isp.item_spec_id    as itemSpecId,
		                isp.name            as itemSpecName,
		                osi.change_eff_time as changeEffTime
		  from offer_spec                     os,
		       intf.continue_order_offer_spec coos,
		       offer_spec_param               osp,
		       item_spec                      isp,
		       SPEC.OFFER_SPEC_INFO           osi
		 where osi.offer_spec_id = os.offer_spec_id
		   and os.offer_spec_id = coos.future_offer_spec_id
		   and coos.future_offer_spec_id = osp.offer_spec_id
		   and osp.item_spec_id = isp.item_spec_id
		   and isp.item_spec_id in (20447,
		                            20458,
		                            20434,
		                            20426,
		                            20427,
		                            23981,
		                            23990,
		                            23982,
		                            23991,
		                            23983,
		                            23992,
		                            23984,
		                            23993,
		                            20457,
		                            20439,
		                            20584,
		                            20438,
		                            20585,
		                            20435,
		                            20448,
		                            20465,
		                            20445,
		                            20432,
		                            20446,
		                            20455,
		                            20466,
		                            20582,
		                            20433,
		                            20456,
		                            20583)
		   and coos.offer_spec_id in
		       (select distinct e.offer_spec_id
		          from offer_prod_status              a,
		               offer_prod                     b,
		               offer_member                   c,
		               offer                          d,
		               offer_spec                     e,
		               intf.continue_order_offer_spec f
		         where a.prod_id = b.prod_id
		           and a.prod_status_cd = 1
		           and b.prod_id = c.member_id
		           and c.offer_id = d.offer_id
		           and d.offer_spec_id = e.offer_spec_id
		           and e.offer_spec_id = f.offer_spec_id
		           and b.redu_access_number = #accNbr#
		           and d.end_dt < LAST_DAY(TRUNC(SYSDATE)) + 1
		           and d.status_cd in (11, 12, 13, 20, 21))		
	]]>
	</select>
	
	<select id="queryAllChildCompProd" parameterClass="java.util.HashMap" resultMap="IntfDAO.resultCommonOfferProd">
		<![CDATA[
		SELECT OP.PROD_ID,
		       OP.AREA_ID,
		       OP.REDU_PROD_SPEC_ID PROD_SPEC_ID,
		       PS.NAME PROD_SPEC_NAME,
		       NVL((SELECT OPN.ACCESS_NUMBER
		             FROM OFFER_PROD_NUMBER OPN
		            WHERE OPN.PROD_ID = OP.PROD_ID
		              AND OPN.STATUS_CD IN ('20', '21', '23')
		              AND ROWNUM < 2),
		           OP.REDU_ACCESS_NUMBER) AS ACCESS_NUMBER,
		       TO_CHAR(OP.START_DT, 'yyyy-mm-dd') START_DT,
		       TO_CHAR(OP.END_DT, 'yyyy-mm-dd') END_DT,
		       OP.STATUS_CD,
		       STS.NAME AS STATUS_NAME,
		       0 COMP_PROD_ID,
		       OP.REDU_OWNER_ID,
		       (SELECT P.NAME
		          FROM PARTY P
		         WHERE P.PARTY_ID = OP.REDU_OWNER_ID
		           AND ROWNUM < 2) PARTY_NAME,
		       2 COMP_FLAG,
		       FT.FEE_TYPE,
		       FT.NAME AS FEE_TYPE_NAME,
		       (SELECT DISTINCT PCRR.NAME
		          FROM OFFER_PROD_COMP OPC, PROD_COMP_RELA_ROLE PCRR
		         WHERE PCRR.PROD_COMP_RELA_ROLE_CD = OPC.PROD_COMP_RELA_ROLE_CD
		           AND OPC.PROD_ID = OP.PROD_ID
		           AND OPC.STATUS_CD IN ('10', '11', '12', '13')
		           AND OPC.COMP_PROD_ID = #prodId#
		           AND ROWNUM < 2) AS MEMBER_NAME
		  FROM OFFER_PROD          OP,
		       INST_STATUS         STS,
		       PROD_SPEC           PS,
		       OFFER_PROD_FEE_TYPE OPFT,
		       FEE_TYPE            FT
		 WHERE OPFT.FEE_TYPE = FT.FEE_TYPE
		   AND SO_STATUS.CHECK_IF_INST_EFF(OPFT.STATUS_CD) = 0
		   AND OPFT.PROD_ID = OP.PROD_ID
		   AND OP.STATUS_CD = STS.STATUS_CD
		   AND PS.PROD_SPEC_ID = OP.REDU_PROD_SPEC_ID
		   AND op.prod_id = #prodId#
		   AND STS.STATUS_CD IN ('10', '11', '12', '13', '20', '21', '23')
		]]>
		<isNotEmpty property="partyId" >
		     AND OP.REDU_OWNER_ID = #partyId:NUMERIC#
		     </isNotEmpty>
	</select>	
	<select id="queryAllProdStatus" resultMap="resultOfferProdStatusDto">
		SELECT OPS.PROD_STATUS_CD,
	       (SELECT PST.NAME
	          FROM PROD_STATUS_TYPE PST
	         WHERE PST.PROD_STATUS_CD = OPS.PROD_STATUS_CD) PROD_STATUS_NAME,
	       OPS.STATUS_CD PROD_STS_CD,
	       (SELECT INS.NAME
	          FROM INST_STATUS INS
	         WHERE INS.STATUS_CD = OPS.STATUS_CD) PROD_STS_NAME
	  FROM OFFER_PROD_STATUS OPS
	 WHERE OPS.STATUS_CD IN ('10','11','12','13','20','21','23')
	  AND OPS.PROD_ID =#prodId#
	</select>	
	<select  id="isPKagent" resultClass="java.lang.String" parameterClass="java.lang.String" >
		SELECT BUP.ISDLS
  		FROM BATCH_UNIT_PAY BUP
 		WHERE BUP.PAYINDENTID = #payIndentId#
	</select>
	<select id ="getIntfCommonSeq" resultClass = "java.lang.String" >
     	SELECT SEQ_INTF_COMMON.NEXTVAL FROM dual
    </select>
    <select id ="getIntfTimeCommonSeq" resultClass = "java.lang.String" >
     	SELECT SEQ_INTFREQUEST_TIME.NEXTVAL FROM dual
    </select>
    <insert id='saveRequestInfo' parameterClass='java.util.HashMap'>
		INSERT INTO intf_request_LOG(ID,PLAT,METHOD_NAME,REQUEST,REQUEST_TIME)
		VALUES(#id#, #plat#, #method#, #request#, #requestTime#)
	</insert>
	 <insert id='saveRequestTime' parameterClass='java.util.HashMap'>
		INSERT INTO INTF.INTF_REQUEST_TIME(id,method_name,accessNumber,identityNum,request_time)
		VALUES(#id#,#method_name#, #accessNumber#, #identityNum#, #requestTime#)
	</insert>
	<update id="updateRequestTime" parameterClass="java.util.HashMap">
		update INTF.INTF_REQUEST_TIME
		<dynamic prepend="set">
			<isNotNull property="time1" prepend=",">
				time1 =#time1# 
	    </isNotNull>
			<isNotNull property="time2" prepend=",">
				time2=#time2#
			</isNotNull>
			<isNotNull property="time3" prepend=",">
				time3=#time3#
	    </isNotNull>
	    <isNotNull property="time4" prepend=",">
				time4=#time4#
	    </isNotNull>
		</dynamic>
		where id=#id#
	</update>
	<insert id='saveCRMResponseInfo' parameterClass='java.util.HashMap'>
		INSERT INTO INTF_RESPONSE_LOG(ID, PLAT, METHOD_NAME, REQUEST, REQUEST_TIME, RESPONSE, RESPONSE_TIME, INTF_TYPE, RESULT_CODE)
		VALUES(#id#, #plat#, #method#, #request#, #requestTime#, #response#, #responseTime#, #type#, #resultCode#)
	</insert>
	<delete id='deleteRequestInfo' parameterClass='java.util.HashMap'>
		DELETE FROM intf_request_LOG req WHERE req.id=#id#
	</delete>
	
	<select id = "yesOrNoNeedAddCoupon" resultClass="java.lang.Integer" parameterClass="java.util.HashMap" >
	     select count(*) from offer_spec_2_atom_action_type a where a.offer_spec_id =#offerSpecId# and a.atom_action_type_cd = 50
	</select>
	
	<select id = "ifCompProdByProdSpecId" resultClass="java.lang.String" parameterClass="java.lang.Integer" >
	     select a.COMP_PROD from prod_spec a where  a.prod_spec_id=#prodSpecId#
	</select>
	
	<select id = "ifRightPartyGradeByCustTypeAndPartyGrade" resultClass="java.lang.Integer" parameterClass="java.util.HashMap" >
	     select count(1) from base_data a where a.id=#custType# and a.value=#partyGrade#
	</select>
	<select id = "queryOlIdByOlNbr" resultClass="java.lang.String" parameterClass="java.lang.String" >
	     select ol_id from order_list where ol_nbr = #olNbr#
	</select>
	
	<select id = "getPartyNameByPartyId" resultClass="java.lang.String" parameterClass="java.lang.Long" >
	     SELECT p.Name FROM party p WHERE p.party_id=#partyId#
	</select>
	
	<select id = "getPartyIdByTerminalCode" resultClass="java.lang.String" parameterClass="java.lang.String" >
	     SELECT op.redu_owner_id FROM offer_prod_2_td ot, offer_prod op WHERE ot.prod_id = op.prod_id AND ot.terminal_code =#terminalCode#
	</select>
	
	<select id = "getOfferListByProdId" resultClass="java.util.HashMap" parameterClass="java.lang.String" >
	     SELECT O.OFFER_ID, O.OFFER_SPEC_ID
 		 FROM OFFER O, OFFER_MEMBER OM
		 WHERE O.OFFER_ID = OM.OFFER_ID
   		 AND O.STATUS_CD IN (10, 11, 12, 13, 21)
   		 AND OM.MEMBER_ID = #prodId#
	</select>
	
	<select id = "getPartyIdByIdentifyNum" resultClass="java.lang.Long" parameterClass="java.lang.String" >
	     select a.party_id from PARTY_IDENTITY a where a.identity_num= #accNbr# and <![CDATA[rownum <2]]>
	</select>
	
	<select id = "getProdidByAccNbr" resultClass="java.lang.Long" parameterClass="java.lang.String" >
	    select a.prod_id from crm_app.offer_prod a where a.redu_access_number=#redu_access_number# AND a.STATUS_CD IN (10, 11, 12, 13, 21) and <![CDATA[rownum <2]]>
	</select>
	
	<select id = "getGxProdItemIdByProdid" resultClass="java.lang.Long" parameterClass="java.lang.Long" >
		select a.value from offer_prod_item a
		where a.item_spec_id ='13380379' and a.prod_id = #prodid# and <![CDATA[rownum <2]]>
	</select>
	
	<select id = "getPartyIdByProdId" resultClass="java.lang.Long" parameterClass="java.lang.Long" >
	     SELECT OP.redu_owner_id FROM OFFER_PROD OP WHERE OP.PROD_ID = #prodId# and OP.STATUS_CD IN(10,11,12,13,20,21)
	</select>
	<select id="queryOrderListInfoByParam" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
	select * from (select *
		from (select /*+ index(ol PK_CUSTOMER_ORDER) */
	   ol.ol_id,
       ol.ol_nbr,
       ol.status_dt,
       ol.so_date,
       ol.status_cd,
       ol.ol_type_cd,
       (select ce.name from channel ce where ce.channel_id = ol.channel_id) channel_name,
       (SELECT MANAGE_CODE FROM CHANNEL C WHERE C.CHANNEL_ID = OL.CHANNEL_ID) manager_code,
       (SELECT NAME FROM AREA WHERE AREA_ID = OL.AREA_ID) AREANAME,
       (SELECT NAME FROM OUR_STAFF WHERE STAFF_ID = OL.STAFF_ID) STAFF_NAME,
        (SELECT staff_number FROM OUR_STAFF WHERE STAFF_ID = OL.STAFF_ID) staff_number,
       (SELECT NAME FROM order_list_type oe WHERE ol.ol_type_cd = oe.ol_type_cd) ol_type_name,
       (SELECT NAME FROM order_status os WHERE ol.status_cd = os.status_cd) status_name,
       (SELECT NAME FROM party py WHERE ol.party_id = py.party_id) party_name,
       rownum as rrOr
     from order_list ol
     where ol.status_cd != 'D'
    <isNotEmpty property="olNbr" prepend="AND"> 
    OL.ol_nbr = #olNbr# 
    </isNotEmpty>
    <isNotEmpty property="staffCode" prepend="AND">
    OL.STAFF_ID in (select our.staff_id from  OUR_STAFF our where our.staff_number =  #staffCode#)
    </isNotEmpty> 
    <isNotEmpty property="channelId" prepend="AND"> 
    OL.CHANNEL_ID = #channelId# 
    </isNotEmpty> 
    <isNotEmpty property="areaId" prepend="AND">
    OL.AREA_ID  =  #areaId# 
     </isNotEmpty> 
    <isNotEmpty property="statusCd" prepend="AND"> 
    OL.status_cd = #statusCd#
    </isNotEmpty>
    <isNotEmpty property="accessNumber" prepend="AND">
     OL.OL_ID IN (
  select a.ol_id
    from inst.offer_prod c,so.busi_order a, so.prod_order b
   where a.bo_id = b.bo_id
     and b.prod_id = c.prod_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union all 
  select a.ol_id
    from  inst.offer_prod c,so.busi_order a, so.oo_role b
   where a.bo_id = b.bo_id
     and b.obj_type = 2
     and b.obj_inst_id = c.prod_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union all 
  select a.ol_id
    from inst.offer_prod c,so.busi_order a, so.acct_info_order b 
   where a.bo_id = b.bo_id
     and b.acct_id = c.redu_acct_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union all 
  select a.ol_id
    from inst.offer_prod c,so.busi_order a, so.cust_info_order b
   where a.bo_id = b.bo_id
     and b.party_id = c.redu_owner_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union all 
  SELECT distinct bo.ol_id
    FROM busi_order bo, bo_prod_an bpn, prod_order po
   WHERE bo.bo_id = bpn.bo_id
     and bo.bo_id = po.bo_id
     and bpn.access_number = #accessNumber:VARCHAR#
  union all 
  select bo.ol_id
    from offer_member om,
         offer_param  op,
         offer_prod   opr,
         busi_order   bo,
         oo_param     oo
   where opr.redu_access_number = #accessNumber:VARCHAR#
     and opr.prod_id = om.member_id
     and om.offer_id = op.offer_id
     and op.offer_param_id = oo.offer_param_id
     and oo.bo_id = bo.bo_id 
  union all 
  SELECT bo.ol_id
    FROM busi_order bo, bam_acct_item_info bai
   WHERE bai.acc_nbr = #accessNumber:VARCHAR#
     AND bai.ol_id = bo.ol_id
     AND bo.bo_action_type_cd IN ('1252', '1253', '1220') 
  union all 
  select a.ol_id
    from offer_prod c,busi_order a, oo_role b
   where a.bo_id = b.bo_id
     and b.obj_type = 13
     and c.redu_access_number = #accessNumber:VARCHAR#
     and c.redu_owner_id = a.party_id) 
     </isNotEmpty>
       order by ol.ol_id desc) wW where 1=1
       <isNotEmpty property="startDt" prepend="AND"> 
   <![CDATA[ SO_DATE >= TO_DATE(#startDt:VARCHAR#, 'YYYY-MM-DD')]]>
    </isNotEmpty>
    <isNotEmpty property="endDt" prepend ="AND"> 
    <![CDATA[SO_DATE <= TO_DATE(#endDt:VARCHAR#, 'YYYY-MM-DD') ]]>
    </isNotEmpty>
     ) yy
  where rrOr between #startNum# and #endNum#
	</select>
	<!-- 根据购物车ID查询主接入号或者根据主接入号查询购物车ID -->
	<select id = "queryAccessNumberByOlId" resultClass="java.lang.String" parameterClass="java.util.HashMap">
	select cc from ( select c.redu_access_number cc
    from so.busi_order a, so.prod_order b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.prod_id = c.prod_id
     <isNotEmpty property="olIdStr" prepend="AND">
     a.ol_id =#olIdStr#
     </isNotEmpty>
  union
  select c.redu_access_number cc
    from so.busi_order a, so.oo_role b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.obj_type = 2
     and b.obj_inst_id = c.prod_id
     <isNotEmpty property="olIdStr" prepend="AND">
     a.ol_id =#olIdStr#
     </isNotEmpty>
  union
  select c.redu_access_number cc
    from so.busi_order a, so.acct_info_order b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.acct_id = c.redu_acct_id
     <isNotEmpty property="olIdStr" prepend="AND">
      a.ol_id =#olIdStr#
     </isNotEmpty>
  union
  select c.redu_access_number cc
    from so.busi_order a, so.cust_info_order b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.party_id = c.redu_owner_id
     <isNotEmpty property="olIdStr" prepend="AND">
      a.ol_id =#olIdStr#
     </isNotEmpty>
  union
  SELECT distinct bpn.access_number cc
    FROM busi_order bo, bo_prod_an bpn, prod_order po
   WHERE bo.bo_id = bpn.bo_id
     and bo.bo_id = po.bo_id
     <isNotEmpty property="olIdStr" prepend="AND">
    bo.ol_id =#olIdStr#
     </isNotEmpty>
  union
  select opr.redu_access_number cc
    from oo_param     oo, 
         offer_param  op,
         offer_member om,
         offer_prod   opr,
         busi_order   bo
   where  opr.prod_id = om.member_id
     and om.offer_id = op.offer_id
     and op.offer_param_id = oo.offer_param_id
     and oo.bo_id = bo.bo_id
      <isNotEmpty property="olIdStr" prepend="AND">
     bo.ol_id =#olIdStr#
     </isNotEmpty>
  union
  SELECT bai.acc_nbr cc
    FROM busi_order bo, bam_acct_item_info bai
   WHERE bai.ol_id = bo.ol_id
     <isNotEmpty property="olIdStr" prepend="AND">
    	bo.ol_id =#olIdStr#
   	  </isNotEmpty>
     AND bo.bo_action_type_cd IN ('1252', '1253', '1220')
  union
  select c.redu_access_number cc
    from busi_order a, oo_role b, offer_prod c
   where a.bo_id = b.bo_id
     and b.obj_type = 13
     <isNotEmpty property="olIdStr" prepend="AND">
      a.ol_id =#olIdStr#
     </isNotEmpty>
     and c.redu_owner_id = a.party_id  ) t where  <![CDATA[rownum < 2]]>
	</select>
   <select id="queryHisOrderListInfoByParam" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
 select * from (select
		ol.ol_id,
       ol.ol_nbr,
       ol.status_dt,
       ol.so_date,
       ol.status_cd,
       ol.ol_type_cd,
       (select ce.name from channel ce where ce.channel_id = ol.channel_id) channel_name,
       (SELECT MANAGE_CODE FROM CHANNEL C WHERE C.CHANNEL_ID = OL.CHANNEL_ID) manager_code,
       (SELECT NAME FROM AREA WHERE AREA_ID = OL.AREA_ID) AREANAME,
       (SELECT NAME FROM OUR_STAFF WHERE STAFF_ID = OL.STAFF_ID) STAFF_NAME,
        (SELECT staff_number FROM OUR_STAFF WHERE STAFF_ID = OL.STAFF_ID) staff_number,
       (SELECT NAME FROM order_list_type oe WHERE ol.ol_type_cd = oe.ol_type_cd) ol_type_name,
       (SELECT NAME FROM order_status os WHERE ol.status_cd = os.status_cd) status_name,
       (SELECT NAME FROM party py WHERE ol.party_id = py.party_id) party_name,
       rownum as rrOr
     from so_his.order_list ol
     where ol.status_cd != 'D'
    <isNotEmpty property="olNbr" prepend="AND"> 
    OL.ol_nbr = #olNbr# 
    </isNotEmpty>
    <isNotEmpty property="staffCode" prepend="AND">
    OL.STAFF_ID in (select our.staff_id from  OUR_STAFF our where our.staff_number =  #staffCode#)
    </isNotEmpty> 
    <isNotEmpty property="channelId" prepend="AND"> 
    OL.CHANNEL_ID = #channelId# 
    </isNotEmpty> 
    <isNotEmpty property="areaId" prepend="AND">
    OL.AREA_ID  =  #areaId# 
     </isNotEmpty> 
    <isNotEmpty property="startDt" prepend="AND"> 
   <![CDATA[ OL.SO_DATE >= TO_DATE(#startDt:VARCHAR#, 'YYYY-MM-DD')]]>
    </isNotEmpty>
    <isNotEmpty property="endDt" prepend ="AND"> 
    <![CDATA[OL.SO_DATE <= TO_DATE(#endDt:VARCHAR#, 'YYYY-MM-DD')]]>
    </isNotEmpty>
    <isNotEmpty property="statusCd" prepend="AND"> 
    OL.status_cd = #statusCd#
    </isNotEmpty>
    <isNotEmpty property="accessNumber" prepend="AND">
     OL.OL_ID IN (
  select a.ol_id
    from so.busi_order a, so.prod_order b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.prod_id = c.prod_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union
  select a.ol_id
    from so.busi_order a, so.oo_role b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.obj_type = 2
     and b.obj_inst_id = c.prod_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union
  select a.ol_id
    from so.busi_order a, so.acct_info_order b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.acct_id = c.redu_acct_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union
  select a.ol_id
    from so.busi_order a, so.cust_info_order b, inst.offer_prod c
   where a.bo_id = b.bo_id
     and b.party_id = c.redu_owner_id
     and c.redu_access_number = #accessNumber:VARCHAR#
  union
  SELECT distinct bo.ol_id
    FROM busi_order bo, bo_prod_an bpn, prod_order po
   WHERE bo.bo_id = bpn.bo_id
     and bo.bo_id = po.bo_id
     and bpn.access_number = #accessNumber:VARCHAR#
  union
  select bo.ol_id
    from oo_param     oo,
         offer_param  op,
         offer_member om,
         offer_prod   opr,
         busi_order   bo
   where opr.redu_access_number = #accessNumber:VARCHAR#
     and opr.prod_id = om.member_id
     and om.offer_id = op.offer_id
     and op.offer_param_id = oo.offer_param_id
     and oo.bo_id = bo.bo_id 
  union
  SELECT bo.ol_id
    FROM busi_order bo, bam_acct_item_info bai
   WHERE bai.acc_nbr = #accessNumber:VARCHAR#
     AND bai.ol_id = bo.ol_id
     AND bo.bo_action_type_cd IN ('1252', '1253', '1220') 
  union
  select a.ol_id
    from busi_order a, oo_role b, offer_prod c
   where a.bo_id = b.bo_id
     and b.obj_type = 13
     and c.redu_access_number = #accessNumber:VARCHAR#
     and c.redu_owner_id = a.party_id) 
     </isNotEmpty>
       order by ol.ol_id desc) wW where 
     rrOr between #startNum# and #endNum#
	</select>
	<select id="queryPayIndentIdByOlIdAndFlag" parameterClass="java.lang.String" resultClass="java.lang.String">
	select pay_indent_id from unitypay_interface where pay_indent_id  = #payIndentId# and   <![CDATA[rownum <2]]>
     </select>
      <select id="checkRelaSub" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
       select count(1)
       from offer_spec_grp t
      where t.offer_spec_grp_id in
            (select distinct a.offer_spec_grp_id
               from offer_spec_grp_rela a, offer_spec_grp_rela b
              where a.sub_offer_spec_id = #newOfferSpecId#
                and b.sub_offer_spec_id = #oldOfferSpecId#
                and a.offer_spec_grp_id = b.offer_spec_grp_id)
        and t.is_exclusive = 'Y'
     </select>
     
     	<select id="queryOfferSpecIdByProdId" resultClass="java.lang.String"
		parameterClass="java.lang.String">
		<![CDATA[
	      SELECT O.OFFER_SPEC_ID FROM OFFER O, OFFER_MEMBER OM 
	      WHERE O.OFFER_ID = OM.OFFER_ID
	      AND OM.STATUS_CD IN ('11','12','13','21','20')	
	      AND O.STATUS_CD IN ('11','12','13','21','20')   
	      AND OM.MEMBER_ID = #prodId:DECIMAL#
	      UNION
	      SELECT O.OFFER_SPEC_ID FROM OFFER O, OFFER_MEMBER OM, OFFER_SERV OSERV
	      WHERE O.OFFER_ID = OM.OFFER_ID
	      AND OM.MEMBER_ID = OSERV.SERV_ID
	      AND O.STATUS_CD IN ('11','12','13','21','20')  
	      AND OM.STATUS_CD IN ('11','12','13','21','20')
	      AND OSERV.STATUS_CD IN ('11','12','13','21','20')
	      AND OSERV.PROD_ID = #prodId:DECIMAL#
		]]>
	</select>
	
	<select id ="checkContinueOrderPPInfo" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT count(1)
		  FROM SPEC.OFFER_SPEC_GRP      P,
		       SPEC.OFFER_SPEC_GRP_RELA A,
		       offer_prod               op,
		       offer_member             om,
		       offer                    o,
		       offer_prod_status        ops
		 WHERE P.OFFER_SPEC_GRP_ID = A.OFFER_SPEC_GRP_ID
		   AND P.OFFER_SPEC_GRP_ID = 262
		   and op.prod_id = om.member_id
		   and om.offer_id = o.offer_id
		   and o.offer_spec_id = a.sub_offer_spec_id
		   and op.redu_access_number = #accNbr#
		   and o.offer_spec_id= #offerSpecId#
		   and op.prod_id=ops.prod_id
		   and ops.prod_status_cd = 1	
	</select>
	<select id ="queryProdSpec2BoActionTypeCdBYprodAndAction" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		 SELECT COUNT(1)
	   FROM CTG_SPEC.PROD_SPEC             A,
	        CTG_SPEC.PROD_SPEC_2_BO_ACTION B,
	        CTG_SPEC.BO_ACTION_TYPE        C
	  WHERE A.PROD_SPEC_ID = B.PROD_SPEC_ID
	    AND B.BO_ACTION_TYPE_CD = C.BO_ACTION_TYPE_CD
	    AND A.PROD_SPEC_ID = #prodSpecId#
	    AND B.BO_ACTION_TYPE_CD = #boActionTypeCd#
   	</select>
	<select id ="queryOfferSpecsByDZQD" resultClass="OfferSpecDto">
	select a.offer_spec_id as OFFERSPECID from intf.intf_dzqd_offer_spec a
	</select>
	
	<select id ="queryIfWLANByOfferSpecId" parameterClass="java.lang.Long" resultClass="java.lang.Integer">
		SELECT count(1)
		  FROM spec.offer_spec_param a
		 WHERE a.item_spec_id = 5030
		   and a.default_value in (3, 4)
		   and a.offer_spec_id = #offerSpecId#
   	</select>
   	
   	<select id ="selectStaffInofFromPadPwdStaff" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	 select t.staff_number, t.serial_no, t.access_number
     from pad_pwd_staff t, pad_pwd d
 	 where t.serial_no = d.serial_no
    and d.state = '2' and t.staff_number = #staffNumber#
   	</select>
   	
   	<update id ="updatePhoneNumberStatusCdByYuyue" parameterClass="java.lang.String" >
   	update rm.phone_number a set a.rsc_status_cd = '14'  where a.phone_number =#phoneNumber#
   	</update>
	<parameterMap class="java.util.Map" id="gjmyYesOrNoRule">
		<parameter property="v_prodId" javaType="java.lang.String" jdbcType="DECIMAL" mode="IN" />
		<parameter property="v_fee" javaType="java.lang.String" jdbcType="DECIMAL" mode="IN" />
		<parameter property="v_code" javaType="java.lang.String" jdbcType="DECIMAL" mode="OUT" />
	</parameterMap>
	<procedure id="gjmyYesOrNoRules" parameterMap="gjmyYesOrNoRule">
		{call crm_app.so_pub.check_if_order_serv(?,?,?)}
	</procedure>   	
	<parameterMap class="java.util.Map" id="insertcmsd">
	    <parameter property="i_channel_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	    <parameter property="i_manage_code" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	    <parameter property="i_area_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	    <parameter property="i_channel_spec_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	    <parameter property="i_channel_name" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	    <parameter property="i_agentaddr" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	    <parameter property="i_linkphone" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	    <parameter property="i_linkmanname" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	    <parameter property="i_linkemail" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	    <parameter property="i_parentorg" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	    <parameter property="i_staff_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	    <parameter property="i_parentmailaddressid" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	    <parameter property="opType" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	    <parameter property="o_flag" javaType="java.lang.String" jdbcType="VARCHAR" mode="OUT" />
	    <parameter property="o_msg" javaType="java.lang.String" jdbcType="VARCHAR" mode="OUT" />
	 </parameterMap>
	 <parameterMap class="java.util.Map" id="insertcmsw">
		 <parameter property="i_channel_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
		 <parameter property="i_manage_code" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	     <parameter property="i_area_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	     <parameter property="i_channel_spec_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	     <parameter property="i_channel_name" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN" />
	     <parameter property="i_staff_id" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	     <parameter property="i_parentmailaddressid" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	     <parameter property="opType" javaType="java.lang.Integer" jdbcType="DECIMAL" mode="IN" />
	     <parameter property="o_flag" javaType="java.lang.String" jdbcType="VARCHAR" mode="OUT" />
	     <parameter property="o_msg" javaType="java.lang.String" jdbcType="VARCHAR" mode="OUT" />
	  </parameterMap>
	<procedure id="p_sync_prm_to_cms_d" parameterMap="insertcmsd">
		{call cms.Pkg_Sync_Local.p_sync_prm_to_cms_d(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)}
	</procedure> 
	<procedure id="p_sync_prm_to_cms_w" parameterMap="insertcmsw">
		{call cms.Pkg_Sync_Local.p_sync_prm_to_cms_w(?,?,?,?,?,?,?,?,?,?)}
	</procedure>   	

	<select id ="queryAccountInfo" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	select * from account where prod_id = #prodId#
	</select>
	
	<select id ="queryCurrentOfferSpecIdKFByProdId" parameterClass="java.lang.Long" resultClass="java.lang.Long">
		SELECT AO.OFFER_SPEC_ID
		  FROM (SELECT OS.OFFER_SPEC_ID
		          FROM CRM_APP.OFFER_MEMBER OM
		          JOIN CRM_APP.OFFER O
		            ON OM.OFFER_ID = O.OFFER_ID
		           AND OM.MEMBER_ID = #prodId#
		           AND O.STATUS_CD IN ('11', '12', '13', '20', '21')
		          JOIN OFFER_SPEC OS
		            ON O.OFFER_SPEC_ID = OS.OFFER_SPEC_ID
		           AND OS.OFFER_TYPE_CD = '1'
		         ORDER BY O.STATUS_CD DESC) AO
		 WHERE ROWNUM = 1
	</select>
	
	<select id ="getPostCodeByPartyId" parameterClass="java.lang.Long" resultClass="java.lang.String">
	select a.post_code from party a where a.party_id=#partyId#
	</select>
	
	<select id ="qryDeviceNumberStatusCd" parameterClass="java.lang.String" resultClass="java.lang.String">
	select y.rsc_status_cd from rm.device_number y  where y.dev_num_id =#anId#
	</select>
	
	<select id="queryOlIdByBoId" parameterClass="java.util.HashMap" resultClass="java.lang.String">
	    <![CDATA[
	    SELECT distinct bo.ol_id
			  FROM busi_order bo
			 WHERE bo.bo_id = #boId:DECIMAL#
			   and bo.ol_id <> #olId:DECIMAL#
			   and bo.status_cd <> 'D'
			   ]]>
	</select>
	
	<select id="queryCycleByPayId" parameterClass="java.lang.String" resultClass="java.lang.String">
	    <![CDATA[
	    SELECT ui.cycle_id FROM crm_app.unitypay_interface ui WHERE ui.pay_indent_id = #payIndentId# and rownum<2
			   ]]>
	</select>
	
	<select id="queryAuditingTicketBusiInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
	    <![CDATA[
		SELECT TMP.BO_ID,
		       TMP.STATUS_CD,
		       TMP.OFFER_ID,
		       TMP.PARTY_ID,
		       TMP.PARTY_NAME,
		       TMP.STAFF_ID,
		       TMP.STAFF_NAME,
		       TMP.CHANNEL_ID,
		       TMP.CHANNEL_NAME,
		       TMP.SO_DATE,
		       TMP.OFFER_SPEC_ID,
		       OPN.ACCESS_NUMBER
		  FROM (SELECT 
		         B2A.BO_ID,
		         BO.STATUS_CD,
		         OO.OFFER_ID,
		         P.PARTY_ID,
		         P.NAME PARTY_NAME,
		         OL.STAFF_ID,
		         STA.NAME STAFF_NAME,
		         OL.CHANNEL_ID,
		         C.NAME CHANNEL_NAME,
		         OL.SO_DATE,
		         OROLE.OFFER_SPEC_ID,
		         OOR.OBJ_INST_ID PROD_ID
		          FROM CRM.OUR_STAFF     STA,
		               CRM.CHANNEL       C,
		               PARTY             P,
		               ORDER_LIST        OL,
		               BUSI_ORDER        BO,
		               SPEC.OFFER_ROLES  OROLE,
		               OFFER_ORDER       OO,
		               OO_ROLE           OOR,
		               BO_2_AUDIT        B2A,
		               AUDITING_TICKET   ATT
		         WHERE STA.STAFF_ID = OL.STAFF_ID
		           AND C.CHANNEL_ID = OL.CHANNEL_ID
		           AND P.PARTY_ID = OL.PARTY_ID
		           AND OL.OL_ID = BO.OL_ID
		           AND BO.STATUS_CD <> 'D'
		           AND BO.BO_ID = B2A.BO_ID
		           AND OO.BO_ID = B2A.BO_ID
		           AND OOR.BO_ID = B2A.BO_ID
		           AND B2A.AUDIT_TICKET_ID = ATT.AUDIT_TICKET_ID
		           AND OOR.OFFER_ROLE_ID = OROLE.OFFER_ROLE_ID
		           AND OOR.STATE = 'ADD'
		           AND OOR.OBJ_TYPE = 2
		           AND ATT.AUDIT_TYPE_CD = 4
	    ]]>
		<dynamic>
			<isNotEmpty property="auditTicketId" prepend="AND">
			  	ATT.AUDIT_TICKET_ID = #auditTicketId:DECIMAL#
			</isNotEmpty>
			<isNotEmpty property="auditTicketCd" prepend="AND">
				ATT.AUDIT_TICKET_CD = #auditTicketCd:VARCHAR#
			</isNotEmpty>
		</dynamic>
	   ) TMP LEFT JOIN 
           OFFER_PROD_NUMBER OPN ON TMP.PROD_ID = OPN.PROD_ID AND so_status.check_if_inst_eff(OPN.STATUS_CD) = 0
	</select>
	
	<select id="getChargeByTicketCd" parameterClass="java.lang.String" resultClass="java.lang.String">
	    <![CDATA[
	   SELECT ata.value
  FROM AUDITING_TICKET_ATTR ATA, AUDITING_TICKET ATT
 WHERE ATA.AUDIT_TICKET_ID = ATT.AUDIT_TICKET_ID
   AND ATA.ITEM_SPEC_ID = '305024'
   AND ATT.AUDIT_TICKET_CD = #auditTicketCd#
   AND Rownum<2
			   ]]>
	</select>
	
	<select id="qryAccessNumberIsOk" parameterClass="java.lang.String" resultClass="java.lang.Integer">
	    <![CDATA[
          select sum(tmp.cnt) from (select COUNT(1) as cnt
                 from crm_app.bo_prod_an  a,
                 	  crm_app.offer_prod op,
                      crm_app.atom_action b,
                      crm_app.busi_order  t
                where a.atom_action_id = b.atom_action_id
                  and b.status_cd <> 'D'
                  and a.bo_id = t.bo_id
                  and t.status_cd not in ('C', 'D', 'E')
                  and op.status_cd in (11,12,13,14)
                  and op.redu_access_number = a.access_number
                  and a.access_number = #accessNumber#   union all
                 select count(1)  as cnt
                         from crm_app.offer_prod a
                        where  a.status_cd  in('11', '12')
                        and    a.redu_access_number = #accessNumber#
               ) tmp
			   ]]>
	</select>
	
	<select id="qryAccessNumberIsZt" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
	    <![CDATA[
          	select count(1) from offer_prod op,so.prod_order po,busi_order bo 
			where op.prod_id = po.prod_id and po.bo_id = bo.bo_id
 			and bo.status_cd not in ('C','D','E') and op.redu_access_number = #accNbr#
 			and op.status_cd in (10, 11, 12, 13) and bo.bo_action_type_cd = #typeCd#
			   ]]>
	</select>
	
	<select id="qryProdOrderIsZtByOrderTypes" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
	  
          	select count(1) from offer_prod op,so.prod_order po,busi_order bo 
			where op.prod_id = po.prod_id and po.bo_id = bo.bo_id
 			and bo.status_cd not in ('C','D','E') and op.redu_access_number = #accNbr#
 			and op.status_cd in (10, 11, 12, 13) and bo.bo_action_type_cd 
 			in <iterate property="typeCd" conjunction="," open="(" close=")">
  					#typeCd[]#
			   </iterate>
	</select>
	
	<select id="queryDefaultValueByMainOfferSpecId" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	    <![CDATA[
		SELECT distinct rc.default_value as value
	  FROM spec.req_item_cfg           rc,
	       spec.cfg_rule_2_item_cfg    ac,
	       spec.role_obj_2_cfg_rule    rrc,
	       spec.offer_roles            ors,
	       spec.offer_spec             os,
	       bss_sys.discrete_value_list aat
	 WHERE rc.req_item_cfg_id = ac.req_item_cfg_id
	   and ac.cfg_rule_id = rrc.cfg_rule_id
	   and rrc.offer_role_id = ors.OFFER_ROLE_ID
	   and ors.OFFER_spec_ID = os.offer_spec_id
	   and rc.item_spec_id = aat.item_spec_id
	   and rc.default_value = aat.meta_key_value
	   and os.offer_spec_id = #offerSpecId#

			   ]]>
	</select>
	
		<select id="queryTaxPayer" parameterClass="java.lang.String" resultClass="java.util.HashMap">
	    <![CDATA[
        select a.party_profile_catg_cd, a.profile_value
          from party_profile a
         where a.party_profile_catg_cd in
               ('999999971',
                '999999972',
                '999999973',
                '999999974',
                '999999975',
                '999999976',
                '999999977',
                '999999978')
           and a.party_id = (select b.party_id
                               from party_profile b
                              where b.party_profile_catg_cd = 999999971
                                and b.profile_value = '1'
                                and b.party_id=#custId#)
			   ]]>
	</select>
	<select id="getPayIndentIdByOlId" parameterClass="java.lang.String" resultClass="java.lang.String">
	    <![CDATA[
	    SELECT UI.PAY_INDENT_ID
  		FROM UNITYPAY_INTERFACE UI
 		WHERE UI.OL_ID = #olId#
   		AND ROWNUM < 2
			   ]]>
	</select>
	
	
		<select id="checkIsExistsMailAddressId" parameterClass="java.lang.String" resultClass="java.lang.Integer">
	    <![CDATA[
	     select count(1) from sm.party a where a.party_type_cd=22 and a.party_id = #orgId#
			   ]]>
	</select>
	
	<select id="getProdStatusNameByCd" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		SELECT PST.NAME
  		FROM PROD_STATUS_TYPE PST
 		WHERE PST.PROD_STATUS_CD = #prodStatusCd#
   		AND ROWNUM < 2
		]]>
	</select>
	
	<select id="getChannelIdByTicketCd" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		SELECT ATH.CHANNEL_ID
  		FROM AUDITING_TICKET_HANDLE ATH
 		WHERE ATH.HANDLE_TYPE = '1'
  		 AND ATH.AUDIT_TICKET_ID = (SELECT AUT.AUDIT_TICKET_ID
                                FROM AUDITING_TICKET AUT
                               WHERE AUT.AUDIT_TICKET_CD = #ticketCd#
                                 AND ROWNUM < 2)
  		 AND ROWNUM<2
		]]>
	</select>
	
	<insert id='saveTicketCd2terminal' parameterClass='java.util.HashMap'>
		INSERT INTO tab_ticket_2_terminal
		(
       auditTicketCd,
       requestId,
       requestTime,
       platId,
       cycleId,
       exchangeDate,
       staffId,
       channelId,
       payIndentId,
       charge,
       resultCode,
       request
		)
		VALUES
		(
       #auditTicketCd#,
       #requestId#,
       #requestTime#,
       #platId#,
       #cycleId#,
       #exchangeDate#,
       #staffId#,
       #channelId#,
       #payIndentId#,
       #charge#,
       #result#,
       #request#
		)
     </insert>
     
     <select id="getTicketIdByCd" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		SELECT ATT.AUDIT_TICKET_ID
  		FROM AUDITING_TICKET ATT
 		WHERE ATT.AUDIT_TICKET_CD = #autitTicketCd#
   		AND ROWNUM < 2
		]]>
	</select>
	
	<select id="getInventoryStatistics" resultClass="com.linkage.bss.crm.intf.model.InventoryStatisticsEntity" parameterClass="com.linkage.bss.crm.intf.model.InventoryStatisticsEntityInputBean">
		select a.store_id as storeId,a.material_id as materialId,count(*) as count from crm.store_detail a where 1=1
			and a.store_id in 
			<iterate property="storeIds" open="(" close=")" conjunction=",">
			#storeIds[]#
			</iterate>
			and a.material_id in 
			<iterate property="materialIds" open="(" close=")" conjunction=",">
			#materialIds[]#
			</iterate>
			and a.state='A'
			group by a.store_id,a.material_id
			
	
	</select>

	<select id="getUnCheckedCardInfo" resultClass="java.util.HashMap" >
		<![CDATA[
		SELECT a.bcd_code,a.cust_id,a.cust_name,a.cycle_id,a.in_out_id,a.plat_id,a.plat_id,a.validate_code,a.sale_no,a.price_std,a.price,a.pay_method,a.mkt_res_id,a.channel_id,a.staff_code
  		FROM RECHARGE_CARD_CHECK_MONTHLY A
 		WHERE A.CHECK_STATUS = '0'
   		AND ROWNUM < 6
		]]>
	</select>
	
	<update id="updaCradCheckResult" parameterClass="java.util.HashMap">
		UPDATE RECHARGE_CARD_CHECK_MONTHLY A
   		SET A.RESULT_CODE = #resultCode#
 		WHERE A.BCD_CODE = #bcdCode#
     </update>
     
     <update id="updaCradCheckStatus" parameterClass="java.util.HashMap">
		UPDATE RECHARGE_CARD_CHECK_MONTHLY A
   		SET A.CHECK_STATUS = #status#
 		WHERE A.BCD_CODE = #bcdCode#
     </update>
     
     <select id="ifPayIndentIdExists" resultClass="java.lang.String" >
		<![CDATA[
		SELECT 1 FROM unitypay_indentitempay_intf a WHERE a.pay_indent_id=#PLAT_ID#||#IN_OUT_ID#
		]]>
	</select>
	
	
	<select id="getBcdCode" resultClass="com.linkage.bss.crm.intf.model.BcdCodeEntity" parameterClass="com.linkage.bss.crm.intf.model.BcdCodeEntityInputBean">
	       select * from (
		select a.bcd_code as bcdCode from crm.store_detail a where 1=1
		and a.store_id in 
		<iterate property="storeIds" open="(" close=")" conjunction=",">
			#storeIds[]#
		</iterate>
		and a.material_id= #materialId#
		and a.state='A'
		order by dbms_random.value)
		<![CDATA[
		where rownum < #count#
		]]>
	</select>
	
	<select id="getChargeByPayId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		SELECT UPI.AMOUNT
  		FROM CRM_APP.UNITYPAY_PAYLIST_INTF UPI
 		WHERE UPI.REQUEST_ID = (SELECT UII.REQUEST_ID
                           FROM CRM_APP.UNITYPAY_INDENTITEMPAY_INTF UII
                          WHERE UII.PAY_INDENT_ID = #payIndentId#
                            AND ROWNUM < 2)
		]]>
	</select>

	<select id="getOfferProdCompMainProd" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		 select
        os.name || (SELECT OSI.VALUE
                      FROM crm_app.OFFER_SERV_ITEM OSI
                     WHERE OSI.STATUS_CD IN ('10','11', '12', '13')
                       AND OSI.ITEM_SPEC_ID = 17028
                       AND OSI.SERV_ID =
                           (SELECT OM.MEMBER_ID
                              FROM crm_app.OFFER_MEMBER OM
                             WHERE OM.OBJ_TYPE = 4
                               AND OM.OFFER_ID = O.OFFER_ID)) as offer_spec_name
       
			   from crm_app.offer o, crm_app.offer_spec os
			  where o.status_cd in ('10','11', '12', '13')
			    and o.offer_spec_id = os.offer_spec_id
			    and o.offer_id in
			        (select a.offer_id
			           from crm_app.offer_member a
			          where a.obj_type = 2
			            and a.member_id = #prodId#
			            and a.status_cd in ('10','11', '12', '13')
			         union
			         select a.offer_id
			           from crm_app.offer_member a, crm_app.offer_serv b
			          where a.obj_type = 4
			            and a.member_id = b.serv_id
			            and b.prod_id = #prodId#
			            and a.status_cd in ('10','11', '12', '13')
			         union
			         select a.offer_id
			           from crm_app.offer_member a, crm_app.offer_coupon b
			          where a.obj_type = 8
			            and a.member_id = b.coupon_instance_id
			            and b.prod_id = #prodId#
			            and a.status_cd in ('10','11', '12', '13'))
			    and os.offer_type_cd = '1'
			    and rownum < 2
			  order by os.offer_spec_id, o.offer_id, os.offer_type_cd, o.status_cd
		
		]]>
	</select>

	<insert id='saveSRInOut' parameterClass='java.util.HashMap'>
		INSERT INTO tab_sr_in_out_log(bcd_code,xml_in,xml_out) 
		VALUES (#bcdCode#, #xmlIn#, #xmlOut#)
     </insert>
     
     
     <select id="getOfferTypeCdByOfferSpecId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		 select offer_type_cd from crm_app.offer_spec where offer_spec_id = #offerSpecId#
		]]>
	</select>
     <select id="getNumByStatus" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		 select o.CODE from crm_app.offer_spec o where o.STATUS_CD <>'2'and o.offer_spec_id = #offerSpecId#
		]]>
	</select>
	
	<select id="getFaceValueByTicketCd" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		SELECT ata.value
  		FROM AUDITING_TICKET_ATTR ATA, AUDITING_TICKET ATT
 		WHERE ATA.AUDIT_TICKET_ID = ATT.AUDIT_TICKET_ID
   		AND ATA.ITEM_SPEC_ID = '305022'
   		AND ATT.AUDIT_TICKET_CD = #auditTicketCd#
   		AND Rownum<2
		]]>
	</select>
	
	<select id="getBankTable" resultClass="com.linkage.bss.crm.intf.model.BankTableEntity" parameterClass="java.lang.String">
		<![CDATA[
			    
			  select distinct col.bank_table   as bankTable,
			         col.xml_node     as xmlNode,
			         col.table_column as tableColumn,
			         bank.bank_type    as bankType,
			         atc.DATA_TYPE as dataType
			    from intf.FREEZERENT_bank bank, intf.FREEZERENT_XML_2_COLUMN col
			   right join all_tab_columns atc
			      on col.table_column = atc.COLUMN_NAME
			   where bank.bank_code = #bankCode#
			     and bank.bank_table = col.bank_table
			     and atc.TABLE_NAME = bank.bank_table
  
		]]>
	</select>
	<insert id="insertBankFreeze" parameterClass="java.lang.String">
		$bankSql$
	</insert>   
	
	
	<select id="checkBankFreeze" resultClass="java.lang.Integer" parameterClass="java.lang.String">
		$bankSql$
	</select>
	
	<update id="updateBankFreeze" parameterClass="java.lang.String">
	   $bankSql$
	</update>
	
	<select id="getRequestInfo" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
	    select a.request from crm_app.intf_request_log a where a.id = #olId#
   		and rownum<2
		]]>
   </select>
   
   
   <select id="getOfferSpecidByProdId" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
	    select p.redu_prod_spec_id from offer_prod p where p.prod_id = #prod# and rownum < 2
		]]>
   </select>
   
   
   
   
   
   
   <!-- ********************* -->
   <select id="getSpecNameByProdId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
	    select p.name from prod_spec p where p.prod_spec_id in(select o.redu_prod_spec_id from offer_prod o where o.prod_id = #prodid# and rownum < 2)
		]]>
   </select>
   <select id="getOffersByProdId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		select a.offer_id from inst.offer a,inst.offer_member b,spec.offer_spec c where a.offer_id=b.offer_id and a.offer_spec_id=c.offer_spec_id and c.offer_type_cd='1' and b.member_id=#prodid#  and rownum < 2
		]]>
   </select>
   <select id="getUmiCardByProdId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		select um.dev_num_id from crm_app.offer_prod_2_td td,crm_app.terminal_dev_2_dev_num um,crm_app.device_number er
		where td.terminal_dev_id = um.terminal_dev_id
		      and  um.dev_num_id = er.dev_num_id
		      and er.an_type_cd in('509','510')
		      and  td.prod_id=#prodid# and rownum = 1		]]>
   </select>
   
   <select id="getStasByProdId" resultClass="java.util.HashMap"
		remapResults="true" parameterClass="java.lang.String">
		<![CDATA[
		select p.status_cd statuscd,to_char(p.create_dt,'yyyyMMdd') createdata from offer_prod p where p.prod_id = #prodid#
		]]>
	</select>
   
   <select id="getExchsByProdId" resultClass="java.util.HashMap"
		remapResults="true" parameterClass="java.lang.Long">
		<![CDATA[
			select  d.code exchCode ,d.name exchName from rm.terminal_dev_2_dev_num a,rm.device_number b,
			rm.device_2_ne c,rm.device d,offer_prod_2_td e
			where a.dev_num_id=b.dev_num_id
			and b.number_element_id=c.number_element_id
			and a.terminal_dev_id=e.terminal_dev_id
			and d.device_id=c.device_id
			and e.prod_id=#prodid#		
		]]>
	</select>
	
	 <select id="getAddressByProdId" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		select p.address_desc from ctg_inst.prod_inst p where p.prod_inst_id = #prodid#
		]]>
   </select>
   <select id="getNetAccountByProdId" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
			select a.access_number from inst.offer_prod_2_access_number a where a.prod_id=#prodid#
		]]>
   </select>
   <select id="getValidStrByPartyId" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
			select p.cust_status_cd statuscd from party p where rownum = 1 and p.party_id = #pid#
		]]>
   </select>
    <select id="getCtfRuleIdByOCId" resultClass="java.lang.String" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT  distinct ror.cfg_rule_id
          FROM spec.offer_roles       ors,
          spec.role_obj_2_cfg_rule    ror,
          spec.CFG_RULE_2_REQ_OBJ_GRP cg,
          spec.REQ_OBJ_GRP_2_OBJ      roo,
          spec.REQ_OBJ_GRP            rg,
          crm.coupon_grp_number       cn,
          crm.coupon_grp              grp
         WHERE ors.OFFER_ROLE_ID = ror.offer_role_id
         and ror.cfg_rule_id = cg.cfg_rule_id
         and cg.req_obj_grp_id = roo.obj_grp_id
         and roo.obj_grp_id = rg.req_obj_grp_id
         and cn.coupon_grp_id = roo.obj_id
         and cn.coupon_grp_id = grp.coupon_grp_id
         and ors.offer_spec_id = #offerSpecId# 
         and cn.coupon_id=#couponId#
		]]>
   </select>
   <select id="getPrepayFlagBySpecid" resultClass="java.lang.Long" parameterClass="java.lang.Long">
		<![CDATA[
       select ob.OBJ_ID objid from offer_spec sp,offer_roles ro,role_obj ob where sp.offer_spec_id = ro.offer_spec_id and ro.OFFER_ROLE_ID = ob.OFFER_ROLE_ID and sp.offer_spec_id = #specid# and rownum < 2
		]]>
   </select>
   <select id="getAccMailMap" resultClass="java.util.HashMap"
		remapResults="true" parameterClass="java.lang.Long">
		<![CDATA[
			select a.mailing_type mailingType,a.param1 mailAddress,
			a.param7 mailItem,a.param2 mailFormat,
			a.param3 mailPeriod from crm.account_mailing a where a.acct_id = #accid#		
		]]>
	</select>
	<select id="getGimsiByProdid" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		select er.dev_num from crm_app.offer_prod_2_td td,crm_app.terminal_dev_2_dev_num um,crm_app.device_number er
		where td.terminal_dev_id = um.terminal_dev_id
      	and  um.dev_num_id = er.dev_num_id
      	and er.an_type_cd in('510')
      	and  td.prod_id=#prodid# and rownum = 1		]]>
   </select>
   <select id="getIndustryClasscdByPartyId" resultClass="Integer" parameterClass="java.lang.Long">
		<![CDATA[
		select p.industry_class_cd industryclasscd from party p where rownum = 1 and p.party_id = #partyid#
		]]>
   </select>
   <select id="getPartyAddByProdId" resultClass="String" parameterClass="java.lang.Long">
		<![CDATA[
    	select pa.address_str from offer_prod p,party pa where p.redu_owner_id = pa.party_id and p.prod_id = #prodid# and rownum = 1
		]]>
   </select>
   <select id="getCimsiByProdid" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		select er.dev_num from crm_app.offer_prod_2_td td,crm_app.terminal_dev_2_dev_num um,crm_app.device_number er
		where td.terminal_dev_id = um.terminal_dev_id
      	and  um.dev_num_id = er.dev_num_id
      	and er.an_type_cd in('509')
      	and  td.prod_id=#prodid# and rownum = 1		]]>
   </select>
   <select id="getEsnByProdid" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		select i.value from inst.offer_prod_2_td a,rm.terminal_device r,rm.terminal_dev_item i where a.terminal_code = r.terminal_code and r.terminal_dev_id = i.terminal_dev_id and i.item_spec_id in('200220','200227') and a.prod_id = #prodid# and rownum < 2
      	]]>
   </select>

   
   <!-- 抽取客户实例数据SQL -->
   
   <select id="getServInfoAAP" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		select op.area_id  as  AREA_ID,
       op.redu_access_number as ACC_NBR,
       op.redu_prod_spec_id as PRODUCT_ID
  			from offer_prod op 
  			where prod_id=#prod_id#
      	]]>
   </select>
   
   <select id="getServInfoC" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		select pi.identity_num as CUST_NO
          from party_identity pi
         where pi.party_id = #cust_id#
           and pi.identidies_type_cd = '13'
           and rownum < 2
      	]]>
   </select>
   
   <select id="getServInfoCC" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		select pi.identidies_type_cd as CERTIFICATE_TYPE,
       pi.identity_num       as CERTIFICATE_NO
  from bo_cust bc, party_identity pi
 where pi.party_id = #cust_id#
   and pi.identidies_type_cd != '13'
   and rownum < 2
      	]]>
   </select>
   
   
   <select id="getServInfoPC" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select  ps.code as PRODUCT_CODE,
               decode(ps.comp_prod, 'N', 1, 'Y', 2) as COMP_PROD
          from offer_prod op , prod_spec ps    
          where ps.prod_spec_id=op.redu_prod_spec_id
          and op.prod_id=#prod_id#
      	]]>
   </select>
   <!-- 取imsi号码 509c网  510G网 -->
   <select id="getServInfoIMSI" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select  er.dev_num as IMSI
  from crm_app.offer_prod_2_td        td,
       crm_app.terminal_dev_2_dev_num um,
       crm_app.device_number          er
 where td.terminal_dev_id = um.terminal_dev_id
   and um.dev_num_id = er.dev_num_id
   and er.an_type_cd in (#an_type_cd#)
   and rownum = 1
   and td.prod_id = #prod_id#
      	]]>
   </select>
   
   
    <select id="getServInfoName" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select p.name as USER_NAME  from party p where party_id=#cust_id#
      	]]>
   </select>
   
   <select id="getServInfoServState" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		    select ops.prod_status_cd as SERV_STATE
          from offer_prod_status ops
         where prod_id = #prod_id#
           and status_cd in ('10','11','12','13')

      	]]>
   </select>
   
   <select id="getServInfoEffdate" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		  select to_char(op.start_dt, 'yyyyMMddHH24miss') as EFF_DATE,
		  			to_char(op.start_dt, 'yyyyMMddHH24miss') as APPLY_DATE
		  
             from offer_prod op
            where prod_id =#prod_id#
          

      	]]>
   </select>
   
   
   
   
   <select id="getServAttrInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		  select  bpi.item_spec_id as attr_id,
               iss.code as attr_code,
               bpi.value as attr_value,
               to_char(bpi.start_dt, 'yyyyMMddHH24miss') as eff_date,
               to_char(bpi.end_dt, 'yyyyMMddHH24miss') as exp_date
               
                from  offer_prod_item bpi,item_spec iss
                where 
          bpi.item_spec_id = iss.item_spec_id
           and bpi.prod_id = #prod_id#
          

      	]]>
   </select>
   
   <select id="getServPartyInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select  a.party_rela_role_cd as role_type,
               a.staff_id as staff_id
   				from inst.offer_prod_2_staff a
  			where a.prod_id = #prod_id#
    		and a.party_rela_role_cd in (11, 12)
          
      	]]>
   </select>
   
   
   <select id="getServProductInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		  select os.serv_id      SERV_PRODUCT_ID,
        os.serv_spec_id PRODUCT_CODE,
        ss.code         PRODUCT_ID,
        to_char(os.start_dt, 'yyyyMMddHH24miss') as EFF_DATE ,
       to_char(os.end_dt, 'yyyyMMddHH24miss') as EXP_DATE
   from offer_serv os, serv_spec ss
  where os.prod_id = #prod_id#
    and os.serv_spec_id = ss.serv_spec_id
          
      	]]>
   </select>
    <select id="getOfferIdNum" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select o.offer_id PRODUCT_OFFER_INSTANCE_ID,
           o.offer_spec_id OFFER_SPEC_ID
      from offer o, offer_spec os,offer_member om
      where o.offer_id=om.offer_id
      and o.offer_spec_id=os.offer_spec_id
     and o.status_cd in(11,12)
      and om.obj_type='2'
      and om.member_id=#prod_id#
     and os.code <> '800000000'
      and os.code <> '777777777'
      and os.code <> '999999999'
          
      	]]>
   </select>
   
   <select id="getServPricePlanInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select o.offer_id PRODUCT_OFFER_INSTANCE_ID,
           o.offer_spec_id OFFER_SPEC_ID,
         
           os.code MANAGE_CODE,
          
           to_char(o.start_dt, 'yyyyMMddHH24miss') as EFF_DATE ,
           to_char(o.end_dt, 'yyyyMMddHH24miss') as EXP_DATE,
           decode(om.obj_type, 4, om.member_id, om.member_id) as OBJECT_ID
      from offer o, offer_spec os,offer_member om
      where o.offer_id=om.offer_id
      and o.offer_spec_id=os.offer_spec_id
     and o.status_cd in(11,12)
      and om.obj_type='2'
      and om.member_id=#prod_id#
      and o.offer_id=#offerId#
       and os.code <> '800000000'
      and os.code <> '777777777'
      and os.code <> '999999999'
          
      	]]>
   </select>
   
    <select id="getServPricePlanObjectInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select o.offer_id PRODUCT_OFFER_INSTANCE_ID,
             om.offer_member_id INSTANCE_RELATION_ID,
             decode(om.obj_type, 4, om.member_id, om.member_id) as OBJECT_ID,
             to_char(om.start_dt, 'yyyyMMddHH24miss') as EFF_DATE,
             to_char(om.end_dt, 'yyyyMMddHH24miss') as EXP_DATE,
              o.offer_spec_id as OFFER_SPEC_ID,
              os.manage_code as MANAGE_CODE
        from offer o, offer_member om,offer_spec os
        where o.offer_id=om.offer_id
      and o.offer_spec_id=os.offer_spec_id
     and o.status_cd in(11,12)
      and om.obj_type='2'
      and om.member_id=#prod_id#
           and o.offer_id=#offerId#
           and os.code <> '800000000'
           and os.code <> '777777777'
           and os.code <> '999999999'
      	]]>
   </select>
   
   
   
  
    <select id="getServPricePlanParamInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		    select o.offer_id as PRODUCT_OFFER_INSTANCE_ID,
            op.offer_param_id OFFER_PARAM_ID,
            op.offer_spec_param_id ATTR_ID,
            op.value ATTR_VALUE,
            decode(bc2b.attr1, null, iss.code, bc2b.attr1) as ATTR_CODE,
            to_char(op.start_dt, 'yyyyMMddHH24miss') as EFF_DATE,
            to_char(op.end_dt, 'yyyyMMddHH24miss') as EXP_DATE,
            decode(om.obj_type, 4, om.member_id, om.member_id) as OBJECT_ID,
            o.offer_spec_id OFFER_SPEC_ID,
            os.manage_code as MANAGE_CODE
       from offer            o,
            offer_param      op,
            offer_member     om,
            offer_spec       os,
            bb_crm_2_billing bc2b,
            item_spec        iss,
            offer_spec_param osp
      where o.offer_id = om.offer_id
        and o.offer_id = op.offer_id
        and o.offer_spec_id = os.offer_spec_id
        and op.offer_spec_param_id = osp.offer_spec_param_id
        and osp.item_spec_id = iss.item_spec_id
        and op.offer_spec_param_id = bc2b.offer_spec_param_id(+)
        and o.status_cd in (11, 12)
        and om.obj_type = '2'
        and om.member_id = #prod_id#
         and o.offer_id=#offerId#
         and os.code <> '800000000'
           and os.code <> '777777777'
           and os.code <> '999999999'
      	]]>
   </select>
    
    <select id="getServCompInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select opc.prod_comp_id COMP_SERV_ID,
       opc.prod_comp_rela_role_cd ROLE_ID,
       to_char(opc.start_dt, 'yyyyMMddHH24miss') as EFF_DATE,
       to_char(opc.end_dt, 'yyyyMMddHH24miss') as EXP_DATE
  from offer_prod_comp opc
 where prod_id = #prod_id#
          
      	]]>
   </select>
   
    <select id="getServCreditInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		 select a.prod_inst_id,
       c.prod_offer_name,
       d.final_credit as credit_value,
       decode(d.credit_type, 'Y', 1, 0) as credit_dynamic_flag,
       d.final_credit as credit_nextmonth,
       decode(d.credit_type, 'Y', 1, 0) as DYNAMIC_FLAG_NEXTMONTH
  from ctg_inst.offer_prod_inst_rel a,
       ctg_inst.prod_offer_inst     b,
       ctg_spec.prod_offer          c,
       spec.pp_initial_credit       d
 where a.prod_offer_inst_id = b.prod_offer_inst_id
   and b.prod_offer_id = c.prod_offer_id
   and c.prod_offer_id = d.offer_spec_id
   and c.crm_offer_type = '1'
   and a.prod_inst_id = #prod_id#
          
      	]]>
   </select>
   
   
   
   
   
   <insert id='insertIntfToBillingMsg' parameterClass='java.util.HashMap'>
		INSERT INTO intf.intf_2_billing_msg(prod_id,msg_text,status,create_dt) 
		VALUES (#prod_id#, #infoXML#, #status#,sysdate)
     </insert>
     
     <delete id='delIntfToBillingMsg' parameterClass='java.lang.String'>
		    delete intf.intf_2_billing_msg where prod_id=#prod_id# and status in('C','F')

     </delete>
     
     <delete id='delSoInstData' parameterClass='java.lang.String'>
		 delete intf.so_inst_data where prod_id=#prod_id#  and status in('C')
     </delete>
     
      <insert id='saveIntfToBillingMsgToHis' parameterClass='java.lang.String'>
		insert into intf.intf_2_billing_msg_his
      select *
        from intf.intf_2_billing_msg
       where prod_id = #prod_id#
         and status in ('C', 'F')
         
     </insert>
     
      <insert id='saveSoInstDataToHis' parameterClass='java.lang.String'>
		
         
         INSERT INTO intf.so_inst_data_his
      (prod_id,
       party_id,
       acct_id,
       prod_spec_id,
       payment_type,
       status,
       create_dt,
       finish_dt)
      select *
        from intf.so_inst_data
       where prod_id = #prod_id#
         and status in ('C')
     </insert>
     
     <update id="updateSoInstDataSt" parameterClass='java.util.HashMap'>
     UPDATE intf.so_inst_data sid
   		SET sid.status=#status#,
          sid.finish_dt=sysdate
 		WHERE sid.prod_id=#prod_id#
 		and sid.status not in ('C', 'F')
     
     </update>
     
       <update id="updateIntfToBillingMsgSt" parameterClass='java.util.HashMap'>
      UPDATE intf.intf_2_billing_msg ibm
    SET ibm.status = #status#, ibm.finish_dt = sysdate
  WHERE ibm.prod_id = #prod_id#
    and ibm.status not in ('C', 'F')
     
     </update>
     
     
     
     <select id="getInstDateListBySt" resultClass="java.util.HashMap" >
		<![CDATA[
		 select sid.prod_id prod_id,
       sid.party_id cust_id,
       sid.acct_id acct_id,
       sid.prod_spec_id prod_spec_id,
       sid.payment_type payment_type
  from intf.so_inst_data sid
 where status = 'W'
          
      	]]>
   </select>
   
   <select id="getIntf2BillingMsgListBySt" resultClass="java.util.HashMap" parameterClass="java.util.HashMap" >
		<![CDATA[
  	 select ibm.prod_id, ibm.msg_text
  from intf.intf_2_billing_msg ibm ,LISTENER_CONF lc
 where ibm.status = 'W' and lc.system_code='IM' and lc.listener_code='Intf2BillingMsgListenerThread'
 and mod(ibm.prod_id,to_number(lc.thread_count_max) )=#threadIndex#
          
      	]]>
   </select>
   
   <select id="getArchiveGroupID" resultClass="java.util.HashMap" parameterClass="java.util.HashMap" >
		<![CDATA[
		select  SEQ_ARCHIVE_GROUP_ID.NEXTVAL archive_group_id FROM DUAL
          
      	]]>
   </select>
   
   <!-- 抽取客户实例数据SQL end-->
     
  

   
   <select id="getIfpkByProd" resultClass="java.lang.Integer" parameterClass="java.lang.String">
		<![CDATA[
		select p.if_pk from ctg_inst.party p where p.party_id = (select op.redu_owner_id from offer_prod op where op.prod_id = #prodId#)      	]]>
   </select>
   
   <select id="getStaffIdByDbid" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
		select a.staff_id  from agent_card a where a.imsi_last4 = #dbid# and rownum < 2
		]]>
   </select>
   
    <select id="getChannelIdByStaffId" resultClass="java.lang.Long" parameterClass="java.lang.Long">
		<![CDATA[
		select c.channel_id from party_2_channel c where c.party_id = #party_id#  and rownum < 2
		]]>
   </select>
   
   <select id="getStaffIdByAgentNum" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
		select a.staff_id from agent_card a where a.staff_number = #staff_number# and rownum < 2
		]]>
   </select>
   
	<select id="findStaffNumByStaffId" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		select sn.STAFF_NUMBER from staff_number sn where sn.STAFF_ID = #staff_id# and rownum < 2
		]]>
   </select>
   
   <select id="getChannelIdByStaffCode" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
		select c.channel_id from party_2_Channel c,staff_number sn where c.party_id = sn.STAFF_ID and sn.STAFF_NUMBER = #staffCode# and rownum < 2
		]]>
   </select>
   
   <select id="qryUsefulOfferNumByAccnum" resultClass="java.lang.Integer" parameterClass="java.lang.String">
		<![CDATA[
		select count(1) from (
      select op.PROD_ID, op.ATOM_ACTION_ID, op.AREA_ID, op.BEGIN_DT, op.START_DT, op.END_DT, op.STATUS_CD, op.STATUS_DT,
				op.CREATE_DT, op.VERSION, op.REDU_PROD_SPEC_ID, op.REDU_ACCESS_NUMBER, op.REDU_ACCT_ID, op.REDU_OWNER_ID,
				op.EXT_PROD_INST_ID, op.EXT_SYSTEM 
			from OFFER_PROD_NUMBER opn, OFFER_PROD op
	   		where opn.STATUS_CD in (10,11,12,13,20) 
	   			and op.STATUS_CD in (10,11,12,13,20)
	   			and opn.ACCESS_NUMBER = #accnum#  
	   			and opn.PROD_ID = op.PROD_ID
	   			and op.redu_prod_spec_id <> 10123
	   	) prod
		]]>
   </select>
   <select id="isLocalIvpn" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
		<![CDATA[
		select count(1) from offer_prod op where op.redu_prod_spec_id = '80000101' and op.prod_id = #prodid# and op.status_cd in (10,11,12,13,21)
		]]>
   </select>
   
   <select id="getCompLocalIvpns" resultClass="java.util.HashMap" parameterClass="java.lang.Long" >
		<![CDATA[
  	 select op.redu_access_number compProdAccNbr,
       oc.comp_prod_id compProdId,
       op.redu_prod_spec_id compProdSpecId,
       ps.name compProdname,
       opci.value shortNum
  from offer_prod_comp oc, offer_prod op, prod_spec ps,offer_prod_comp_item opci
 where ps.prod_spec_id = op.redu_prod_spec_id and oc.prod_comp_id = opci.prod_comp_id and
 oc.comp_prod_id = #prodId#
   and oc.prod_id = op.prod_id
   order by opci.value
          
      	]]>
   </select>
   
   <select id="getIvpnInfos" resultClass="java.util.HashMap" parameterClass="java.lang.Long" >
		<![CDATA[
  	 select opc.comp_prod_id compProdId, opci.value shortNum
  from offer_prod_comp opc, offer_prod_comp_item opci
 where opc.prod_id = #prodId#
   and opc.prod_comp_id = opci.prod_comp_id
   and rownum = 1
          
      	]]>
   </select>
   <select id="getIccIdByProdId" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
      <![CDATA[
			SELECT td.value iccid
			  FROM crm_app.offer_prod_2_td op , rm.terminal_dev_item td
			 where op.status_cd in('10','11','12','13')
			   and op.terminal_dev_id = td.terminal_dev_id
			   and td.item_spec_id = #itemSpecId#
			   and op.prod_id =#prodId#
      ]]>
   		</select>
      <select id="queryJtUserScore" resultClass="java.util.HashMap" parameterClass="java.lang.Long" >
		<![CDATA[
 select pp.id id,
       3 consumeType,
       '集团兑换' consumeTypeString,
       nvl(pp.point_use, 0) pointUse,
       pp.state pointState,
       '积分操作成功' pointStateString,
       pp.state_date stateDate,
       pp.staff_id,
       (select os.staff_number
          from our_staff os
         where os.staff_id = pp.staff_id) staffCode,
       pp.ol_id olId,
       pp.rela_id relaId,
       ppt.id pptId,
       ppt.transaction_id transactionId,
       ppt.src_org_id srcOrgId,
       ppt.src_sys_id srcSysId,
       pps.order_nbr orderNbr,
       pps.tally_src,
       case pps.tally_src
         when 'SRC0001' then
          '机场贵宾厅'
         when 'SRC0002' then
          '集团商城'
         when 'SRC0003' then
          '火车站贵宾厅'
       end tallySrcString,
       pps.tally_action action,
       case pps.tally_action
         when 'CT' then
          '返销'
         when 'TT' then
          '兑换'
       end actionString,
       pps.svc_place svcPlace,
      (select count(*) from party_point t where t.state ='P' and t.rela_id = pp.id) beenRefunded
  from party_point pp, party_point_tcpcont ppt, party_point_svc pps
 where pp.id = ppt.party_point_id
   and ppt.id = pps.ppt_id
   and pp.state in ('C', 'P')
   and pp.state_date > sysdate - 365
   and pp.party_id = #partyId:DECIMAL#
      	]]>
   </select>
      <select id="queryTxnUserScore" resultClass="java.util.HashMap" parameterClass="java.lang.Long" >
		<![CDATA[
  	select pp.id id,
       2 consumeType,
       '附属销售品' consumeTypeString,
       nvl(pp.point_use, 0) pointUse,
       pp.state pointState,
       '积分操作成功' pointStateString,
       pp.state_date stateDate,
       pp.staff_id,
       (select os.staff_number
          from our_staff os
         where os.staff_id = pp.staff_id) staffCode,
       pp.ol_id olId,
       pp.rela_id relaId,
       (select count(*)
          from party_point t
         where t.state = 'P'
           and t.rela_id = pp.id) beenRefunded
  from party_point pp 
 where exists (select 1 from party_point_os ppo where ppo.party_point_id = pp.id )
   and pp.state = 'P'
   and pp.state_date > sysdate - 365
   and pp.party_id = #partyId:DECIMAL#
      	]]>
   </select>
      <select id="queryBsUserScore" resultClass="java.util.HashMap" parameterClass="java.lang.Long" >
		<![CDATA[
select pp.id id,
       1 consumeType,
       '实物礼品' consumeTypeString,
       nvl(pp.point_use ,0) pointUse,
       pp.state pointState,
       '积分操作成功' pointStateString,
       pp.state_date stateDate,
       pp.staff_id,
       (select os.staff_number
          from our_staff os
         where os.staff_id = pp.staff_id) staffCode,
       pp.ol_id olId,
       pp.rela_id relaId,
       ppf.id partyPointFeeId,
       ppf.state feeState,
       case ppf.state
         when 'F' then
          '物品已出库'
         when 'S' then
          '物品已出库'
         when 'R' then
          '物品已返销'
         else
          '物品未出库'
       end feeStateString,
       ppf.state_date feeStateDate,
       (select count(*) from party_point t where t.state ='P' and t.rela_id = pp.id) beenRefunded
  from party_point pp, party_point_fee ppf
 where pp.id = ppf.party_point_id
   and pp.state = 'P'
   and pp.state_date > sysdate - 365
   and pp.party_id = #partyId:DECIMAL#
      	]]>
   </select>
     <select id="queryOrderList" resultClass="java.lang.Integer" parameterClass="java.lang.Long" >
		<![CDATA[
        select count(1)
                 from order_list a
                 where a.status_cd != 'C'
                  and a.ol_id = #orderId#
      	]]>
   </select>
   <!-- 送PCRF数据提取 -->
   <select id="getServSpecIdForPCRF" resultClass="java.util.HashMap" parameterClass="java.util.HashMap" >
		<![CDATA[
  	 select   bs.bo_id,
               po.prod_id as prod_id,
              bso.serv_spec_id as serv_spec_id,
               bs.state as state,
                 bo.bo_action_type_cd,
                to_char(bs.start_dt, 'yyyyMMddHH24miss') as state_date,
               to_char(bs.end_dt, 'yyyyMMddHH24miss') as end_date
          from bo_serv bs, bo_serv_order bso, prod_order po,serv_spec ss, bo_archive_grp bag,busi_order bo
         where bs.bo_id = bso.bo_id
           and bs.serv_id = bso.serv_id
           and bs.bo_id = po.bo_id      
           and bag.bo_id = bo.bo_id
           and bag.bo_id =bs.bo_id 
            and bso.serv_spec_id = ss.serv_spec_id
           and bag.bo_archive_grp_id=#acchiveId#
          and bo.bo_action_type_cd in('7','3047','3048','3057','3058')
           and bo.status_cd = 'C'
                 and not exists (select 1
                  from atom_action a
                 where a.atom_action_id = bs.atom_action_id
                   and a.status_cd = 'D')
           

          
      	]]>
   </select>
   
   
   <select id="PCRFServSpecId" resultClass="java.util.HashMap" parameterClass="java.util.HashMap" >
		<![CDATA[
  	
         select t.serv_spec_id,t.flag,t.pcrf_serv_id from intf.SO_PCRF_SERV_DATA  t where flag=#flag#
      	]]>
   </select>
   
   
    <update id="updateC2uPCRFSt" parameterClass='java.util.HashMap'>
     UPDATE intf.csip_c2u_events_esb_pcrf p
   		SET p.status=#status#
 		WHERE p.object_key=#acchiveId#
 	
     
     </update>
     
      <insert id='saveC2uPCRFToHis' parameterClass='java.util.HashMap'>
		insert into INTF.csip_c2u_events_pcrf_log
  (transaction_id,
   OBJECT_KEY,
   ORDER_NUMBER,
   EVENT_PRIORITY,
   EVENT_TIME,
   PARENT_ORDER_NUMBER,
   party_id,
   fee_type,
   complete_date,
   result_code,
   result_msg,
   esb_result_code,
   esb_result_msg,
   message_content,
   ol_nbr,
   prod_id,
   offer_param)
   select 
   #TransactionId#,
   #acchiveId#,
   t.order_number,
   t.event_priority,
   t.event_time,
   t.parent_order_number,
   t.party_id,
   t.fee_type,
   sysdate,
   #resultCode#,
   #resultMsg#,
   #errCode#,
   #desc#,
   #xml#,
   t.ol_nbr,
   t.prod_id,
   t.offer_param
   from intf.csip_c2u_events_esb_pcrf t where t.object_key=#acchiveIdOld#
         
        
     </insert>
     
      <select id="getCsipPCRFListByst" resultClass="java.util.HashMap" >
		<![CDATA[
	 select t.object_key,
       t.prod_id,
       t.event_priority,
       t.party_id,
       t.fee_type,
       t.ol_nbr,
       t.offer_param
    from intf.csip_c2u_events_esb_pcrf t,LISTENER_CONF lc
   where t.status = 'W' and lc.system_code='IM' and lc.listener_code='CsipPCRFListenerThread'
     and mod(t.object_key, to_number(lc.thread_count_max)) = #threadIndex# and rownum<2
          
      	]]>
   </select>
   
    <select id="getProdCompRelaRoleCd" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		select t.prod_comp_rela_role_cd role_cd,t.comp_prod_id from bo_prod_comp_order t where t.bo_id =#boId#
		]]>
   </select>
   
    <select id="getAccNumByCompProdId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		SELECT o.redu_access_number   access_number
  FROM offer_prod_comp t, offer_prod o
 where t.prod_id = o.prod_id
   and comp_prod_id = #compProdId#
   and t.prod_comp_rela_role_cd = '244'
		]]>
   </select>
   
    <delete id='delC2uPCRFData' parameterClass='java.lang.String'>
		delete intf.csip_c2u_events_esb_pcrf t where t.object_key=#acchiveId# and t.status in ('F','C')
     </delete>
     
      <insert id='saveC2uPCRF2ESBERRToHis' parameterClass='java.util.HashMap'>
		insert into INTF.CSIP_C2U_EVENTS_PCRF_ERR_LOG
  (transaction_id,
   OBJECT_KEY,
   ORDER_NUMBER,
   EVENT_PRIORITY,
   EVENT_TIME,
   PARENT_ORDER_NUMBER,
   party_id,
   fee_type,
   complete_date,
   result_code,
   result_msg,
   esb_result_code,
   esb_result_msg,
   message_content,
   ol_nbr,
   prod_id,
   offer_param)
   select 
   #TransactionId#,
   #acchiveId#,
   t.order_number,
   t.event_priority,
   t.event_time,
   t.parent_order_number,
   t.party_id,
   t.fee_type,
   sysdate,
   #resultCode#,
   #resultMsg#,
   #errCode#,
   #desc#,
   #xml#,
   t.ol_nbr,
   t.prod_id,
   t.offer_param
   from intf.csip_c2u_events_esb_pcrf t where t.object_key=#acchiveIdOld#
         
        
     </insert>
     
     
      <insert id='saveC2uPCRFNO4GToHis' parameterClass='java.util.HashMap'>
		insert into INTF.csip_c2u_events_pcrf_no4g_log
  (transaction_id,
   OBJECT_KEY,
   ORDER_NUMBER,
   EVENT_PRIORITY,
   EVENT_TIME,
   PARENT_ORDER_NUMBER,
   party_id,
   fee_type,
   complete_date,
   result_code,
   result_msg,
   esb_result_code,
   esb_result_msg,
   message_content,
   ol_nbr,
   prod_id,
   offer_param)
   select 
   #TransactionId#,
   #acchiveId#,
   t.order_number,
   t.event_priority,
   t.event_time,
   t.parent_order_number,
   t.party_id,
   t.fee_type,
   sysdate,
   #resultCode#,
   #resultMsg#,
   #errCode#,
   #desc#,
   #xml#,
   t.ol_nbr,
   t.prod_id,
   t.offer_param
   from intf.csip_c2u_events_esb_pcrf t where t.object_key=#acchiveIdOld#
         
        
     </insert>
     
     
      <select id="getPcrfServInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		select t.prod_id,t.serv_spec_id,t.status_cd from offer_serv t where t.prod_id=#prodId# and t.status_cd in (11,12)
		]]>
   </select>
   
    <select id="getPCRFTransactionId" resultClass="java.lang.String" >
		<![CDATA[
		SELECT SEQ_PCRF_TRANSACTION_ID.NEXTVAL transactionId FROM DUAL
		]]>
   </select>
   
    <select id="getPSInfoForPCRF" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		select t.bo_action_type_cd, a.bo_archive_grp_id, a.bo_id
      from busi_order t, bo_archive_grp a
     where t.bo_action_type_cd in ('3047', '3048', '3057', '3058')
     and t.bo_id=a.bo_id
     and a.bo_archive_grp_id=#acchiveId#
		]]>
   </select>
   
   
    <!-- 送PCRF数据提取 end-->
    
    
    
    <select id="getDevNumIdByAccNum" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
		SELECT d.dev_num_id
          FROM rm.terminal_device        a,
         rm.terminal_dev_2_dev_num b,
         rm.device_number          d,
         rm.device_2_ne            e,
         sr.mkt_res_inst           mri
         WHERE a.terminal_dev_id = b.terminal_dev_id
           AND b.dev_num_id = d.dev_num_id
           AND d.number_element_id = e.number_element_id
           AND a.terminal_dev_spec_id = '10302057'
           AND d.an_type_cd = 509
           AND d.rsc_status_cd = '17'
           AND e.device_id IN
               (SELECT device_id
                  FROM rm.device_2_ne d2, rm.phone_number p
                 WHERE d2.number_element_id = p.number_element_id
                   AND p.phone_number = #accNum#)
           AND a.area_id = 11000
           AND NOT EXISTS
         (SELECT *
                  FROM rm.terminal_dev_2_phone_num t2p
                 WHERE t2p.terminal_dev_id = a.terminal_dev_id)
           AND a.terminal_code = mri.mkt_res_inst_code
           AND mri.status_cd = '10'
           AND mri.mkt_res_store_id IN
               (SELECT store_id
                  FROM CRM.channel_2_store css
                 WHERE css.channel_id = 11040361)
           AND mri.mkt_res_id IN
               (SELECT material_id
                  FROM sr.material_tm mt
                 WHERE mt.material_kind_id = 'A1')
           AND rownum = 1
		]]>
   </select>
    
    <select id="getValidateYHParams" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
    		select count(1)
			  from offer_prod op, party p, party_identity pi
			 where op.redu_owner_id = p.party_id
			   and p.party_id = pi.party_id
			   and op.status_cd in ('11', '12', '13', '20', '21')
			   and op.redu_access_number = #accNum#
			 <isNotEmpty prepend="AND" property="partyName">
           		p.Name = #partyName#
   			 </isNotEmpty>
   			 <isNotEmpty prepend="AND" property="identifyType">
           		pi.identidies_type_cd = #identifyType#
   			 </isNotEmpty>
   			 <isNotEmpty prepend="AND" property="identifyNumber">
           		pi.identity_num = #identifyNumber#
   			 </isNotEmpty>
   </select>
   <select id="getValidateYHOffer" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
    		select count(1)
			  from crm_app.offer a, crm_app.offer_spec b, crm_app.offer_member c
			 where a.offer_spec_id = b.offer_spec_id
			   and a.offer_id = c.offer_id
			   and b.name = #offerName#
			   and c.member_id = #prodId#
   </select>
   
   
   <select id="getLteImsiByProdid" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		select er.dev_num from crm_app.offer_prod_2_td td,crm_app.terminal_dev_2_dev_num um,crm_app.device_number er
		where td.terminal_dev_id = um.terminal_dev_id
      	and  um.dev_num_id = er.dev_num_id
      	and er.an_type_cd in('507')
      	and  td.prod_id=#prodid# and rownum = 1		]]>
   </select>
   
    <select id="querySpeedValue" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		select  a.attr_id
       from ctg_spec.product_attr a, ctg_spec.item_spec b
         where a.attr_id = b.item_spec_id
          and b.name = '速率'
          and a.product_id = #prodSpecId#  and rownum = 1		]]>
   </select>
   
    <select id="getProdSmsByProdId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		select op.redu_owner_id     partyId,
       op.redu_acct_id      instId,
       op.redu_prod_spec_id objId
  from offer_prod op
 where op.prod_id = #prodid#
   and rownum = 1		]]>
   
   </select>
   
   <select id="getProdInfoByAccNbr" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		select  op.prod_id as "prodId", 
        op.redu_prod_spec_id as "prodSpecId",
        op.redu_owner_id as "partyId"     from crm_app.offer_prod op   WHERE op.status_cd = '12'
       and op.redu_access_number = #accNbr#
     ]]>
   </select>
   
    <select id="getCouponInfoByTerminalCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT a.sales_price      as "apCharge",
		       a.mkt_res_inst_id  as "prod2TdId",
		       a.mkt_res_id       as "couponId",
		       A.MKT_RES_STORE_ID as "storied"
		  FROM sr.mkt_res_inst a
		 where a.mkt_res_inst_code =  #terminalCode#
     ]]>
   </select>
   
    <select id="getgetprod2TdIdDelCodeCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT a.prod_2_td_id
			 from INST.offer_prod_2_td a
			 where a.status_cd = '12'
			   and a.terminal_code = #terminalCode#
			   and rownum < 2
		     
     ]]>
   </select>
    <select id="queryByPartyId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select *
			  from party_identity A
			 WHERE A.identidies_type_cd = '13'
			   and a.party_id = #partyId#
			   AND rownum < 2
     ]]>
   </select>
    <select id="queryEmailByPartyId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select a.mail_address_str 
			from sm.party a 
			where a.party_id = #partyId#
			   AND rownum < 2
     ]]>
   </select>
   
    <select id="getBasicCouponInfoByTerminalCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT TO_CHAR(TD.DEVICE_MODEL_ID) AS DEVICE_MODEL_ID,
			       RDM.NAME AS DEVICE_MODEL_NAME,
			       TO_CHAR(TD.TERMINAL_DEV_SPEC_ID) AS TERMINAL_DEV_SPEC_ID,
			       RS.NAME,
			       TO_CHAR(TD.TERMINAL_DEV_ID) AS TERMINAL_DEV_ID,
			       TO_CHAR(DN.DEV_NUM_ID) AS AN_ID,
			       TO_CHAR(MT2DM.MATERIAL_ID) AS COUPON_ID
			  FROM RM.MATERIAL_TM_2_DEVICE_MODEL MT2DM,
			       RM.DEVICE_NUMBER              DN,
			       RM.TERMINAL_DEV_2_DEV_NUM     TD2DN,
			       RM.RESOURCE_SPEC              RS,
			       RM.RSC_DEVICE_MODEL           RDM,
			       RM.TERMINAL_DEVICE            TD
			 WHERE MT2DM.DEVICE_MODEL_ID = TD.DEVICE_MODEL_ID
			   AND DN.AN_TYPE_CD = 509
			   AND DN.DEV_NUM_ID = TD2DN.DEV_NUM_ID
			   AND TD2DN.TERMINAL_DEV_ID = TD.TERMINAL_DEV_ID
			   AND RS.RSC_SPEC_ID = TD.TERMINAL_DEV_SPEC_ID
			   AND RDM.DEVICE_MODEL_ID = TD.DEVICE_MODEL_ID
			   AND TD.TERMINAL_CODE = #terminalCode#
     ]]>
   </select>
   
   <select id="queryTerminalCodeByProdId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		Select a. terminal_code as "terminalCode"
		  from crm_app.offer_prod_2_td a 
		where a.status_cd = '12' and a.prod_id = #prodId#
     ]]>
   </select>
   
   <select id="getDevInfoByCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		 select  d.terminal_dev_id as "terminalDevId", 
				 d.terminal_dev_spec_id as "terminalDevSpecId", 
				 d.device_model_id as "devModelId"
	   			from rm.terminal_device d
			 WHERE d.terminal_code = #devCode#]]>
   </select>
   
   <select id="getStaffIdByStaffCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		 SELECT sn.staff_id as "staffId" FROM crm_app.staff_number sn WHERE sn.STAFF_NUMBER = #devCode#]]>
   </select>
   
   <select id="getDevNumIdByDevCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT a.dev_num_id
		  FROM crm_app.terminal_dev_2_dev_num a,inst.offer_prod_2_td c
		 WHERE a.terminal_dev_id = c.terminal_dev_id
		     and c.terminal_code = #devCode#]]>
   </select>
   
   <select id="isUimBak" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
		SELECT count(1) cou
  FROM bo_prod_2_uim
 WHERE prod_id = #prodid#
   AND status = 1]]>
   </select>
   
   <select id="getIsOrderOnWay" resultClass="java.lang.String" parameterClass="java.util.HashMap">
   <![CDATA[
    		SELECT DISTINCT psaat.atom_action_type_cd
  FROM bo_action_type_2_atom_action bataa, prod_spec_2_atom_action_type psaat
 WHERE bataa.atom_action_type_cd = psaat.atom_action_type_cd
   AND bataa.bo_action_type_cd = '14'
   AND bataa.action_type_cd <> '62'
   AND psaat.prod_spec_id = #prodSpecId#
INTERSECT
SELECT DISTINCT psaat.atom_action_type_cd
  FROM bo_action_type_2_atom_action bataa,
       prod_spec_2_atom_action_type psaat,
       (SELECT DISTINCT bo.bo_action_type_cd
          FROM busi_order bo, order_list ol, prod_order po
         WHERE bo.bo_id = po.bo_id
           AND bo.ol_id = ol.ol_id
           AND ol.status_cd <> 'PC'
           AND bo.status_cd IN ('W', 'S', 'P', 'N', 'G', 'B', 'E', 'A')
           AND po.prod_id = #prodId#) rec
 WHERE rec.bo_action_type_cd = bataa.bo_action_type_cd
   AND bataa.atom_action_type_cd = psaat.atom_action_type_cd
   AND bataa.action_type_cd <> '62'
   AND psaat.prod_spec_id = #prodSpecId#
   ]]>
   </select>
   
    <select id="findTelphoneByCardno" resultClass="java.lang.String" parameterClass="java.lang.String">
   <![CDATA[
    		select a.acc_nbr
  from inst.offer_coupon t, CTG_INST.PROD_INST a
   where t.coupon_ins_number = #terminalCode:varchar#
   and t.status_cd = '12'
   and t.prod_id = a.prod_inst_id
   and a.item_status_cd = '12'
   and rownum < 2
   ]]>
   </select>
   
   <select id="findTelphoneByDiscard" resultClass="java.lang.String" parameterClass="java.lang.String">
   <![CDATA[
    		select a.acc_nbr
  FROM inst.Offer_Prod_2_Td t, CTG_INST.PROD_INST a
 where t.Terminal_Code = #terminalCode:varchar#
   and t.status_cd <> '12'
   and t.prod_id = a.prod_inst_id
   and a.item_status_cd = '12'
   and rownum < 2
   ]]>
   </select>
   
   <select id="isExistCardByProdId" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
	   <![CDATA[
	    	select count(1) from offer_prod_2_td t 
	      	where t.prod_id = #prodId:NUMBER# 
			and t.terminal_code = #terminalCode:varchar2#
			and t.status_cd in ('10','11','12')
	   ]]>
   </select>
   
   <select id="getImsiInfoByBillingNo" resultClass="java.util.HashMap" parameterClass="java.lang.String">
	   <![CDATA[
	    	SELECT TD.TERMINAL_CODE TERMINAL_CODE,
                rm.PG_NUM_PROCEDURE.FUN_GETDEVNUM(TD.TERMINAL_DEV_ID, 510) GIMSI,
                rm.PG_NUM_PROCEDURE.FUN_GETDEVNUM(TD.TERMINAL_DEV_ID, 509) CIMSI,
                rm.PG_NUM_PROCEDURE.FUN_GETDEVNUM(TD.TERMINAL_DEV_ID, 507) LTEIMSI
           FROM rm.TERMINAL_DEVICE TD
          WHERE TD.Terminal_Code = (select t.coupon_ins_number
  from inst.offer_coupon t, CTG_INST.PROD_INST a
   where t.status_cd = '12'
   and t.prod_id = a.prod_inst_id
   and a.item_status_cd <> '22'
   and a.acc_nbr = #billingNo:varchar#
   and rownum < 2)
	   ]]>
   </select>
   
   
   <select id="getBillingCardRelation" resultClass="java.util.HashMap" parameterClass="java.lang.String">
	   <![CDATA[
	    	SELECT t.prod_comp_rela_role_cd CD, t1.redu_access_number ACCNUMBER

  FROM offer_prod_comp t, offer_prod t1

where t.comp_prod_id = (SELECT a.comp_prod_id

                           FROM offer_prod_comp a, offer_prod b

                          where b.redu_access_number = #accnum:varchar2#

                            and a.status_cd = 12

                            and a.prod_comp_rela_role_cd in (243, 244)

                            and a.prod_id = b.prod_id)

   and t.prod_id = t1.prod_id
	   ]]>
   </select>
   
      <select id="queryMustSelOfferByProd" resultClass="java.lang.Long" parameterClass="java.lang.Long">
      <![CDATA[
      		select a.RELA_OFFER_SPEC_ID from ctg_spec.offer_spec_rela a,crm_app.offer_spec b,crm_app.offer c,crm_app.offer_member d
where
 a.OFFER_SPEC_ID = b.OFFER_SPEC_ID and
 b.OFFER_TYPE_CD='1' and
 b.OFFER_SPEC_ID = c.OFFER_SPEC_ID and c.status_cd <> '22' and
 d.offer_id = c.offer_id and d.member_id = #prodId#
      ]]>
   		</select>
   		
   		
   		<select id="queryTableSpace" resultClass="java.util.HashMap" >
      <![CDATA[
      		select n.TABLESPACE,n.MEGS_ALLOC,n.PCT
  FROM (SELECT a.tablespace_name as TABLESPACE,
               ROUND(a.bytes_alloc / 1024 / 1024) megs_alloc,
               round(ROUND((a.bytes_alloc - NVL(b.bytes_free, 0)) / 1024 / 1024) /
                     ROUND(maxbytes / 1048576) * 100) PCT
          FROM (SELECT f.tablespace_name,
                       SUM(f.bytes) bytes_alloc,
                       SUM(DECODE(f.autoextensible,
                                  'YES',
                                  f.maxbytes,
                                  'NO',
                                  f.bytes)) maxbytes
                  FROM dba_data_files f
                 GROUP BY tablespace_name) a,
               (SELECT f.tablespace_name, SUM(f.bytes) bytes_free
                  FROM dba_free_space f
                 GROUP BY tablespace_name) b
         WHERE a.tablespace_name = b.tablespace_name(+)
 order by PCT desc) n
 where rownum < 10
      ]]>
   		</select>
   		
   		
   		<select id="queryUseSpaceNotSysLob" resultClass="java.util.HashMap" parameterClass="java.lang.String">
      <![CDATA[
      		select n.SEGMENT_NAME,n.TABLESPACE_NAME,n.USERD
  from (SELECT SEGMENT_NAME ,
               TABLESPACE_NAME ,
               round(SUM(BYTES) / 1024 / 1024 / 1024) USERD 
          FROM DBA_SEGMENTS
         WHERE TABLESPACE_NAME = #tableSpaceName:varchar2#
           and segment_name not like '%SYS_LOB%'
         GROUP BY SEGMENT_NAME, TABLESPACE_NAME
        having SUM(BYTES) / 1024 / 1024 / 1024 > 1
         ORDER BY SUM(BYTES) / 1024 / 1024 / 1024 DESC) n
 where rownum < 10
      ]]>
   		</select>
   		
   		<select id="queryUseSpaceSysLob" resultClass="java.util.HashMap" parameterClass="java.lang.String">
      <![CDATA[
      		select n.SEGMENT_NAME, n.USERD, n.TABLE_NAME
  from (select b.SEGMENT_NAME,
               round(b.BYTES / 1024 / 1024 / 1024) USERD,
               a.TABLE_NAME
          from all_lobs a, dba_segments b
         where a.SEGMENT_NAME = b.segment_name
           and b.TABLESPACE_NAME = #tableSpaceName:varchar2#
           and b.segment_name like '%SYS_LOB%'
           and b.BYTES / 1024 / 1024 / 1024 > 1
         order by b.BYTES / 1024 / 1024 desc) n
 where rownum < 10
      ]]>
   		</select>
   		
   		
   		<select id="queryCrmLockInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
      <![CDATA[
      SELECT SESS.SID,
       $param$ SERIAL,
       LO.ORACLE_USERNAME,
       LO.OS_USER_NAME,
       AO.OBJECT_NAME,
       logon_time,
       LO.LOCKED_MODE
  FROM $tableName1$ LO, DBA_OBJECTS AO, $tableName2$ SESS
 WHERE AO.OBJECT_ID = LO.OBJECT_ID
   AND LO.SESSION_ID = SESS.SID
   and ao.object_name like '%%'
 order by logon_time asc
      ]]>
   		</select>
   		
   		<select id="queryDBSessionInfo" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
      <![CDATA[
      SELECT sum(n.aaa) SESSIONNUM
  from (select a.MACHINE, COUNT(1) aaa
          from $tableName$ a
         group by a.MACHINE
         order by 2 DESC) n
      ]]>
   		</select>
   		
   		
   <insert id="saveBenzBusiOrder" parameterClass="java.util.HashMap">
 	    <![CDATA[
 	    		insert into intf.benz_busiorder
  (REQ_NO,
   REQ_TIME,
   ACC_NBR,
   OLD_OFFER_ID,
   OLD_OFFER_NAME,
   NEW_OFFER_ID,
   NEW_OFFER_NAME,
   OFFER_EFF_TYPE,
   CLOSE_DATA_SERV,
   INTO_VPDN,
   CREATE_DT,
   AUTO_MANU_TYPE,
   RESULT_CODE)
values
  (#REQ_NO#,
   #REQ_TIME#,
   #ACC_NBR#,
   #OLD_OFFER_ID#,
   #OLD_OFFER_NAME#,
   #NEW_OFFER_ID#,
   #NEW_OFFER_NAME#,
   #OFFER_EFF_TYPE#,
   #CLOSE_DATA_SERV#,
   #INTO_VPDN#,
   #CREATE_DT#,
   #AUTO_MANU_TYPE#,
   #RESULT_CODE#)
 	    		
 	    ]]>
	</insert>		
   		
   		
   		<insert id="saveBenzBusiOrderSub" parameterClass="java.util.HashMap">
 	    <![CDATA[
 	    		insert into intf.BENZ_BUSIORDER_SUBOFFER
  (REQ_NO,
   OFFER_ID,
   OFFER_NAME,
   OFFER_EFF_TYPE,
   CREATE_DT)
values
  (#reqNo#,
   #offerId#,
   #offerName#,
   #offerEffTypeS#,
   sysdate)
 	    ]]>
	</insert>
	
	
	<select id="isBenzOfferServUser" resultClass="java.lang.Long" parameterClass="java.lang.String">
      <![CDATA[
		      select count(1) from offer_prod op,offer_serv os
		where op.redu_access_number = #accNum#
		and op.status_cd in (10,11,12,13)
		and op.prod_id = os.prod_id
		and os.status_cd <> 22
		and os.serv_spec_id = 20141367
      ]]>
   		</select>
   		
   		<select id="getProdItemsByParam" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
      <![CDATA[
		     select oi.value ITEM_VALUE,n.name ITEM_SPEC_NAME from offer_prod_item oi,item_spec n
where oi.item_spec_id = n.item_spec_id
and oi.prod_id = #prodId# and oi.item_spec_id = #itemSpecId#
      ]]>
   		</select>
   		
   		
	<select id="getCustClassInfoByCustId" resultClass="java.util.HashMap" parameterClass="java.lang.Double">
      <![CDATA[
		     select c.op_time,c.cust_id,c.cust_class_id,c.bill_fee from s_crm_cust_class c where c.cust_id = #custId#
      ]]>
   		</select>
   		
   	<select id="getCustIdByAccNum" resultClass="java.lang.Long" parameterClass="java.lang.String">
      <![CDATA[
      select t.cust_id cust_id from offer_prod op,ctg_inst.cust t
where t.party_id = op.redu_owner_id
and op.status_cd in ('10','11','12','13','20')
and op.redu_access_number = #accNum:VARCHAR2#
and rownum < 2
      ]]>
   		</select>	
   		
   	<select id="queryOfferProdStatus" resultClass="java.util.HashMap" parameterClass="java.lang.String">
      <![CDATA[
      select n.prod_status_cd,n.partyId,n.pstName from 
(select ops.prod_status_cd prod_status_cd,
       op.redu_owner_id   partyId,
       pst.name           pstName
  from offer_prod_status ops, offer_prod op, prod_status_type pst
 where op.prod_id = ops.prod_id
   and pst.prod_status_cd = ops.prod_status_cd
   and op.status_cd in ('10', '11', '12', '13', '20')
   and ops.status_cd in ('10', '11', '12', '13', '20')
   and op.redu_access_number = #accNbr#
   order by ops.status_dt desc) n
   where rownum < 2
      ]]>
   		</select>	
   		
	<select id="isFtWifiSystem" resultClass="java.lang.Long" parameterClass="java.lang.String">
      <![CDATA[
		      select count(1) cou from offer_prod op,offer_member om,offer r
where op.prod_id = om.member_id
and om.offer_id = r.offer_id
and r.offer_spec_id in (30309,30310,993029986,993029987,993029988)
and op.status_cd in ('10','11','12','13','20')
and op.redu_access_number = #accNbr#
      ]]>
   		</select>
   		
   		<select id="checkHykdOrder" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
      <![CDATA[
		      select count(1)
     from offer_prod op, offer_member t, offer a, offer_spec b
    where op.redu_access_number = #accNum#
      and op.redu_owner_id = #custId#
      and t.member_id = op.prod_id
      and t.offer_id = a.offer_id
      and a.offer_spec_id = b.offer_spec_id
      and op.redu_prod_spec_id = 378
      and op.status_cd in ('10', '11', '12', '13', '20')
      and t.status_cd in ('10', '11', '12', '13', '20')
      and b.offer_type_cd = '2'
      and b.offer_spec_id in
          (select t.offer_spec_id
             from spec.offer_spec_2_category_node t
            where t.category_node_id = -2010002)
            and rownum < 2
      ]]>
   		</select>
   		
   		<select id="checkCustName" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
      <![CDATA[
		      select count(1) from offer_prod op ,party p
where op.status_cd in ('10','11','12','13','21')
and op.redu_access_number = #phone_number:varchar#
and op.redu_owner_id = p.party_id
and p.Name = #cust_name:varchar#
and rownum <2
      ]]>
   		</select>
   		
   		<select id="getPartyTypeCdByProdId" resultClass="java.util.HashMap" parameterClass="java.lang.Long">
      <![CDATA[
		      select p.PARTY_TYPE_CD,p.party_id from offer_prod op,party p
where op.redu_owner_id = p.party_id
and op.prod_id = #prodId:NUMBER#
and rownum < 2
      ]]>
   		</select>
   		<select id="checkOfferSpecBsns" resultClass="java.lang.Long" parameterClass="java.lang.String">
      <![CDATA[
		      select count(1) from intf.SERVICEOFFERSPEC n where n.offercode = #code#
      ]]>
   		</select>
   		
   		<select id="checkBankFreeze2" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
      <![CDATA[
		      select count(1)
  from crm.freezerent l
 where l.bank_type = #bankCode#
   and l.freeze_no = #freezeNo#
      ]]>
   		</select>
   	
   	<select id="qryOrderListByOlId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
      <![CDATA[
		     select n.ol_id,n.ol_nbr,n.status_cd,n.remarks,n.party_id from order_list n where n.ol_id = #olId# and rownum < 2
      ]]>
   		</select>
   
   
   <select id="getNbrTypeByAccNbr" resultClass="java.lang.String" parameterClass="java.lang.String">
      <![CDATA[
      	select 
decode(op.redu_prod_spec_id,
        '1',
        '2000003',
        '2',
        '2000001',
        '5',
        '2000001',
        '2537',
        '2000001',
        '2538',
        '2000001',
        '2539',
        '2000001',
        '10015',
        '2000001',
        '10021',
        '2000001',
        '10018',
        '2000001',
        '10071',
        '2000001',
        '10095',
        '2000001',
        '10109',
        '2000001',
        '600000207',
        '2000001',
        '20130060',
        '2000001', 
        '378',
        '2000004',
        '379',
        '2000004',
        '403',
        '2000004',
        '10001',
        '2000004',
        '10081',
        '2000004',
        '10120',
        '2000004',
        '2000002') as nbrType
from offer_prod op where op.redu_access_number = #accNbr# and op.status_cd in ('10','11','12','13','20') and rownum < 2
      ]]>
   		</select>
   		
   		<select id="qryEncryptStrByParam" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
      		 select n.componentid,n.isactive,n.encrytstr from intf.encryptVectorConfig n where 1=1 
			 <isNotEmpty prepend="AND" property="componentId">
           		n.componentid = #componentId#
   			 </isNotEmpty>
   		</select>
   		
   <!-- 根据工号查询组织和员工ID  -->
	<select id="queryOrgByStaffNumber" parameterClass="java.lang.String" resultClass="java.util.HashMap" >
        select a.ORG_ID, o.PARENT_ORG_ID ,a.STAFF_ID
 		from staff_number a, sm.organization o
	 	where a.ORG_ID = o.org_id and a.staff_status_cd=1
	   	and a.STAFF_NUMBER = #staffNumber:VARCHAR#
	</select>
	<select id="findOrgByStaffId" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
      	select org_id orgId from sm.staff_number where staff_id=#staffId:DECIMAL#
	</select>
	<!-- 根据PROD_ID查询用户对应的业务发展人STAFF_ID  -->
	<select id="queryStaffByProdId" parameterClass="java.lang.Long" resultClass="java.lang.Long" >
       select distinct OP2S.Staff_Id 
       from offer_prod_2_staff OP2S 
       where OP2S.Party_Rela_Role_Cd=11  and OP2S.Bo_Id is not null 
       and  OP2S.PROD_ID=#prodIdLong:DECIMAL#
	</select>
	
	<select id="getIDCardEncryptionVector" parameterClass="java.lang.String" resultClass="java.lang.String" >
       <![CDATA[
		      select n.ENCRYPTIONSTR
  from intf.idcardencryptionvector n
 where n.macstr = #mac#
   and n.state = '0'
      ]]>
	</select>	
	
	
	
	<select id="getGhAddressTemp" resultClass="java.util.HashMap" >
	<![CDATA[
      		 select t.ghfgs,t.dxssqj,t.xqmc1,t.xqmc2,t.crmlyid,t.ghlyid,t.jtlh from intf.ghAddressTemp t
where t.ghfgs <> 'ghfgs' and not exists (select 1 from intf.ghAddressUnitTemp n where t.ghlyid = n.ghlyid)     		 ]]> 
   	</select>
   	<insert id='insertGhAddressUnit' parameterClass='java.util.HashMap'>
		insert into intf.ghAddressUnitTemp
  (ID, GHLYID, UNIT, ADDRESS,CITY,AREA,MAINLOAD,SECONDLOAD,VILLAGENAME,BUILDINGNUMBER,UNITNUMBER,HOUSELEVER,HOUSENUMBER)
values
  (intf.seq_ghaddressunittemp.nextval, #ghlyid#, #unitname#, #address#,#city#,#area#,#mainLoad#,#secondLoad#,#villageName#,#buildingNumber#,#unitNumber#,#houseLever#,#houseNumber#)
     </insert>
   	
   			
   	<select id="queryBussinessOrder" parameterClass="java.util.HashMap" resultClass="java.lang.Long" >
       <![CDATA[
		      select count(1)
  from intf_req_ctrl n
 where  n.mainkey = #mainkey#
   and n.ordertype = #orderType#
   and n.flag = 'N'
      ]]>
	</select>
	
	<select id="querySeqBussinessOrder" resultClass="java.lang.Long" >
       <![CDATA[
		      select intf.SEQ_intf_req_ctrl.nextVal from dual
      ]]>
	</select>
	
	<insert id='saveBussinessOrderCheck' parameterClass='java.util.HashMap'>
		insert into intf_req_ctrl
  (ID, mainkey, ordertype,  createtime, arg1,flag)
values
  (#id#, #mainkey#, #orderType#,  sysdate, '','N')
     </insert>
	
	<update id="updateBussinessOrderCheck" parameterClass="java.util.HashMap">
		update intf_req_ctrl
       set flag = to_char(sysdate, 'yyyymmddhh24miss')
     WHERE id = #id#
	</update>
	
	
	<select id="getIntfReqCtrlValue" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		select p.cvalue from intf.intf_req_ctrl_control p where p.ckey = #string#
		     	]]>
   </select>
	 <select id="isAccNumRealNameparty" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
		<![CDATA[
		select p.if_realname from ctg_inst.party p where p.party_id = (select op.redu_owner_id from offer_prod op where op.prod_id = #prodId#)      	]]>
   </select>
   
   
   <select id="checkParByIdCust" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		select p.party_id ,p.Name from offer_prod op,party p
where op.status_cd in (10,11,12,13,20)
and op.redu_owner_id = p.party_id
and op.redu_access_number = #accNbr#
and p.Name like '%' || #custName# || '%'
and rownum < 2
		     	]]>
   </select>
   <select id="queryOfferProdItemsByProdId" resultClass="java.util.HashMap" parameterClass="java.lang.Long">
		<![CDATA[
		select op.prod_id,
       max(decode(op.item_spec_id, '201517', op.value, '')) as useName,
       max(decode(op.item_spec_id, '201518', op.value, '')) as useId
  from offer_prod_item op
 where op.status_cd in (10, 11, 12, 13, 20)
   and op.prod_id = #prodId#
 group by op.prod_id
		     	]]>
   </select>
   
   
   
   <select id="isManyPartyByIDNum" resultClass="java.lang.Long" parameterClass="java.util.HashMap">
		<![CDATA[
		select count(1)
  from party_identity n
 where n.identity_num = #cerdValue#
   and n.identidies_type_cd = #cerdType#
		     	]]>
   </select>
   
   <insert id="insertSms" parameterClass="java.util.HashMap">
		<selectKey resultClass="int" type="pre" keyProperty="id">
			SELECT
			CRM.SEQ_SMS_ID.NEXTVAL AS VALUE FROM DUAL  
	</selectKey>
		INSERT INTO crm.SMS_INFO
		(ID,
		MSISDN,
		FLAG,
		MSG,
		STS,
		REMIND_TYPE_CODE)
		values
		( #id#,
		#accNbr#, 'SEND',#msg#, 'A', #smsSystem#)
	</insert>
   
		<select id="qryBoInfos" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
	<![CDATA[
      		 select bo.bo_id, bat.NAME desc1, os.name 
   from so.busi_order           bo,
        ctg_spec.bo_action_type bat,
        so.offer_order          oo,
        spec.offer_spec         os,
        inst.offer_member       om,
        inst.offer_prod         op
  where bo.ol_id = #ol_id#
    and bat.BO_ACTION_TYPE_CD = bo.bo_action_type_cd
    and os.offer_spec_id = oo.offer_spec_id
    and oo.bo_id = bo.bo_id
    and bo.status_cd <> 'D'
    and om.offer_id = oo.offer_id
    and om.member_id = op.prod_id
    and op.redu_access_number = #anum#
    union
     select bo.bo_id,bat.NAME,ps.name 
   from so.busi_order           bo,
        ctg_spec.bo_action_type bat,
        so.prod_order      po,
        inst.offer_prod         op,
        ctg_spec.prod_spec ps
  where bo.ol_id = #ol_id#
    and bat.BO_ACTION_TYPE_CD = bo.bo_action_type_cd
    and bo.status_cd <> 'D'
    and bo.bo_id=po.bo_id
    and po.prod_id= op.prod_id
    and ps.prod_spec_id=op.redu_prod_spec_id
    and op.redu_access_number = #anum#
      		      		 ]]> 
   	</select>
   	
   	<select id="qryBoInfosAdd" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
	<![CDATA[
      		 select bo.bo_id, bat.NAME desc1, os.name
  from so.busi_order           bo,
       ctg_spec.bo_action_type bat,
       so.offer_order          oo,
       spec.offer_spec         os,
       inst.offer_member       om,
       inst.offer_prod         op

 where bo.ol_id = #ol_id#
   and bat.BO_ACTION_TYPE_CD = bo.bo_action_type_cd
   and os.offer_spec_id = oo.offer_spec_id
   and oo.bo_id = bo.bo_id
   and bo.status_cd <> 'D'
   and om.offer_id = oo.offer_id
   and om.member_id = op.prod_id
   and op.redu_access_number = #anum#
   and os.OFFER_TYPE_CD = 1 
union
select b.bo_id, ac.NAME, c.name
  from so.busi_order  b,
       prod_order     p,
       offer_prod     f,
       prod_spec      c,
       bo_action_type ac
 where b.bo_action_type_cd = '1'
   AND B.ol_id = #ol_id#
   and p.bo_id = b.bo_id
   and f.prod_id = p.prod_id
   and c.prod_spec_id = f.redu_prod_spec_id
   and ac.BO_ACTION_TYPE_CD = '1'
      		      		 ]]> 
   	</select>
   	
   	
   	
   	<select id="qryChargesByOlid" resultClass="java.lang.Long" parameterClass="java.lang.String">
		<![CDATA[
			select sum(a.charge) from  so.bam_acct_item_info a where a.ol_id=#ol_id#
		]]>
   </select>
   	
   <select id="queryOfferAddressDesc" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
			 select pa.address_desc from inst.OFFER_PROD_2_ADDR pa where pa.status_cd='12' and pa.prod_id=#prodId# and rownum < 2
		]]>
   </select>
    <select id="getTmDescription" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
			select description
			  from rm.tml t
			 where t.tml_group_id = '1'
			   and t.tml_id = (select a.tml_id
			                     from INST.OFFER_PROD_2_TML a
			                    where a.prod_id =  #prodId#
			                      and rownum < 2)
			   and rownum < 2
		]]>
   </select>
   
    <select id="getOfferProdTmlName" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		 
		select Name
		  from (select b.Name
		          from inst.party_role_party a, crm.party b
		         where a.role_party_id = b.party_id
		           AND a.party_role_type_cd = 30
		           and a.party_id = (select op.redu_owner_id
		                               from offer_prod op
		                              where op.prod_id = #prodId#
		                                and rownum < 2)
		         order by b.CREATE_DT desc)
		 where rownum < 2
		                                 
                                
		]]>
   </select>
    <select id="getPartyManagerName" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
			 select a.tml_name, a.prod_id
				   from inst.offer_prod_2_tml a
				  where a.prod_id = #prodId#
				    and rownum < 2
		]]>
   </select>
   <select id="getOfferSpecAction2Count" resultClass="java.lang.Integer" parameterClass="java.lang.String">
		<![CDATA[
			 select count(*)
				  from crm_app.offer_spec_action_2_rule a
				 where a.b_rule_id = 91861
				   and a.bo_action_type_cd ='S1'
				   and a.offer_spec_id = #offerSpecId#
		]]>
   </select>
   <select id="getCommunityPolicy" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
			select a.post_paid_discount  from crm_app.building_2_discount a where a.building_id=#buildingId#  and rownum < 2
		]]>
   </select>
   
    <select id="getComponentBuildingId" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
			SELECT  A.BUILDING_ID
		  FROM INST.SA_2_COMPONENT a
		 where A.SERVICE_ID =#serviceId#
   		]]>
   </select>
   
   <select id="getOfferMemberInfo" resultClass="java.util.HashMap" parameterClass="java.lang.String">
      <![CDATA[
		  
		 
		   SELECT O.offer_id,
		       DD.name,
		       OSA.OFFER_SPEC_ID,
		       OM.start_dt,
		       OM.end_dt,
		       OSI.EFF_TIME,
		       to_char(ADD_MONTHS(OM.start_dt, OSI.EFF_TIME),'yyyymmdd') NEXTSTART,
		       to_char(ADD_MONTHS(OM.end_dt, OSI.EFF_TIME),'yyyymmdd') NEXTEND,
		       OM.member_id,
		       comp.comp_prod_id,
		       comp.redu_prod_spec_id,
		       (case
		         when rul.b_rule_id is null then
		          '100'
		         else
		          nvl(bc.post_paid_discount, 100)
		       end) post_paid_discount
		
		  FROM OFFER O,
		       OFFER_MEMBER OM,
		       OFFER_SPEC_ATTR OSA,
		       OFFER_SPEC_INFO OSI,
		       OFFER_SPEC DD,
		       offer_prod_2_sa_component opc,
		       (select compa.comp_prod_id, pba.redu_prod_spec_id, opb.prod_id
		          from offer_prod_comp compa, offer_prod opb, offer_prod pba
		         where compa.prod_id = opb.prod_id
		           and (opb.redu_access_number =#prodId:varchar#
		           or pba.redu_access_number =#prodId:varchar#)
		           and opb.status_cd = '12'
		           and compa.comp_prod_id = pba.prod_id
		        
		        ) comp,
		       INST.SA_2_COMPONENT sab,
		       
		       building_2_discount           bc,
		       spec.offer_spec_action_2_rule rul
		 WHERE O.OFFER_ID = OM.OFFER_ID
		   AND OM.obj_type = 2
		   AND O.status_cd IN (10, 11, 12, 13)
		   AND OM.status_cd IN (10, 11, 12, 13)
		   AND O.offer_spec_id = DD.offer_spec_id
		   AND O.offer_spec_iD = OSA.OFFER_SPEC_ID
		   AND OSI.OFFER_SPEC_ID = O.offer_spec_id
		   AND OSA.ITEM_SPEC_ID = 300000005
		   and om.member_id = comp.comp_prod_id
		   and opc.prod_id = comp.prod_id
		      
		   and opc.service_id = sab.service_id
		   and OSA.Offer_Spec_Id = rul.offer_spec_id(+)
		   and rul.b_rule_id(+) = '91861'
		   and sab.building_id = bc.building_id(+)
		   
      ]]>
   		</select>
   		  
    <select id="getOrganizStaffOrgId" resultClass="java.lang.String" parameterClass="java.lang.Long">
		<![CDATA[
		   SELECT pa.name
      FROM (SELECT *
              FROM sm.organization o
             start with o.org_id =
                        (SELECT sn.ORG_ID
                           FROM crm_app.offer_prod_2_party op, sm.staff_number sn
                          where op.party_product_rela_role_cd = '11'
                            and op.prod_id =#prodId#
                            and sn.STAFF_ID = op.party_id)
            connect by prior o.parent_org_id = o.org_id) oo ,party  pa
     where oo.parent_org_id = '1'
     and oo.org_id = pa.party_id
       and rownum < 2
   		]]>
   </select>
   <select id="getDevelopmentDepartment" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		   SELECT  p.Name
  				FROM offeR_prod op, offer_prod_2_party opp, staff_number sn, party p
				 where op.prod_id = opp.prod_id
				   and opp.party_id = sn.STAFF_ID
				   and sn.ORG_ID = p.party_id
				   and opp.party_product_rela_role_cd = '11'
				   and op.status_cd = '12'
				   and opp.status_cd = '12'
				   and op.redu_access_number =#accNbr#
			       and rownum < 2
   		]]>
   </select>
   
     <select id="getChannelNbrByChannelID" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		  SELECT a.channel_nbr FROM cms.channel a where a.channel_id = #channelId#
       			and rownum < 2
   		]]>
   </select>
     <select id="getCmsStaffCodeByStaffCode" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		  select count(*) from Cms.staff a where a.staff_code =#staffCode#
   		]]>
   </select>		
     <select id="getOfferProdReduOwnerIdByAccNbr" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		  SELECT  a.redu_owner_id
			  FROM offer_prod a
			 where a.redu_access_number =#accNbr#
			   and a.status_cd = '12'
			   and rownum<2
   		]]>
   </select>
    <select id="getSaopRuleIntfLogByTransactionID" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
	     SELECT d.ext_cust_order_id as "cust_order_id",
	           d.isale_nbr         as "ext_cust_order_id"
	      FROM saop_rule_intf_log d
	      where (d.isale_nbr = #transactionID# or d.isale_nbr = 'a'||substr(#transactionID#,2))
	       and rownum < 2
		     	]]>
   </select> 
   <!--校验号码是否可光改 -->
    <select id="validatePhoneCanChangeBand" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT op.prod_id,op.redu_prod_spec_id
		  FROM inst.offer_prod op,inst.offer_prod_status ops
		   WHERE  op.redu_prod_spec_id in ('890000050' , '9', '10')
		   and ops.prod_id = op.prod_id
		   and ops.status_cd = '12'
		   and ops.prod_status_cd = '1'
		   and op.status_cd = '12'
		   and op.redu_access_number = #accNbr#
		     	]]>
   </select> 
   <!--校验号码是否可光改 ：离散值对应接入方式 1:LAN, 4:ADSL,5:VDSL ,6:FTTB+ADSL, 7:FTTB+VDSL,8:FTTB+LAN -->
    <select id="validatePhoneCanChangeBandFTTH" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT op.redu_prod_spec_id,
                   opi.status_cd,
                   op.redu_access_number,
                   opi.value
              FROM inst.offer_prod             op,
                   ctg_inst.offer_prod_item    opi,
                   inst.offer_prod_status ops
             WHERE op.prod_id = opi.prod_id
               and op.status_cd = '12'
               and ops.prod_id = op.prod_id
               and ops.status_cd = '12'
               and ops.prod_status_cd = '1'
               and opi.status_cd = '12'
               and op.redu_prod_spec_id = '600000208'
               and opi.item_spec_id = 12389
               and opi.value in (1, 4,5 ,6, 7,8 )
               and op.redu_access_number = #accNbr#
		     	]]>
   </select>
   <!--根据主销售品查询打包关系 -->
   <select id="queryMainOfferPackageRelation" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT os1.offer_spec_id,os1.name
		  FROM spec.offer_package_2_offer_spec op2os, spec.offer_spec os,spec.offer_spec os1
		 WHERE os.offer_spec_id = op2os.offer_package_id
		   and op2os.offer_spec_id = os1.offer_spec_id
		   and os.OFFER_TYPE_CD = '1'
		   and os1.OFFER_TYPE_CD = '2'
		   and os.offer_spec_id = #offerSpecId#
		     	]]>
   </select>  
   <!-- 根据号码查询产品规格、主销售品、附属销售品订购  -->
   <select id="queryAccNbrInfoList" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT
		       distinct op.redu_prod_spec_id,
		       os.offer_spec_id,
		       os.OFFER_TYPE_CD,
		       op.prod_id
		  FROM inst.offer_prod          op,
		       ctg_inst.offer_prod_item opi,
		       inst.offer_member        om,
		       inst.offer               a,
		       spec.offer_spec          os
		 WHERE op.redu_access_number = #accNbr#
		   and opi.prod_id = op.prod_id
		   and op.prod_id = om.member_id
		   and a.offer_id = om.offer_id
		   and op.status_cd = '12'
		   and om.obj_type = 2
		   and om.status_cd = '12'
		   and a.status_cd = '12'
		   and opi.status_cd = '12'
		   and a.offer_spec_id = os.offer_spec_id
		     	]]>
   </select>  
   <!--手机光改：查询接入方式，速率 -->
   <select id="queryAccessTypeByAccessNumber" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		SELECT op.prod_id,opi.item_spec_id,opi.value,dvi.name
		  FROM inst.offer_prod op, ctg_inst.offer_prod_item opi,bss_sys.discrete_value_list dvi
		 WHERE op.prod_id = opi.prod_id
		   and dvi.item_spec_id = opi.item_spec_id
		   and op.redu_access_number = #accNbr#
		   and opi.value = dvi.meta_key_value
		   and opi.item_spec_id = #itemSpecIds#
		     	]]>
   </select>  
   <!--手机光改：查询是否存在组合标识、组合号码-->
   <select id="getProdCompList" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		select opc.prod_comp_id,
	       op.redu_prod_spec_id,
	       op.redu_access_number,
	       opc.comp_prod_id
	  from inst.offer_prod_comp opc, inst.offer_prod op
	 where op.prod_id = opc.prod_id
	   and opc.status_cd = '12'
	   and op.status_cd = '12'
	   and op.redu_access_number = #accNbr#

		     	]]>
   </select>  
   <!--手机光改：根据组合号码产品ID（compProdId）查询查询查询B号的组合号码-->
   <select id="queryCompAccNbrByCompProdId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT op.redu_access_number, op.redu_prod_spec_id, op.status_cd
		  FROM inst.offer_prod op
		 WHERE op.prod_id = #compProdId#
		   and op.status_cd = '12'
		     	]]>
   </select>  
   <!--手机光改：根据当前销售品获得速率属性及值-->
   <select id="querySpeedInfoByOfferSpecId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT dvi.meta_key_value,dvi.item_spec_id,dvi.name,dvi.value
		  FROM spec.offer_spec          os,
		       spec.offer_roles         oor,
		       spec.role_obj_2_cfg_rule ro2cr,
		       spec.cfg_rule_2_item_cfg cr2ic,
		       spec.req_item_cfg ric,
		       bss_sys.discrete_value_list  dvi
		 WHERE os.offer_spec_id = oor.offer_spec_id
		   and oor.OFFER_ROLE_ID = ro2cr.offer_role_id
		   and ro2cr.cfg_rule_id = cr2ic.cfg_rule_id
		   and ric.req_item_cfg_id = cr2ic.req_item_cfg_id
		   and dvi.item_spec_id = ric.item_spec_id
		   and dvi.meta_key_value = ric.default_value
		   and os.offer_spec_id = #offerSpecId#
		   and os.OFFER_TYPE_CD = '1'
		   and dvi.item_spec_id in(12 ,13)
		   and rownum < 2
		     	]]>
   </select>  
   <!--手机光改：根据当前销售品查询可换档的主销售品-->
   <select id="queryChangeOffersByOfferSpecId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT os.offer_spec_id           as "offerSpecId",
		       oscr.offer_spec_rela_range as "offerSpecRelaRange",
		       os.name                    as "name"
		  FROM offer_spec_change_rela oscr,
		       spec.offer_spec        os,
		       spec.offer_roles       oro,
		       spec.role_obj          rob
		 WHERE os.offer_spec_id = oscr.offer_spec_rela_range
		   and oscr.offer_spec_id = #offerSpecId#
		   and oscr.offer_spec_rela_range <> #offerSpecId#
		   and oscr.is_conflict = 'Y'
		   and os.OFFER_TYPE_CD = '1'
		   and oro.offer_spec_id = os.offer_spec_id
		   and oro.OFFER_ROLE_ID = rob.OFFER_ROLE_ID
		   and rob.OBJ_ID = '600000208'
		     	]]>
   </select>  
   <!--手机光改：判断当前销售品是否为主销售品-->
   <select id="judgeMainOfferByOfferSpecId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT os.offer_spec_id, os.OFFER_TYPE_CD
		  FROM spec.offer_spec os
		 WHERE os.OFFER_TYPE_CD = '1'
		   and os.offer_spec_id = #offerSpecId#
		     	]]>
   </select>  
   <!--手机光改：判断当前主销售品对应的产品是否为组合产品，并且获取组合产品信息-->
   <select id="queryCompInfoListByOfferSpecId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT ps.prod_spec_id, oro.offer_spec_id, os.name,os.OFFER_TYPE_CD
		  FROM spec.role_obj      rob,
		       spec.offer_roles   oro,
		       ctg_spec.prod_spec ps,
		       spec.offer_spec    os
		 WHERE oro.OFFER_ROLE_ID = rob.OFFER_ROLE_ID
		   and ps.prod_spec_id = rob.OBJ_ID
		   and os.offer_spec_id = oro.offer_spec_id
		   and ps.COMP_PROD = 'Y'
		   and os.OFFER_TYPE_CD = '1'
		   and oro.offer_spec_id = #offerSpecId#
		     	]]>
   </select>  
   <!--手机光改：如果是组合产品则根据当前产品查询该产品对应的所有主销售品（除当前主销售品外）-->
   <select id="queryCompMainOfferByProdSpecId" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		SELECT oro.offer_spec_id as "offerSpecId", os.name as "name"
		  FROM spec.role_obj      rob,
		       spec.offer_roles   oro,
		       ctg_spec.prod_spec ps,
		       spec.offer_spec    os
		 WHERE oro.OFFER_ROLE_ID = rob.OFFER_ROLE_ID
		   and ps.prod_spec_id = rob.OBJ_ID
		   and os.offer_spec_id = oro.offer_spec_id
		   and ps.COMP_PROD = 'Y'
		   and ps.prod_spec_id = #prodSpecId#
		   and os.OFFER_TYPE_CD = '1'
		   and os.offer_spec_id <> #offerSpecId#
		     	]]>
   </select>  
   <!--全业务流程：如果是组合产品则根据当前产品查询该产品对应的所有主销售品（除当前主销售品外）-->
   <select id="getProdInfoByAccessNuber" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		SELECT op.prod_id as "prodId",op.redu_access_number as "accessNumber"
			  FROM inst.offer_prod op,
			       so.bo_prod_an   bpa,
			       so.order_list   ol,
			       busi_order      bo
			 WHERE ol.ol_id = bo.ol_id
			   and bo.bo_id = bpa.bo_id
			   and op.redu_access_number = bpa.access_number
			   and ol.ol_id = #olId#
			   and rownum<2
		     	]]>
   </select>  
   <!--客服2.0项目需求:根据销售品id查询服务Id-->
   <select id="getServInfoByOfferSpecId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		  select ro.obj_id,ors.OFFER_ROLE_ID,ors.offer_spec_id
			  from spec.offer_roles ors, spec.role_obj ro
			 WHERE ors.OFFER_ROLE_ID = ro.OFFER_ROLE_ID
			   and ro.OBJ_TYPE = 4
			   and ors.offer_spec_id = #offerSpecId#
			   and rownum<2
		     	]]>
   </select>  
   <!--全业务流程：如果是组合产品则根据当前产品查询该产品对应的所有主销售品（除当前主销售品外）-->
   <select id="getComBasicInfoByOfferSpecId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select c.item_spec_id as "itemSpecId",c.name as "name"
				 from crm_app.offer_spec a,crm_app.offer_spec_param b,crm_app.item_spec c
				where a.offer_spec_id=b.offer_spec_id
				and b.item_spec_id=c.item_spec_id
				and c.name like '%折扣%' 
			    and a.offer_spec_id = #offerSpecId#
		     	]]>
   </select>  
   <select id="queryStaffIdByStaffCode" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		  select sn.staff_id from staff_number sn where sn.staff_number = #staffCdoe:VARCHAR#
   		]]>
   </select>
   <select id="getMethForFtth" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[	
		
		select o.offer_id, o.offer_spec_id, op.redu_prod_spec_id 
		  from offer_prod op, offer_member om, offer o, offer_spec os
		 where op.prod_id = om.member_id
		   and om.offer_id = o.offer_id
		   and o.offer_spec_id = os.offer_spec_id
		   and os.OFFER_TYPE_CD = '1'
		   and op.status_cd = '12'
		   and op.prod_id = #prodId:VARCHAR#
		   and rownum < 2   
       ]]>
	</select>
   <select id="getProValue" resultClass="java.lang.String" parameterClass="java.lang.String">
		<![CDATA[
		select p.value from offer_prod_item p
			where p.prod_id =#prodId:VARCHAR#
			and p.item_spec_id = '12389'
			and p.status_cd in (10,11,12,13,20)
			and rownum < 2  
   		]]>
   </select>
    <select id="getaddresForFtth" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[	
		 select pa.address_id,pa.address_desc,pa.reason_cd,pa.area_id
          from inst.OFFER_PROD_2_ADDR pa
         where pa.prod_id =#prodId:VARCHAR#
           and pa.status_cd = '12'
           and rownum < 2 
       ]]>
	</select>
    <select id="getTmlForFtth" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		<![CDATA[	
		  select ofe.tml_id,ofe.reason_cd,tm.name 
		  from OFFER_PROD_2_TML ofe, tml tm
		 where prod_id =#prodId:VARCHAR#
		   and ofe.tml_id = tm.tml_id
           and rownum < 2   
       ]]>
	</select>
	<select id="checkIsSchool" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
		select a.channel_id,
       (select b.attr_value_name
          from cms.attr_value b
         where b.attr_id = '50000031'
	           and b.attr_value = a.attr_value) as schoolname
			  from cms.channel_attr a
			 where a.attr_id = '50000031'
			   and a.attr_value = '10'
			   and a.channel_id = #channelId#
		     	]]>
   </select>
   
   <select id="queryExchangeByName" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT t.tml_id, t.name, t.description
  			FROM rm.tml t
 			WHERE t.name LIKE '%' || #name# || '%'
 			and rownum < 21
		     	]]>
   </select>
   <select id="getchannelByCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select (select c2s.channel_id
		         from crm_app.channel_2_store c2s
		         where c2s.store_id = a.mkt_res_store_id
		         and rownum = 1) as channel_id,
		           c.charge_item_cd
			  from sr.mkt_res_inst      a,
			       sr.mkt_resource_type b,
			       sr.material_kind     c,
			       sr.mkt_resource      d
			 where a.mkt_res_id = d.mkt_res_id
			   and d.mkt_res_type_id = b.mkt_res_type_id
			   and b.mkt_res_type_cd = c.material_kind_id
			   and a.mkt_res_inst_code = #code#
			   and rownum < 2
		     	]]>
   </select>
   <select id="queryDeptInfo" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT level,
		       o.org_id,
		       o.parent_org_id,
		       p.Name,
		       (select p2.Name from sm.party p2 where p2.party_id = o.parent_org_id) as parName
			  FROM SM.ORGANIZATION O, sm.PARTY P
			 where O.ORG_ID = P.party_id
			   AND P.Name LIKE '%' || #name# || '%'
			   ]]>
			   <isNotEmpty property="level" prepend="AND">
		     	<![CDATA[
		     	  level = #level#
		     	  ]]>
		     	</isNotEmpty>
		     	<![CDATA[
			 start with O.Org_Id = '1'
			connect by prior o.org_id = o.parent_org_id
			
		     	]]>
   </select>
   <select id="getOlidByg" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT o.ol_id, o.item_spec_id, o.value
			  FROM order_list_attr O
			 WHERE O.ITEM_SPEC_ID = '201639'
			   AND O.VALUE = #olId#
			   and rownum < 2
			
		     	]]>
   </select>
   <select id="getOlnbrByg" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select OL_NBR from order_list O 
			WHERE O.ol_id = #olId#
			   and rownum < 2
			
		     	]]>
   </select>
   <select id="getValueByolId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT o.ol_id, o.item_spec_id, o.value
		        FROM order_list_attr O
		       WHERE O.ITEM_SPEC_ID = '201638'
		         AND O.OL_ID= #olId#
		         and rownum < 2
			
		     	]]>
   </select>
   <select id="queryChannelsByMap" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT C.CHANNEL_ID AS "channelId",
             C.NAME AS "name",
             C.MANAGE_CODE AS "channelManageCode"
		        FROM PARTY P,
		             PARTY_2_CHANNEL P2C,
		             CHANNEL C,
		             PARTY_2_CHANNEL_ROLE P2CR
		       WHERE P.PARTY_ID = P2C.PARTY_ID
		         AND C.CHANNEL_ID = P2C.CHANNEL_ID
		         AND P2CR.PARTY_2_CHANNEL_ROLE_CD = P2C.PARTY_CHANNEL_RELA_ROLE_CD
		         AND P2CR.PARTY_2_CHANNEL_ROLE_CD = '1'
		         AND C.CHANNEL_STATUS_CD = '1'
		         AND C.Channel_Spec_Id = '60'
		         AND P.PARTY_ID = #staffId#
			
		     	]]>
   </select>
   
   <select id="checkCinfoByb" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
				select a.redu_access_number as b_code,
				       a.prod_id,
				       c.redu_access_number as c_code,
				       c.redu_prod_spec_id,
				       ps.name as prodName,
				       c.prod_id as c_pro_id,
				       o.offer_id,
				       o.offer_spec_id,
				       os.name as offerName
				  from inst.offer_prod      a,
				       inst.offer_prod_comp b,
				       inst.offer_prod      c,
				       inst.offer_member    om,
				       inst.offer           o,
				       spec.offer_spec      os,
				       prod.prod_spec       ps
				 where a.redu_access_number = #code#
				   and a.status_cd = 12
				   and b.prod_id = a.prod_id
				   and c.prod_id = b.comp_prod_id
				   and ps.prod_spec_id = c.redu_prod_spec_id
				   and b.prod_comp_rela_role_cd = 249
				   and b.status_cd = 12
				   and om.member_id = b.comp_prod_id
				   and o.offer_id = om.offer_id
				   and o.status_cd = 12
				   and os.offer_spec_id = o.offer_spec_id
				   and os.OFFER_TYPE_CD = 1
				   and rownum < 2
		     	]]>
   </select>
   
   <select id="queryDetailedIndicatorsList" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			  select * from(select a.*,ROWNUM rn from (
			  select p.Name, o.redu_access_number,o.begin_dt
			  from REAL_TIME_STATISTICS        r,
			       offer_prod                  o,
			       REAL_TIME_STATISTICS_DETAIL d,
			       party                       p
			   where r.id = d.real_time_statistics_id
			   and d.prod_id = o.prod_id
			   and o.redu_owner_id = p.party_id
			   and r.staff_id = #staffId#
         	   and r.statistics_date = to_date(#statisticalTime#, 'yyyy-MM-dd') 
			   ]]>
			   <isNotEmpty property="accessNumber" prepend="AND">
		     	<![CDATA[
		     	  o.redu_access_number = #accessNumber#
		     	  ]]>
		     	</isNotEmpty>
		     	<![CDATA[
				) a where ROWNUM<=#endRown#) where rn>=#startRown#
		     	]]>
		     	
   </select>
   
   <select id="queryDetailedIndicatorsListMouth" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select * from(select a.*,ROWNUM rn from (
			select p.Name, o.redu_access_number,o.begin_dt
			  from REAL_TIME_STATISTICS        r,
			       offer_prod                  o,
			       REAL_TIME_STATISTICS_DETAIL d,
			       party                       p
			 where r.id = d.real_time_statistics_id
			   and d.prod_id = o.prod_id
			   and o.redu_owner_id = p.party_id
			   and r.staff_id = #staffId#
			   and r.statistics_date between
       		  to_date(#startTime#, 'yyyy-MM-dd') and to_date(#endTime#, 'yyyy-MM-dd')
       		  ]]>
			   <isNotEmpty property="accessNumber" prepend="AND">
		     	<![CDATA[
		     	  o.redu_access_number = #accessNumber#
		     	  ]]>
		     	</isNotEmpty>
		     	<![CDATA[
			) a where ROWNUM<=#endRown#) where rn>=#startRown#
		     	 ]]>
		     	
   </select> 
     
    <select id="queryIndicatorsNumber" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		
			select count(*) as numbers from (
			select p.Name, o.redu_access_number,o.begin_dt
			from REAL_TIME_STATISTICS        r,
				 offer_prod                  o,
				 REAL_TIME_STATISTICS_DETAIL d,
			     party                       p
				 where r.id = d.real_time_statistics_id
				 and d.prod_id = o.prod_id
				 and o.redu_owner_id = p.party_id
				 and r.staff_id = #staffId#
         	   and r.statistics_date = to_date(#statisticalTime#, 'yyyy-MM-dd') 
			   ]]>
			   <isNotEmpty property="accessNumber" prepend="AND">
		     	<![CDATA[
		     	  o.redu_access_number = #accessNumber#
		     	  ]]>
		     	</isNotEmpty>
		     	<![CDATA[
		     	) 

     ]]>
   </select>
   
   
   <select id="queryIndicatorsNumberMouth" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		
			select count(*) as numbers from (
			select p.Name, o.redu_access_number,o.begin_dt
			from REAL_TIME_STATISTICS        r,
				 offer_prod                  o,
				 REAL_TIME_STATISTICS_DETAIL d,
			     party                       p
				 where r.id = d.real_time_statistics_id
				 and d.prod_id = o.prod_id
				 and o.redu_owner_id = p.party_id
				 and r.staff_id = #staffId#
         	   and r.statistics_date between
       		  to_date(#startTime#, 'yyyy-MM-dd') and to_date(#endTime#, 'yyyy-MM-dd') 
			   ]]>
			   <isNotEmpty property="accessNumber" prepend="AND">
		     	<![CDATA[
		     	  o.redu_access_number = #accessNumber#
		     	  ]]>
		     	</isNotEmpty>
		     	<![CDATA[
		     	) 

     ]]>
   </select>
   
   <select id="queryIndicators5" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		
			select sum(r.STATISTICS_NUM) as total from REAL_TIME_STATISTICS r where 
			r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd') and r.staff_id =  #staffId#
			and r.PROD_SPEC_ID in(9,10,20130060,600000208,600000209,890000050) 
			and r.STATISTICS_TYPE= 1
		     	]]>
   </select>
   <select id="queryIndicators6" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		
			select sum(r.STATISTICS_NUM) as total from REAL_TIME_STATISTICS r where 
			r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd') and r.staff_id =  #staffId#
			and r.PROD_SPEC_ID in(9,10,20130060,600000208,600000209,890000050) 
			and r.STATISTICS_TYPE= 2
			
		     	]]>
   </select>
   
   <select id="queryIndicators7" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select STATISTICS_NUM
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and r.PROD_SPEC_ID = 600000293
			 and r.STATISTICS_TYPE = 1
		     	]]>
   </select>
   
   <select id="queryIndicators8" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select STATISTICS_NUM
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and r.PROD_SPEC_ID = 600000293
			 and r.STATISTICS_TYPE = 2
		     	]]>
   </select>
   
   <select id="queryIndicators1" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select STATISTICS_NUM
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and r.PROD_SPEC_ID = 378
			 and r.STATISTICS_TYPE = 1
		     	]]>
   </select>
   <select id="queryIndicators2" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select STATISTICS_NUM
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and r.PROD_SPEC_ID = 378
			 and r.STATISTICS_TYPE = 2
		     	]]>
   </select>
   <select id="queryIndicators3" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select STATISTICS_NUM
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and r.PROD_SPEC_ID = 379
			 and r.STATISTICS_TYPE = 1
		     	]]>
   </select>
   <select id="queryIndicators4" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select STATISTICS_NUM
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and r.PROD_SPEC_ID = 379
			 and r.STATISTICS_TYPE = 2
		     	]]>
   </select>
   <select id="queryIndicators9" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select STATISTICS_NUM
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and r.PROD_SPEC_ID = 378
			 and r.STATISTICS_TYPE = 5
		     	]]>
   </select>
   
   <select id="queryIndicators10" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select sum(STATISTICS_NUM) as total
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and  r.STATISTICS_TYPE = 7
		     	]]>
   </select>
   
   <select id="queryIndicators11" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select sum(STATISTICS_NUM) as total
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#statisticalTime# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
			 and  r.STATISTICS_TYPE = 8
		     	]]>
   </select>
   
   <select id="queryIndicatorsList" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			select *
			  from REAL_TIME_STATISTICS r
			 where r.statistics_date = to_date(#time# , 'yyyy-MM-dd')
			 and  r.staff_id =  #staffId#
		     	]]>
   </select>
   <select id="queryIndicatorsListMouth" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT *
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
		     	]]>
   </select>  
   <select id="queryIndicatorsMouth1" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID = 378
			       and r.STATISTICS_TYPE = 1
		     	]]>
   </select> 
   <select id="queryIndicatorsMouth2" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID = 378
			       and r.STATISTICS_TYPE = 2
		     	]]>
   </select> 
   <select id="queryIndicatorsMouth3" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID = 379
			       and r.STATISTICS_TYPE = 1
		     	]]>
   </select> 
   <select id="queryIndicatorsMouth4" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID = 379
			       and r.STATISTICS_TYPE = 2
		     	]]>
   </select> 
   <select id="queryIndicatorsMouth5" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID in(9,10,20130060,600000208,600000209,890000050)
			       and r.STATISTICS_TYPE = 1
		     	]]>
   </select> 
   <select id="queryIndicatorsMouth6" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID in(9,10,20130060,600000208,600000209,890000050)
			       and r.STATISTICS_TYPE = 2
		     	]]>
   </select>
   
   <select id="queryIndicatorsMouth7" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID = 600000293
			       and r.STATISTICS_TYPE = 1
		     	]]>
   </select>
   
   <select id="queryIndicatorsMouth8" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID = 600000293
			       and r.STATISTICS_TYPE = 2
		     	]]>
   </select>
   
   <select id="queryIndicatorsMouth9" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
		
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.PROD_SPEC_ID = 378
			       and r.STATISTICS_TYPE = 5
		]]>
   </select> 
   <select id="queryIndicatorsMouth10" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.STATISTICS_TYPE = 7
		]]>
   </select> 
   <select id="queryIndicatorsMouth11" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		<![CDATA[
			SELECT sum(STATISTICS_NUM) as total
			  FROM REAL_TIME_STATISTICS r
			 where r.statistics_date between to_date(#startTime#, 'yyyy-MM-dd') and
			       to_date(#endTime#, 'yyyy-MM-dd')
			       and  r.staff_id =  #staffId#
			       and r.STATISTICS_TYPE = 8
		]]>
   </select> 
   <select id="queryIndicatorsMouth12" resultClass="java.util.HashMap" parameterClass="String">
		<![CDATA[
	   		SELECT count(*) as total FROM REAL_TIME_STATISTICS_IN_TIME t where to_char(#statisticalTime#, 'yyyy-mm')=to_char(t.end_dt, 'yyyy-mm')
		]]>
   </select> 
   <select id='getAddressPreemptedSeq' resultClass='java.util.HashMap'>
		select CRM_APP.SEQ_RMADDR_NBR.Nextval  from dual
   </select>
   <select id='showSchoolName' resultClass='java.util.HashMap' parameterClass="String">
    <![CDATA[
		select b.name
		  from store_detail a, coupon b
		 where a.MATERIAL_ID = b.coupon_id
		   and a.BCD_CODE = #bcdCode#
		    and rownum < 2
	]]>
   </select>
   <select id='qryDeptById' resultClass='java.util.HashMap' parameterClass="String">
   <![CDATA[
		select p.party_id      as dept_id,
               p.Name          as dept_name,
               o.parent_org_id as parent_dept_id,
               m.name          as parent_dept_name
        
          from SM.ORGANIZATION o, sm.party m, sm.party p
         where o.org_id = p.party_id
           and o.parent_org_id = m.party_id(+)
           and p.party_id = #dept_id#
           and rownum < 2
           ]]>
   </select>
   <select id='campusCustomerCampusMark' resultClass='java.util.HashMap' parameterClass="java.util.HashMap">
   <![CDATA[
		select item_spec_id,subject_id,subject_name from  PROD.ITEM_SPEC_BASE_INFO BI 
		where BI.ITEM_SPEC_ID=13380379
           ]]>
    <isNotEmpty property="subjectId" prepend="AND"> 
   <![CDATA[ 
        BI.subject_id = #subjectId#
   ]]>
    </isNotEmpty>    
    <isNotEmpty property="subjectNameId" prepend="AND"> 
   <![CDATA[ 
   	    BI.subject_name like '%' || #subjectNameId# || '%'
   ]]>
    </isNotEmpty> 
    order by subject_id
   </select>
   <select id='queryCampusCustomerInformation' resultClass='java.util.HashMap' parameterClass="java.util.HashMap">
		<![CDATA[ 
		SELECT op.prod_id,op.redu_owner_id,op.redu_acct_id,p.NAME,op2t.terminal_code,op.redu_access_number 
 		FROM crm_app.offer_prod op,crm_app.party p,inst.offer_prod_2_td op2t 
 		WHERE op.redu_owner_id  = p.party_id 
 		AND op.prod_id  = op2t.prod_id 
 		AND op2t.status_cd = 12
		 ]]>
		 <isEqual property="len" compareValue="11" prepend="AND">
		 <![CDATA[
		 op.redu_access_number = #num#
		 ]]>
		 </isEqual>
		 <isNotEqual property="len" compareValue="11" prepend="AND">
		 <![CDATA[
		 op2t.terminal_code = #num#
		 ]]>
		 </isNotEqual>
   </select>
   
   <insert id='saveSendRecord' parameterClass='java.util.HashMap'>
   <![CDATA[
		INSERT INTO INTF.send_record(ID,INFO,SEND_TIME,SYSTEM_CODE,CODE,OPERATION_CODE) 
		VALUES (#uuid#, #results#, TO_DATE(#date#,'yyyy-mm-dd hh24:mi:ss'),#systemId#,#olNbr#,#SoAutoService#)
		]]>
     </insert>
     
   <select id='qryKeyByFlag' resultClass='java.util.HashMap'>
   		<![CDATA[
		select f.KEYVALUE from intf.intf_config f where f.keyflag ='processes'
		]]>
   </select>
   <select id='queryRewardSum' resultClass='java.util.HashMap'>
		<![CDATA[
			 select count(r.reward_id) AS SUM
			   from reward_record R, staff_number n, staff_info i
			  WHERE R.STAFF_ID =#staffId#
			    AND R.STAFF_ID = N.STAFF_ID
			    AND N.STAFF_NUMBER = I.STAFF_NUMBER
			    AND r.so_date between to_date(#stardTime#, 'yyyy-MM-dd') and
			        to_date(#endTime#, 'yyyy-MM-dd')
		]]>
   </select>
   <select id='queryRewardInfoById' resultClass='java.util.HashMap'>
		<![CDATA[
			select *
			  from (select a.*, ROWNUM rn
			          from (select r.reward_id,
			                       r.so_date,
			                       r.staff_id,
			                       i.staff_name,
			                       r.reward_amount
			                  from reward_record R, staff_number n, staff_info i
			                 WHERE R.STAFF_ID =#staffId# 
			                   AND R.STAFF_ID = N.STAFF_ID
			                   AND N.STAFF_NUMBER = I.STAFF_NUMBER
			                   AND r.so_date between to_date(#stardTime#, 'yyyy-MM-dd') and
			                       to_date(#endTime#, 'yyyy-MM-dd')
			                 order by r.so_date asc) a
			         where ROWNUM <= #endNum#)
			 where rn > #startNum#
		]]>
   </select>
   <select id='queryRewardInfo' resultClass='java.util.HashMap'>
		<![CDATA[
			 select r.reward_id, r.ol_nbr, o.redu_access_number, t.Name
			  from reward_record r, prod_order p, offer_prod o, party t
			 where r.reward_id = #rewardId#
			   and p.bo_id = r.bo_id
			   and o.prod_id = p.prod_id
			   and o.redu_owner_id = t.party_id
			   and rownum < 2
		]]>
   </select>
   <select id='querypartyListBypartyList' resultClass='java.util.HashMap'>
		<![CDATA[
			select p.redu_owner_id as partyId,
			       p.prod_id as prodId,
			       p.redu_access_number accessNumber,
			       p.redu_prod_spec_id prodSpec,
			       B.PARTY_NAME
			  from crm_app.offer_prod p, crm_app.party_identity a, CTG_INST.PARTY B
			 where a.identidies_type_cd = '1'
			   AND A.party_id = B.PARTY_ID
			   and p.redu_owner_id = a.party_id
			   and a.identity_num = #idCard#
			   and p.status_cd='12'
		]]>
   </select>
   <select id='queryProListByProId' resultClass='java.util.HashMap'>
		<![CDATA[
			select * from CRM_APP.OFFER_SERV A,CRM_APP.OFFER_PROD_2_TD T
			where a.serv_spec_id in ( '20130028','20149015')
			and a.prod_id =#prodId#
			and T.PROD_ID = #prodId#
			AND t.terminal_code like '89860%'
			and a.status_cd = '12'
      		and t.status_cd = '12'
		]]>
   </select>
   <select id='queryOlidByProId' resultClass='java.util.HashMap'>
		<![CDATA[
			select /*+PARALLEL(A,10)*/
			 a.prod_id, B.ol_id
			  from so.prod_order a, so.busi_order b
				 where 1 = 1
			   and a.state = 'ADD'
			   and a.bo_id = b.bo_id
			   and b.bo_action_type_cd = '1'
			   and a.prod_id = #prodId#
			   and b.status_cd = 'C'
			   and rownum < 2
		]]>
   </select>
   <select id='queryOrganizationforScrm' resultClass='java.util.HashMap'>
		<![CDATA[
			SELECT  distinct sn.STAFF_ID as staffId, sn.STAFF_NUMBER as staffNumber,
			 si.staff_name as staffName, m.name as organizationName, p.name,m.party_id as pOrganizationName
			  FROM sm.ORGANIZATION O,
			       sm.post_role pr,
			       sm.party_2_post_role ppr,
			       sm.party m,
			       sm.party p,
			       sm.staff_number sn,
			       (SELECT distinct  o.*
			          from sm.ORGANIZATION O
			         START WITH o.ORG_ID = #organizationId#
			        CONNECT BY o.parent_org_id = PRIOR o.ORG_ID) mq,
			       crm_app.staff_info si
			 where pr.post_role_id = ppr.post_role_id
			   and sn.ORG_ID = o.ORG_ID
			   and sn.ORG_ID = mq.org_id
			   and sn.STAFF_NUMBER = si.staff_number
			   and m.party_id = o.org_id
			   and p.party_id = o.parent_org_id
			   and sn.staff_status_cd = '1'
			   and  ppr.post_role_id = #ruleNumber#
		]]>
		<isNotEmpty property="staffNumber" prepend="AND"> 
		   <![CDATA[ 
		         sn.STAFF_ID= #staffNumber#
		   ]]>
    	</isNotEmpty>    
		<isNotEmpty property="staffName" prepend="AND"> 
		   <![CDATA[ 
		        si.staff_name =#staffName#
		   ]]>
    	</isNotEmpty>    
   </select>
   <select id="querychargeByOlId" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT sum(CHARGE)AS CHARGE FROM crm_app.unitypay_interface a where a.ol_id = #olIdStr#  and   <![CDATA[rownum <2]]>
   </select>
   
   <select id="queryBoActionTypeSum" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		select  * FROM so.busi_order b   where b.bo_action_type_cd = '1'AND B.ol_id = #ol_id#
   </select>
   <select id="queryUimCodeByAccessNumber" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select a.terminal_code from crm_app.offer_prod_2_td a
			where a.prod_id=(select a.prod_id from crm_app.offer_prod a
			where a.redu_access_number=#accessNumber#
			and a.status_cd='12')
			and a.status_cd='12'
		]]>
   </select>
   <select id="queryOlIdByAccessNumber" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select distinct c.ol_id 
 			from crm_app.offer_member a,crm_app.offer_order b,crm_app.busi_order c
			where a.member_id in
			(select a.prod_id from crm_app.offer_prod a
			where a.redu_access_number=#accessNumber#
			and a.status_cd='12')
			and a.offer_id=b.offer_id  
			and b.bo_id=c.bo_id
			and c.bo_action_type_cd in ('1','S1')
			and c.archive_dt>sysdate-30
			union
			select distinct  c.ol_id 
 			from so.prod_order b,crm_app.busi_order c
			where b.prod_id in
			(select a.prod_id from crm_app.offer_prod a
			where a.redu_access_number=#accessNumber#
			and a.status_cd='12')
			and b.bo_id=c.bo_id
			and c.bo_action_type_cd in ('1','S1')
			and c.archive_dt>sysdate-30
		]]>
   </select>
   <select id="queryOlNbrByOlId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select ol_nbr from so.order_list a where a.ol_id = #id#
		]]>
   </select>
   
   <select id="queryRewardSource" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select a.reward_source from reward_record a where a.ol_nbr = #olNbr#
		]]>
   </select>
   
   <select id="queryRewardId" resultClass="java.lang.String">
		<![CDATA[
			SELECT crm_app.seq_reward_record_id.nextval FROM dual
		]]>
   </select>
   
   <insert id="insertReward" parameterClass="java.util.HashMap">
		INSERT INTO
		reward_record(REWARD_ID,OL_NBR,STAFF_ID,SO_DATE,REWARD_AMOUNT,CREATE_DT,REWARD_SOURCE,BEST_PAY_ACCOUNT)
		VALUES(#rewardId#,#olNbr#,#staffId#,TO_DATE(#soDate#,'yyyy-mm-dd hh24:mi:ss'),#rewardAmount#,TO_DATE(#Date#,'yyyy-mm-dd hh24:mi:ss'),#rewardSource#,#bestPayAccount#)
    </insert>
    
    <select id="queryStoreByStaffId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select sn.staff_id,ch.channel_id,c2s.store_id
			from sm.staff_number sn,crm.channel ch,crm.channel_2_store c2s
			where sn.STAFF_ID= #staffId# and sn.ORG_ID=ch.manage_code
			and ch.channel_id=c2s.channel_id
			and rownum < 2
		]]>
   </select>
   
   <select id="queryStatusByInstCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select mri.mkt_res_inst_code,
       		mri.mkt_res_store_id,
       		mri.status_cd,
       		cs.status_name
  			from sr.mkt_res_inst mri, sr.COUPON_STATUS cs
 			where mri.mkt_res_inst_code = #mktResInstCode#
   			and mri.status_cd = cs.standard_status_cd
   			and rownum < 2
		]]>
   </select>
   
   <select id="getStaffIdBystaffNumber" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select a.staff_id from crm_app.staff_info_yzf a where a.staff_number = #staffNumber#
		]]>
   </select>
   <insert id="insertFingerInfo" parameterClass="java.util.HashMap">
		INSERT INTO
		finger_photo_cut(OL_ID,BO_ID,BO_ACTION_TYPE_ID,STAFF_ID,PARTY_ID,PHOTO_CUT,CREAT_DT)
		VALUES(#OL_ID#,#BO_ID#,#BO_ACTION_TYPE_CD#,#STAFF_ID#,#PARTY_ID#,#PHOTO_CUT#，TO_DATE(#CREAT_DT#,'yyyy-mm-dd hh24:mi:ss'))
   </insert>
   <select id="getFingerInfo" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT 
			   BO.OL_ID,
			   BO.bo_id,
		       BO.party_id,
		       BO.staff_id,
		       BO.bo_action_type_cd,
		       BO.status_dt
		  FROM busi_order BO, so.bo_cust_info a
		 where a.bo_id = bo.bo_id
		   and bo.status_cd = 'C'
		   and bo.bo_action_type_cd = 'C1'
		   and bo.ol_id = #olId#
		]]>
   </select>
   <select id="getEdidInfo" resultClass="java.util.HashMap">
		<![CDATA[
			SELECT * FROM WEIHU.tmp_fatty_kdtz a  where a.state = '0' and a.status_cd = '12' 
			 and rownum < 500
		]]>
   </select>
   <update id="edidType" parameterClass="java.lang.String">
   		<![CDATA[
			update WEIHU.tmp_fatty_kdtz a
       set a.state = 1
     WHERE a.redu_access_number = #partyId#
		]]>
     </update>
     
    <select id="queryIdentityInfoByOlnbr" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT b.party_name, a.identity_num,o.ol_id
			  FROM crm_app.party_identity a, CTG_INST.PARTY B, order_list o
			  WHERE A.party_id = B.PARTY_ID
			    and a.identidies_type_cd = '1'
			    AND A.party_id = o.party_id
			    and o.ol_nbr = #olNbr#
			    AND ROWNUM < 2
		]]>
   </select>
    <select id="queryProdInfoByaccNum" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select op.PROD_ID,
		       op.REDU_PROD_SPEC_ID,
		       op.REDU_OWNER_ID,
		       op.REDU_ACCESS_NUMBER
		  from OFFER_PROD op
		 where op.STATUS_CD in (10, 11, 12, 13, 20)
		   and op.redu_access_number = #accNum#
			    AND ROWNUM < 2
		]]>
   </select>
   <select id="queryProdInfoByAccs" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select op.PROD_ID,
       			op.REDU_PROD_SPEC_ID,
       			op.REDU_OWNER_ID,
       			op.REDU_ACCESS_NUMBER
  			from OFFER_PROD op
 				where op.STATUS_CD in (10, 11, 12, 13, 20)
   					AND OP.redu_access_number = #accessNumber#
			   	    AND ROWNUM < 2
		]]>
   </select>
   <select id="queryDepinfoForScrm" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT C.CHANNEL_ID AS "channelId", 
				C.NAME AS "name", 
				C.MANAGE_CODE AS "channelManageCode", 
				C.CHANNEL_SPEC_ID AS "channelSpecId" 
				FROM PARTY P, 
				PARTY_2_CHANNEL P2C, 
				CHANNEL C, 
				PARTY_2_CHANNEL_ROLE P2CR 
				WHERE P.PARTY_ID = P2C.PARTY_ID 
				AND C.CHANNEL_ID = P2C.CHANNEL_ID 
				AND P2CR.PARTY_2_CHANNEL_ROLE_CD = P2C.PARTY_CHANNEL_RELA_ROLE_CD 
				AND P2CR.PARTY_2_CHANNEL_ROLE_CD = 1 
				AND C.CHANNEL_STATUS_CD = 1 
				AND P.PARTY_ID = #partyId#
		]]>
   </select>
   <select id="queryUserdByAccess" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select p.party_id, p.Name,p.DEFAULT_ID_TYPE , i.IDENTITY_NUM
			   from party p, inst.offer_prod_2_user u, offer_prod o,crm_app.party_identity i
				 where u.prod_id = o.prod_id
				   and o.status_cd = '12'
				   and u.status_cd = '12'
				   and p.party_id = u.party_id
				   and p.party_id = i.party_id
				   and i.identidies_type_cd  = p.DEFAULT_ID_TYPE
				   and o.redu_access_number = #accessNuber#
				   AND ROWNUM < 2
		]]>
   </select>
   <select id="queryExtCustOrder" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT count(id) AS count
				FROM crm_center.dep_trans_msg d
			 	where d.ext_cust_order_id like  #queryExtCustOrder# || '%'
		]]>
   </select>
   <select id="queryPhoneNoByAliUid" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select op.redu_access_number
			  from ctg_inst.prod_inst_attr pia, inst.offer_prod op
			 where pia.attr_id in ('2017912')
			   and op.prod_id = pia.prod_inst_id
			   and pia.item_status_cd = 12
			   and op.status_cd = 12
			   and pia.attr_value = #accessNumber#
			   and rownum < 10
		]]>
   </select>
   <select id="getParentOrgId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select o.parent_org_id
			  from sm.party p, sm.organization o
			 where p.mail_address_id = #mailAddressId#
			   and p.party_id = o.org_id
			   and rownum < 2
		]]>
   </select>
   <select id="selectByNameAndPic" resultMap="ResultMapWithBLOBs" parameterClass="com.linkage.bss.crm.model.LogIdentityCheckGzt" >
    SELECT ID, 
           IDENTITY_NUMBER, 
           PARTY_NAME, 
           RESULT, 
           CREATE_DT, 
           CHANNEL_ID, 
           RETURN_MSG
      FROM LOG_IDENTITY_CHECK_GZT
     WHERE IDENTITY_NUMBER = #identityNumber:VARCHAR#
       <dynamic>
       		<isNotNull prepend="and" property="partyName">
       		PARTY_NAME = #partyName:VARCHAR#
       		</isNotNull>
       </dynamic>
       <![CDATA[ 
       AND RESULT = 0
       AND TO_CHAR(CREATE_DT, 'YYYY-MM-DD HH24:MI:SS') >
       TO_CHAR((SYSDATE - 365), 'YYYY-MM-DD HH24:MI:SS') AND  ROWNUM <2
        ]]>
  </select>
  <update id="upStarMember" parameterClass="java.util.HashMap">
		UPDATE club_member c  SET c.membership_level =#memberShipLevel#,
		   c.eff_date = TO_DATE(#effDate#,'yyyy-mm-dd hh24:mi:ss'),
		   c.exp_date = TO_DATE(#expDate#,'yyyy-mm-dd hh24:mi:ss'),
		   c.rate_method =#rateMethod#
		WHERE c.cust_id = #custId#
   </update>
   <select id="queryCaflagByOlnbr" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select a.col_nbr,a.ca_flag,b.ca_name,b.ca_type
				 from so.cust_order_list a, CRM_APP.CA_FLAG_CONFIG b
				where a.ca_flag=b.ca_flag
				and a.col_nbr=#olNbr#
				and rownum < 2

		]]>
   </select>
   <insert id="insertPartyFlagInfo" parameterClass="java.util.HashMap">
		INSERT INTO
		party_profile(PARTY_ID,PARTY_PROFILE_CATG_CD,PROFILE_VALUE,VERSION)
		VALUES(#PARTY_ID#,#PARTY_PROFILE_CATG_CD#,#PROFILE_VALUE#,TO_DATE(#CREAT_DT#,'yyyy-mm-dd hh24:mi:ss'))
    </insert>
   <select id="queryBlocOlidToProOlid" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT *
			  FROM ORDER_LIST_ATTR OLA
			 WHERE OLA.ITEM_SPEC_ID = '201639'
			   AND OLA.VALUE = #olId#
			   and exists (select *
			          from order_list ol
			         where ol.status_cd = 'D'
			           and ol.ol_id = OLA.OL_ID)
			   and exists (select *
			          from busi_order bo
			         where bo.ol_id = OLA.OL_ID
			           and bo.bo_action_type_cd = '1')
		]]>
   </select>
   <select id="queryBlocOlidToProOlNbr" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT *
			  FROM ORDER_LIST_ATTR OLA
			 WHERE OLA.ITEM_SPEC_ID = '201638'
			   AND OLA.VALUE = #olId#
			   and exists (select *
			          from order_list ol
			         where ol.status_cd = 'C'
			           and ol.ol_id = OLA.OL_ID)
			   and exists (select *
			          from busi_order bo
			         where bo.ol_id = OLA.OL_ID
			           and bo.bo_action_type_cd = '1')
		]]>
   </select>
   <select id="queryBlocOlidToBlocOlNbr" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select ol.ol_id from ORDER_list ol where ol.ol_nbr = #olNbr#
		]]>
   </select>
   
   <insert id="InsertOutskirts" parameterClass="java.util.HashMap">
   <![CDATA[
		INSERT INTO finger_photo_cut
		  (OL_ID, STAFF_ID, PARTY_ID, PHOTO_CUT, CREAT_DT)
		VALUES
		  (#olId#,
		   (select SN.STAFF_ID from staff_number SN WHERE
		   SN.STAFF_NUMBER = #staffCode# AND ROWNUM < 2),
		   (select PI.party_id from party_identity PI WHERE
		   PI.identity_num = #cerdValue# AND PI.identidies_type_cd = '1' AND
		   ROWNUM < 2),
		   #replenishPhote#,
		   TO_DATE(#creatDate#, 'yyyy-mm-dd hh24:mi:ss'))
		   ]]>
    </insert>
    <update id="updataOutskirts"  parameterClass="java.util.HashMap">
		<![CDATA[
			UPDATE finger_photo_cut fpc
			   SET fpc.staff_id  = (select SN.STAFF_ID from staff_number SN WHERE
		   SN.STAFF_NUMBER = #staffCode# AND ROWNUM < 2),
			       fpc.Party_Id  = (select PI.party_id from party_identity PI WHERE
		   PI.identity_num = #cerdValue# AND PI.identidies_type_cd = '1' AND
		   ROWNUM < 2),
			       fpc.photo_cut = #replenishPhote#,
			       fpc.creat_dt  = TO_DATE(#creatDate#, 'yyyy-mm-dd hh24:mi:ss')
			 WHERE fpc.ol_id = #olId#
		]]>
   </update>
   <select id="queryOlidIfHave" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select ol.ol_id from finger_photo_cut ol where ol.ol_id = #olId#
		]]>
   </select>
   <select id="queryPartyIdByprodId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT OP.redu_owner_id FROM OFFER_PROD OP WHERE OP.PROD_ID = #prodId# and rownum < 2
		]]>
   </select>
   <select id="queryStaffIdBystaffCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			SELECT SN.STAFF_ID FROM Staff_Number SN where upper(SN.STAFF_NUMBER )=upper(#staffCode#) and rownum < 2
		]]>
   </select>
   <select id="queryOfferspecidBystaffCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			select op.redu_prod_spec_id as PRODSPECId from offer_prod OP WHERE OP.prod_id = #prodId# AND ROWNUM <2
		]]>
   </select>
   <select id="queryOldcustinfoByPartyId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select * from party p WHERE P.party_id = #partyId# AND ROWNUM <2
		]]>
   </select>
   <select id="queryPartyIdByCardId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select * from party_identity pi where pi.identidies_type_cd = '1'and pi.identity_num = #cerdValue# AND ROWNUM <2
		]]>
   </select>
   <select id="getSchoolRole" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select aa.party_id
  				from (select p2oa.party_id
		          from crm_app.party_2_operation_auth p2oa,
		               crm_app.operation_auth         oa,
		               crm_app.operation_spec         os
		         where os.manage_cd = 'AUTH20170605'
		           and oa.operation_spec_cd = os.operation_spec_cd
		           and oa.operation_auth_id = p2oa.operation_auth_id
		          
		        union
		        select p2oa.party_id
		          from sm.party_2_post_role          p2oa,
		               sm.post_role_2_operation_auth pr,
		               crm_app.operation_auth        oa,
		               crm_app.operation_spec        os
		         where os.manage_cd = 'AUTH20170605'
		           and oa.operation_spec_cd = os.operation_spec_cd
		           and pr.operation_auth_id = oa.operation_auth_id
		           and pr.post_role_id = p2oa.post_role_id) AA
					 WHERE AA.PARTY_ID = #staffId#
		]]>
   </select>
   <select id="queryGroupNumberByGroupId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 Select a.value
			  from so.order_list_attr a
			 Where a.item_spec_id = '201638'
			   And exists (select a.ol_id
			          from so.order_List_attr b
			         Where a.item_spec_id = '201639'
			           And a.ol_id = b.ol_id
			           And b.value = #olId#)
			           AND rownum < 2
		]]>
   </select>
   <select id="queryProvenceIdByGroupNum" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 SELECT ol.ol_id
			   FROM order_list OL
			  WHERE OL.status_cd = 'D'
			    and OL.ext_cust_order_id = #olId#
			  order by ol.so_date desc
		]]>
   </select>
   <select id="queryBureauDirectionByPhoneNum" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select a.phone_number, d.name
			  from rm.phone_number a, rm.device_2_ne c, rm.device d
			 where a.number_element_id = c.number_element_id
			   and c.device_id = d.device_id
			   and a.phone_number = #phoneNumber#
			   and rownum < 2

		]]>
   </select>
   <select id="queryRealNameFlagByIdent" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select  P.party_id, P.IF_REALNAME,P.PARTY_NAME
			  from crm_app.party_identity a, ctg_inst.party p
			 where a.identity_num = upper(#custInfo#)
			   and p.party_id = A.party_id
			   AND A.identidies_type_cd = '1'

		]]>
   </select>
   <select id="queryRealNameFlagByParttId" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select party_id, A.IF_REALNAME,A.PARTY_NAME from ctg_Inst.party a where a.party_id= #custInfo#
		]]>
   </select>
   <select id="queryRealNameFlagByPhoneAccssnumber" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select O.redu_access_number,A.IF_REALNAME,A.PARTY_ID,A.PARTY_NAME
			  from CRM_APP.OFFER_PROD O, ctg_Inst.party a
			 where O.redu_owner_id = a.party_id
			 AND O.status_cd = '12'
			   AND O.redu_access_number = #custInfo#
		]]>
   </select>


   <select id="queryPictureByolId" resultMap="FingerPhotoCutResultMapWithBLOBs" parameterClass="java.lang.String">
		
			 SELECT PHOTO_CUT ,party_id FROM finger_photo_cut  where ol_id = #olId#
		
   </select>
   <select id="querygztPictureInfoByolId" resultMap="GetResultMapWithBLOBs" parameterClass="java.lang.String">
		<![CDATA[
			 select gzt.return_msg 
			  from order_list                 ol,
			       ctg_inst.party_identity    pi,
			       crm.log_identity_check_gzt gzt
			 where ol.party_id = pi.party_id
			   and pi.identidies_type_cd = '1'
			   and pi.identity_num = gzt.identity_number
			   and ol.ol_id =#olId#
		]]>
   </select>
   
   <!-- add by jxx 20180122 newPartyPhote -->
   <select id="queryNewPartyPhotoByOlId" resultMap="GetResultMapWithBLOBs" parameterClass="java.lang.String">
   		<![CDATA[
   			select gzt.return_msg from 
			ctg_inst.party_identity pi,crm.log_identity_check_gzt gzt
			where pi.identidies_type_cd = 1
			and gzt.identity_number = pi.identity_num
			and pi.party_id in (
			 select distinct bc.party_id from so.busi_order bo , so.bo_cust bc
			 where bo.bo_id = bc.bo_id 
			 and bc.state = 'ADD'
			 and bo.ol_id = #olId# 
			)
   		]]>
   </select>
   
     <select id="queryChannelInfoByIdentityNum" resultClass="java.util.HashMap" parameterClass="java.lang.String">
   		<![CDATA[
   		select b.staff_number,
		       a.party_id,
		       c.name,
		       d.channel_id,
		       a.state,
		       b.staff_status_cd,
		       e.name channel_name
		  from sm.party            a,
		       sm.staff_number     b,
		       crm.party           c,
		       crm.party_2_channel d,
		       crm.channel         e
		 where a.primary_identify_num = '37130219900116104X'
		   and a.party_id = b.staff_id
		   and a.party_id = c.party_id
		   and d.party_id = a.party_id
		   and d.channel_id = e.channel_id
   		]]>
   </select>
   
   
   <select id="queryAccIdbyAccCd" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select ac.acct_id from account ac where ac.acct_cd = #accId#
		]]>
   </select>
   <select id="desensitizationService" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select * from CSB_desensitization_SERVICE cds where cds.service_en_name = #serviceName#
		]]>
   </select>
   <select id="desensitizationSystemCode" resultClass="java.util.HashMap" parameterClass="java.lang.String">
		<![CDATA[
			 select * from CSB_desensitization_SYSTEM cds where cds.system_code = #desensitizationSystemId#
		]]>
   </select>
   <insert id='savaDesensitizationLog' parameterClass='java.util.HashMap'>
		INSERT INTO CSB_DESENSITIZATION_LOG(ID,SYSTEM_CODE,REQUEST,VISIT_DT)
		VALUES(#id#, #system#, #request#, #visitDt#)
	</insert>
   <select id="queryOfferSpecInfoList" resultClass="java.util.HashMap" parameterClass="java.util.Map">
		<![CDATA[
			SELECT OS.OFFER_SPEC_ID as id ,OS.NAME as name, OS.SUMMARY as summary FROM ppm.offer_spec os
				where 1=1
				and os.name like '%'||#name:VARCHAR#||'%'
				AND ROWNUM <=20 
		]]>
	</select>
	
	<!-- add by jxx 20180131 get party start level -->
	<select id="getStartLevelByPartyAccNbr" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		<![CDATA[
			select cm.membership_level from offer_prod op
			inner join club_member cm on cm.party_id = op.redu_owner_id
			where op.redu_access_number = #accNbr#
		]]>
	</select>
</sqlMap>